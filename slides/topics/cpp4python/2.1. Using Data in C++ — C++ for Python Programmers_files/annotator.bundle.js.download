!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function i(t,e,i){return(e=n(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(){function t(t){var e=!0,n=!1,i=null,o={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function r(t){
return!!(t&&t!==document&&"HTML"!==t.nodeName&&"BODY"!==t.nodeName&&"classList"in t&&"contains"in t.classList)}function s(t){var e=t.type,n=t.tagName;return!("INPUT"!==n||!o[e]||t.readOnly)||"TEXTAREA"===n&&!t.readOnly||!!t.isContentEditable}function a(t){t.classList.contains("focus-visible")||(t.classList.add("focus-visible"),t.setAttribute("data-focus-visible-added",""))}function l(t){t.hasAttribute("data-focus-visible-added")&&(t.classList.remove("focus-visible"),t.removeAttribute("data-focus-visible-added"))}function c(n){n.metaKey||n.altKey||n.ctrlKey||(r(t.activeElement)&&a(t.activeElement),e=!0)}function h(t){e=!1}function u(t){r(t.target)&&(e||s(t.target))&&a(t.target)}function d(t){r(t.target)&&(t.target.classList.contains("focus-visible")||t.target.hasAttribute("data-focus-visible-added"))&&(n=!0,window.clearTimeout(i),i=window.setTimeout((function(){n=!1}),100),l(t.target))}function f(t){"hidden"===document.visibilityState&&(n&&(e=!0),p())}function p(){document.addEventListener("mousemove",g),
document.addEventListener("mousedown",g),document.addEventListener("mouseup",g),document.addEventListener("pointermove",g),document.addEventListener("pointerdown",g),document.addEventListener("pointerup",g),document.addEventListener("touchmove",g),document.addEventListener("touchstart",g),document.addEventListener("touchend",g)}function m(){document.removeEventListener("mousemove",g),document.removeEventListener("mousedown",g),document.removeEventListener("mouseup",g),document.removeEventListener("pointermove",g),document.removeEventListener("pointerdown",g),document.removeEventListener("pointerup",g),document.removeEventListener("touchmove",g),document.removeEventListener("touchstart",g),document.removeEventListener("touchend",g)}function g(t){t.target.nodeName&&"html"===t.target.nodeName.toLowerCase()||(e=!1,m())}document.addEventListener("keydown",c,!0),document.addEventListener("mousedown",h,!0),document.addEventListener("pointerdown",h,!0),document.addEventListener("touchstart",h,!0),
document.addEventListener("visibilitychange",f,!0),p(),t.addEventListener("focus",u,!0),t.addEventListener("blur",d,!0),t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.host?t.host.setAttribute("data-js-focus-visible",""):t.nodeType===Node.DOCUMENT_NODE&&(document.documentElement.classList.add("js-focus-visible"),document.documentElement.setAttribute("data-js-focus-visible",""))}if("undefined"!=typeof window&&"undefined"!=typeof document){var e;window.applyFocusVisiblePolyfill=t;try{e=new CustomEvent("focus-visible-polyfill-ready")}catch(t){(e=document.createEvent("CustomEvent")).initCustomEvent("focus-visible-polyfill-ready",!1,!1,{})}window.dispatchEvent(e)}"undefined"!=typeof document&&t(document)}();let o=class{constructor(){i(this,"_listeners",void 0),this._listeners=new Map}add(t,e,n,i){t.addEventListener(e,n,i);const o=Symbol();return this._listeners.set(o,{eventTarget:t,eventType:e,listener:n,options:i}),o}remove(t){const e=this._listeners.get(t);if(e){
const{eventTarget:n,eventType:i,listener:o,options:r}=e;n.removeEventListener(i,o,r),this._listeners.delete(t)}}removeAll(){this._listeners.forEach((({eventTarget:t,eventType:e,listener:n,options:i})=>{t.removeEventListener(e,n,i)})),this._listeners.clear()}};function r(t){const e=t.toString(16);return 1===e.length?"0"+e:e}function s(t){const e=new Uint8Array(t/2);return window.crypto.getRandomValues(e),Array.from(e).map(r).join("")}function a(t){if(null===t||"object"!=typeof t)return!1;for(const e of["frame1","frame2","type","requestId"])if("string"!=typeof t[e])return!1;return!0}class l extends Error{constructor(t){super(t)}}class c{constructor({hostFrame:t,source:e,sourceId:n}){i(this,"_hostFrame",void 0),i(this,"_listeners",void 0),i(this,"_source",void 0),i(this,"_sourceId",void 0),this._hostFrame=t,this._source=e,this._sourceId=n,this._listeners=new o}destroy(){this._listeners.removeAll()}async discover(t){const e=s(6);return new Promise(((n,i)=>{const o=()=>{this._hostFrame.postMessage({
frame1:this._source,frame2:t,type:"request",requestId:e,sourceId:this._sourceId},"*")},r=setInterval(o,250),s=setTimeout((()=>{clearInterval(r),i(new l(`Unable to establish ${this._source}-${t} communication channel`))}),2e4),c=this._listeners.add(window,"message",(o=>{const{data:h,ports:u}=o;a(h)&&h.requestId===e&&"request"!==h.type&&(clearInterval(r),clearTimeout(s),this._listeners.remove(c),"string"==typeof h.error?i(new l(h.error)):u.length>0?n(u[0]):i(new l(`${this._source}-${t} port request failed`)))}));o()}))}}var h={exports:{}};function u(){}u.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function o(){i.off(t,o),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,o=n.length;i<o;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],o=[]
;if(i&&e)for(var r=0,s=i.length;r<s;r++)i[r].fn!==e&&i[r].fn._!==e&&o.push(i[r]);return o.length?n[t]=o:delete n[t],this}},h.exports=u;var d=h.exports.TinyEmitter=u;let f=null;function p(t){return t instanceof Error?{message:t.message,stack:t.stack}:{message:String(t),stack:void 0}}function m(t,e){if(!f)return;const n={type:"hypothesis-error",error:t instanceof Error?t:p(t),context:e};try{try{f.postMessage(n,"*")}catch(t){if(!(t instanceof DOMException&&"DataCloneError"===t.name))throw t;n.error=p(n.error),f.postMessage(n,"*")}}catch(t){console.warn("Unable to report Hypothesis error",t)}}function g(t){f=t}class _{constructor(t){i(this,"_allowedMessages",void 0),i(this,"_emitter",void 0),i(this,"_hypothesisAppsOrigin",void 0),i(this,"_handledRequests",void 0),i(this,"_listeners",void 0),i(this,"_sidebarHostChannel",void 0),i(this,"_sidebarConnected",void 0),this._hypothesisAppsOrigin=t,this._emitter=new d,this._handledRequests=new Set,this._sidebarHostChannel=new MessageChannel,this._sidebarConnected=!1,
this._listeners=new o,this._allowedMessages=[{allowedOrigin:"*",frame1:"guest",frame2:"host",type:"request"},{allowedOrigin:"*",frame1:"guest",frame2:"sidebar",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"sidebar",frame2:"host",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"notebook",frame2:"sidebar",type:"request"}],this._listen()}_listen(){const t="Handling port request",e=new Set,n=n=>{e.has(n)||(e.add(n),m(new Error(n),t))};var i,o;this._listeners.add(window,"message",(i=t=>{const{data:e,origin:i,source:o}=t;if(!o)return;if(!a(e)||"request"!==e.type)return;const{frame1:r,frame2:s,requestId:l,sourceId:c}=e,h=`${r}-${s}`;if(!function(t){return!(null===t||t instanceof MessagePort||window.ServiceWorker&&t instanceof ServiceWorker)}(o))return void n(`Ignored port request for channel ${h} from non-Window source`);if(void 0===this._allowedMessages.find((({allowedOrigin:t,...n})=>this._messageMatches({allowedMessage:n,allowedOrigin:t,data:e,origin:i
}))))return void n(`Ignored invalid port request for channel ${h} from ${i}`);if(this._handledRequests.has(l))return;this._handledRequests.add(l);const u="null"===i?"*":i,d="sidebar-host"===h?this._sidebarHostChannel:new MessageChannel,f={frame1:r,frame2:s,type:"offer",requestId:l,sourceId:c};if(d===this._sidebarHostChannel){if(this._sidebarConnected)return console.warn("Ignoring second request from Hypothesis sidebar to connect to host frame"),f.error="Received duplicate port request",void o.postMessage(f,u);this._sidebarConnected=!0}o.postMessage(f,u,[d.port1]),"sidebar"===s?this._sidebarHostChannel.port2.postMessage(f,[d.port2]):"host"===s&&this._emitter.emit("frameConnected",r,d.port2)},o=t,(...t)=>{try{return i(...t)}catch(t){throw m(t,o),t}}))}_messageMatches({allowedMessage:t,allowedOrigin:e,data:n,origin:i}){return("*"===e||i===e)&&function(t,e){return!!a(t)&&JSON.stringify(t,Object.keys(e).sort())===JSON.stringify(e,Object.keys(e).sort())}(n,t)}on(t,e){this._emitter.on(t,e)}destroy(){
this._listeners.removeAll()}}const v="1.0.0",b="frame-rpc";function y(t,e=[],n=-1){return{protocol:b,version:v,arguments:e,method:t,sequence:n}}function w(t,e,n=[],i=-1){t.postMessage(y(e,n,i))}function x(t){const e=t.match(/\bAppleWebKit\/([0-9]+)\b/);if(!e)return!1;return!(parseInt(e[1])<=537)}class C{constructor({userAgent:t=navigator.userAgent,currentWindow:e=window,forceUnloadListener:n=!1}={}){i(this,"_callbacks",void 0),i(this,"_destroyed",void 0),i(this,"_listeners",void 0),i(this,"_methods",void 0),i(this,"_port",void 0),i(this,"_sequence",void 0),i(this,"_pendingCalls",void 0),i(this,"_receivedCloseEvent",void 0),this._port=null,this._methods=new Map,this._sequence=1,this._callbacks=new Map,this._listeners=new o,"onclose"in MessagePort.prototype&&!n||this._listeners.add(e,"unload",(()=>{this._port&&(w(this._port,"close"),e!==e.parent&&x(t)&&e.parent.postMessage({type:"hypothesisPortClosed"},"*",[this._port]))})),this._pendingCalls=[],this._destroyed=!1,this._receivedCloseEvent=!1}on(t,e){
if(this._port)throw new Error("Cannot add a method handler after a port is connected");this._methods.set(t,e)}connect(t){this._port=t,this._listeners.add(t,"message",(t=>this._handle(t))),this._listeners.add(t,"close",(()=>{t.dispatchEvent(new MessageEvent("message",{data:y("close")}))})),t.start(),w(t,"connect");for(const[t,e]of this._pendingCalls)this.call(t,...e);this._pendingCalls=[]}destroy(){this._port&&(w(this._port,"close"),this._port.close()),this._destroyed=!0,this._listeners.removeAll()}call(t,...e){if(this._port||this._pendingCalls.push([t,e]),!this._port||this._destroyed)return;const n=this._sequence++,i=e[e.length-1];"function"==typeof i&&(this._callbacks.set(n,i),e=e.slice(0,-1)),w(this._port,t,e,n)}_parseMessage({data:t}){return t&&"object"==typeof t?t.protocol!==b||t.version!==v?null:Array.isArray(t.arguments)?t:null:null}_handle(t){const e=this._parseMessage(t),n=this._port;if(e&&n)if("method"in e){if("close"===e.method){if(this._receivedCloseEvent)return;this._receivedCloseEvent=!0}
const t=this._methods.get(e.method);if(!t)return;const i=(...t)=>{const i={arguments:t,protocol:b,response:e.sequence,version:v};n.postMessage(i)};t(...e.arguments,i)}else if("response"in e){const t=this._callbacks.get(e.response);this._callbacks.delete(e.response),t&&t(...e.arguments)}}}function S(t){if("string"==typeof t&&"false"===t.trim().toLocaleLowerCase())return!1;const e=Number(t);return isNaN(e)?"string"==typeof t:Boolean(e)}function N(t){for(var e={},n=t.querySelectorAll("script.js-hypothesis-config"),i=0;i<n.length;i++){var o=void 0;try{o=JSON.parse(n[i].textContent||"")}catch(t){console.warn("Could not parse settings from js-hypothesis-config tags",t),o={}}Object.assign(e,o)}return e}function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function A(t){return t.width<=0||t.height<=0}function T(t,e,n,i){return Math.max(t,n)<Math.min(e,i)}function k(t,e){return!A(t)&&!A(e)&&(T(t.left,t.right,e.left,e.right)&&T(t.top,t.bottom,e.top,e.bottom))}function R(t,e){
return T(t.top,t.bottom,e.top,e.bottom)}function P(t,e){return T(t.left,t.right,e.left,e.right)}function O(t,e){if(A(t))return e;if(A(e))return t;const n=Math.min(t.left,e.left),i=Math.min(t.top,e.top),o=Math.max(t.right,e.right),r=Math.max(t.bottom,e.bottom);return new DOMRect(n,i,o-n,r-i)}function M(t){return new DOMPoint((t.left+t.right)/2,(t.top+t.bottom)/2)}function I(t){return t.nodeType===Node.ELEMENT_NODE}function L(t){return t.nodeType===Node.TEXT_NODE}const B=["p",".para"];let D;function F(t,e=0,n=t.data.length){return D||(D=document.createRange()),D.setStart(t,e),D.setEnd(t,n),D.getBoundingClientRect()}function H(t){const e=t.getBoundingClientRect();return e.x-=t.scrollLeft,e.y-=t.scrollTop,e.height=Math.max(e.height,t.scrollHeight),e.width=Math.max(e.width,t.scrollWidth),e}function*V(t,e,n){let i=t.firstChild;for(;i;){if(I(i)){const t=k(H(i),e);n(i)&&t&&(yield*V(i,e,n))}else L(i)&&k(F(i),e)&&(yield i);i=i.nextSibling}}function U(t,e){let n=null;const i=t=>!function(t){
switch(getComputedStyle(t).position){case"fixed":case"sticky":return!0;default:return!1}}(t);t:for(const s of V(t,e,i)){let t=0;for(const i of s.data.split(/\b/)){if(/\S/.test(i)){const a=t,l=t+i.length,c=F(s,a,l);if(r=c,!A(o=e)&&!A(r)&&r.left>=o.left&&r.right<=o.right&&r.top>=o.top&&r.bottom<=o.bottom){n=document.createRange(),n.setStart(s,a),n.setEnd(s,l);break t}}t+=i.length}}var o,r;return n}function q(t,e=document.documentElement,n=new DOMRect(0,0,window.innerWidth,window.innerHeight)){const i=U(e,n);if(!i)return t(),0;const o=i.getBoundingClientRect().top;t();const r=i.getBoundingClientRect().top-o;return e.scrollTop+=r,r}function W(t,e,n){const i=t.document.querySelector(`link[type="application/annotator+${n}"][rel="${e}"]`);if(!i)throw new Error(`No application/annotator+${n} (rel="${e}") link in the document`);if(!i.href)throw new Error(`application/annotator+${n} (rel="${e}") link has no href`);return i.href}function z(t){return"string"==typeof t?t:null}function $(t){const e=function(t){
if(!E(t,"hypothesisConfig"))return{};if("function"!=typeof t.hypothesisConfig){const t="https://h.readthedocs.io/projects/client/en/latest/publishers/config/#window.hypothesisConfig";return console.warn("hypothesisConfig must be a function, see: "+t),{}}return t.hypothesisConfig()}(t),n=S(e.ignoreOtherConfiguration)?{}:N(t.document);function i(t){return E(e,t)?e[t]:E(n,t)?n[t]:void 0}return{get annotations(){return z(n.annotations)||function(){const e=t.location.href.match(/#annotations:([A-Za-z0-9_-]+)$/);return e?e[1]:null}()},get clientUrl(){return W(t,"hypothesis-client","javascript")},get group(){return z(n.group)||function(){const e=t.location.href.match(/#annotations:group:([A-Za-z0-9_-]+)$/);return e?e[1]:null}()},get notebookAppUrl(){return W(t,"notebook","html")},get profileAppUrl(){return W(t,"profile","html")},get showHighlights(){return function(){const t=i("showHighlights");switch(t){case"always":case"never":case"whenSidebarOpen":return t;case!0:return"always";case!1:return"never";default:
return"always"}}()},get sidebarAppUrl(){return W(t,"sidebar","html")},get query(){return z(n.query)||function(){const e=t.location.href.match(/#annotations:(query|q):(.+)$/i);if(e)try{return decodeURIComponent(e[2])}catch(t){}return null}()},get sideBySide(){return function(){const t=i("sideBySide");if(!function(t){return null!==t&&"object"==typeof t}(t))return{mode:"auto"};const e="mode"in t&&function(t){return"string"==typeof t&&["auto","manual"].includes(t)}(t.mode)?t.mode:"auto";return"auto"===e?{mode:e}:{mode:e,isActive:"isActive"in t&&"function"==typeof t.isActive?t.isActive:void 0}}()},hostPageSetting:i}}const j=(t,e)=>t.hostPageSetting(e),X={annotations:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.annotations},appType:{allowInBrowserExt:!0,defaultValue:null,getValue:j},branding:{defaultValue:null,allowInBrowserExt:!1,getValue:j},bucketContainerSelector:{defaultValue:null,allowInBrowserExt:!1,getValue:j},clientUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.clientUrl},
contentInfoBanner:{allowInBrowserExt:!1,defaultValue:null,getValue:j},contentReady:{allowInBrowserExt:!0,defaultValue:null,getValue:j},enableExperimentalNewNoteButton:{allowInBrowserExt:!1,defaultValue:null,getValue:j},group:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.group},focus:{allowInBrowserExt:!1,defaultValue:null,getValue:j},theme:{allowInBrowserExt:!1,defaultValue:null,getValue:j},usernameUrl:{allowInBrowserExt:!1,defaultValue:null,getValue:j},onLayoutChange:{allowInBrowserExt:!1,defaultValue:null,getValue:j},openSidebar:{allowInBrowserExt:!0,defaultValue:!1,coerce:S,getValue:j},query:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.query},requestConfigFromFrame:{allowInBrowserExt:!1,defaultValue:null,getValue:j},services:{allowInBrowserExt:!1,defaultValue:null,getValue:j},showHighlights:{allowInBrowserExt:!1,defaultValue:"always",getValue:t=>t.showHighlights},notebookAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.notebookAppUrl},profileAppUrl:{allowInBrowserExt:!0,
defaultValue:null,getValue:t=>t.profileAppUrl},sidebarAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.sidebarAppUrl},subFrameIdentifier:{allowInBrowserExt:!0,defaultValue:null,getValue:j},externalContainerSelector:{allowInBrowserExt:!1,defaultValue:null,getValue:j},sideBySide:{allowInBrowserExt:!0,getValue:t=>t.sideBySide}};function Y(t,e=window){const n=$(e),i={};for(const r of function(t){const e={annotator:["clientUrl","contentInfoBanner","contentReady","subFrameIdentifier","sideBySide"],sidebar:["appType","annotations","branding","bucketContainerSelector","enableExperimentalNewNoteButton","externalContainerSelector","focus","group","onLayoutChange","openSidebar","query","requestConfigFromFrame","services","showHighlights","sidebarAppUrl","theme","usernameUrl"],notebook:["branding","group","notebookAppUrl","requestConfigFromFrame","services","theme","usernameUrl"],profile:["profileAppUrl"]};return"all"===t?Object.values(e).flat():e[t]}(t)){
const t=X[r],s=void 0!==t.defaultValue,a=!((o=W(e,"sidebar","html")).startsWith("http://")||o.startsWith("https://"));if(!t.allowInBrowserExt&&a){s&&(i[r]=t.defaultValue);continue}const l=t.getValue(n,r);void 0!==l?i[r]=t.coerce?t.coerce(l):l:s&&(i[r]=t.defaultValue)}var o;return i}var G,K,Z,Q,J,tt,et,nt,it={},ot=[],rt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,st=Array.isArray;function at(t,e){for(var n in e)t[n]=e[n];return t}function lt(t){var e=t.parentNode;e&&e.removeChild(t)}function ct(t,e,n,i,o){var r={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==o?++Z:o,__i:-1,__u:0};return null==o&&null!=K.vnode&&K.vnode(r),r}function ht(t){return t.children}function ut(t,e){this.props=t,this.context=e}function dt(t,e){if(null==e)return t.__?dt(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?dt(t):null}function ft(t){var e,n
;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return ft(t)}}function pt(t){(!t.__d&&(t.__d=!0)&&Q.push(t)&&!mt.__r++||J!==K.debounceRendering)&&((J=K.debounceRendering)||tt)(mt)}function mt(){var t,e,n,i,o,r,s,a,l;for(Q.sort(et);t=Q.shift();)t.__d&&(e=Q.length,i=void 0,r=(o=(n=t).__v).__e,a=[],l=[],(s=n.__P)&&((i=at({},o)).__v=o.__v+1,K.vnode&&K.vnode(i),Ct(s,i,o,n.__n,void 0!==s.ownerSVGElement,32&o.__u?[r]:null,a,null==r?dt(o):r,!!(32&o.__u),l),i.__.__k[i.__i]=i,St(a,i,l),i.__e!=r&&ft(i)),Q.length>e&&Q.sort(et));mt.__r=0}function gt(t,e,n,i,o,r,s,a,l,c,h){var u,d,f,p,m,g=i&&i.__k||ot,_=e.length;for(n.__d=l,function(t,e,n){var i,o,r,s,a,l=e.length,c=n.length,h=c,u=0;for(t.__k=[],i=0;i<l;i++)null!=(o=t.__k[i]=null==(o=e[i])||"boolean"==typeof o||"function"==typeof o?null:"string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?ct(null,o,null,null,o):st(o)?ct(ht,{children:o
},null,null,null):void 0===o.constructor&&o.__b>0?ct(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o)?(o.__=t,o.__b=t.__b+1,a=vt(o,n,s=i+u,h),o.__i=a,r=null,-1!==a&&(h--,(r=n[a])&&(r.__u|=131072)),null==r||null===r.__v?(-1==a&&u--,"function"!=typeof o.type&&(o.__u|=65536)):a!==s&&(a===s+1?u++:a>s?h>l-s?u+=a-s:u--:u=a<s&&a==s-1?a-s:0,a!==i+u&&(o.__u|=65536))):(r=n[i])&&null==r.key&&r.__e&&(r.__e==t.__d&&(t.__d=dt(r)),At(r,r,!1),n[i]=null,h--);if(h)for(i=0;i<c;i++)null!=(r=n[i])&&0==(131072&r.__u)&&(r.__e==t.__d&&(t.__d=dt(r)),At(r,r))}(n,e,g),l=n.__d,u=0;u<_;u++)null!=(f=n.__k[u])&&"boolean"!=typeof f&&"function"!=typeof f&&(d=-1===f.__i?it:g[f.__i]||it,f.__i=u,Ct(t,f,d,o,r,s,a,l,c,h),p=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&Et(d.ref,null,f),h.push(f.ref,f.__c||p,f)),null==m&&null!=p&&(m=p),65536&f.__u||d.__k===f.__k?l=_t(f,l,t):"function"==typeof f.type&&void 0!==f.__d?l=f.__d:p&&(l=p.nextSibling),f.__d=void 0,f.__u&=-196609);n.__d=l,n.__e=m}function _t(t,e,n){var i,o;if("function"==typeof t.type){for(i=t.__k,
o=0;i&&o<i.length;o++)i[o]&&(i[o].__=t,e=_t(i[o],e,n));return e}return t.__e!=e&&(n.insertBefore(t.__e,e||null),e=t.__e),e&&e.nextSibling}function vt(t,e,n,i){var o=t.key,r=t.type,s=n-1,a=n+1,l=e[n];if(null===l||l&&o==l.key&&r===l.type)return n;if(i>(null!=l&&0==(131072&l.__u)?1:0))for(;s>=0||a<e.length;){if(s>=0){if((l=e[s])&&0==(131072&l.__u)&&o==l.key&&r===l.type)return s;s--}if(a<e.length){if((l=e[a])&&0==(131072&l.__u)&&o==l.key&&r===l.type)return a;a++}}return-1}function bt(t,e,n){"-"===e[0]?t.setProperty(e,null==n?"":n):t[e]=null==n?"":"number"!=typeof n||rt.test(e)?n:n+"px"}function yt(t,e,n,i,o){var r;t:if("style"===e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof i&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||bt(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||bt(t.style,e,n[e])}else if("o"===e[0]&&"n"===e[1])r=e!==(e=e.replace(/(PointerCapture)$|Capture$/,"$1")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=n,n?i?n.u=i.u:(n.u=Date.now(),
t.addEventListener(e,r?xt:wt,r)):t.removeEventListener(e,r?xt:wt,r);else{if(o)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==e&&"height"!==e&&"href"!==e&&"list"!==e&&"form"!==e&&"tabIndex"!==e&&"download"!==e&&"rowSpan"!==e&&"colSpan"!==e&&"role"!==e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null==n||!1===n&&"-"!==e[4]?t.removeAttribute(e):t.setAttribute(e,n))}}function wt(t){var e=this.l[t.type+!1];if(t.t){if(t.t<=e.u)return}else t.t=Date.now();return e(K.event?K.event(t):t)}function xt(t){return this.l[t.type+!0](K.event?K.event(t):t)}function Ct(t,e,n,i,o,r,s,a,l,c){var h,u,d,f,p,m,g,_,v,b,y,w,x,C,S,N=e.type;if(void 0!==e.constructor)return null;128&n.__u&&(l=!!(32&n.__u),r=[a=e.__e=n.__e]),(h=K.__b)&&h(e);t:if("function"==typeof N)try{if(_=e.props,v=(h=N.contextType)&&i[h.__c],b=h?v?v.props.value:h.__:i,n.__c?g=(u=e.__c=n.__c).__=u.__E:("prototype"in N&&N.prototype.render?e.__c=u=new N(_,b):(e.__c=u=new ut(_,b),u.constructor=N,u.render=Tt),v&&v.sub(u),
u.props=_,u.state||(u.state={}),u.context=b,u.__n=i,d=u.__d=!0,u.__h=[],u._sb=[]),null==u.__s&&(u.__s=u.state),null!=N.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=at({},u.__s)),at(u.__s,N.getDerivedStateFromProps(_,u.__s))),f=u.props,p=u.state,u.__v=e,d)null==N.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(null==N.getDerivedStateFromProps&&_!==f&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(_,b),!u.__e&&(null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(_,u.__s,b)||e.__v===n.__v)){for(e.__v!==n.__v&&(u.props=_,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach((function(t){t&&(t.__=e)})),y=0;y<u._sb.length;y++)u.__h.push(u._sb[y]);u._sb=[],u.__h.length&&s.push(u);break t}null!=u.componentWillUpdate&&u.componentWillUpdate(_,u.__s,b),null!=u.componentDidUpdate&&u.__h.push((function(){u.componentDidUpdate(f,p,m)}))}if(u.context=b,u.props=_,u.__P=t,u.__e=!1,w=K.__r,x=0,
"prototype"in N&&N.prototype.render){for(u.state=u.__s,u.__d=!1,w&&w(e),h=u.render(u.props,u.state,u.context),C=0;C<u._sb.length;C++)u.__h.push(u._sb[C]);u._sb=[]}else do{u.__d=!1,w&&w(e),h=u.render(u.props,u.state,u.context),u.state=u.__s}while(u.__d&&++x<25);u.state=u.__s,null!=u.getChildContext&&(i=at(at({},i),u.getChildContext())),d||null==u.getSnapshotBeforeUpdate||(m=u.getSnapshotBeforeUpdate(f,p)),gt(t,st(S=null!=h&&h.type===ht&&null==h.key?h.props.children:h)?S:[S],e,n,i,o,r,s,a,l,c),u.base=e.__e,e.__u&=-161,u.__h.length&&s.push(u),g&&(u.__E=u.__=null)}catch(t){e.__v=null,l||null!=r?(e.__e=a,e.__u|=l?160:32,r[r.indexOf(a)]=null):(e.__e=n.__e,e.__k=n.__k),K.__e(t,e,n)}else null==r&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Nt(n.__e,e,n,i,o,r,s,l,c);(h=K.diffed)&&h(e)}function St(t,e,n){e.__d=void 0;for(var i=0;i<n.length;i++)Et(n[i],n[++i],n[++i]);K.__c&&K.__c(e,t),t.some((function(e){try{t=e.__h,e.__h=[],t.some((function(t){t.call(e)}))}catch(t){K.__e(t,e.__v)}}))}function Nt(t,e,n,i,o,r,s,a,l){
var c,h,u,d,f,p,m,g=n.props,_=e.props,v=e.type;if("svg"===v&&(o=!0),null!=r)for(c=0;c<r.length;c++)if((f=r[c])&&"setAttribute"in f==!!v&&(v?f.localName===v:3===f.nodeType)){t=f,r[c]=null;break}if(null==t){if(null===v)return document.createTextNode(_);t=o?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,_.is&&_),r=null,a=!1}if(null===v)g===_||a&&t.data===_||(t.data=_);else{if(r=r&&G.call(t.childNodes),g=n.props||it,!a&&null!=r)for(g={},c=0;c<t.attributes.length;c++)g[(f=t.attributes[c]).name]=f.value;for(c in g)f=g[c],"children"==c||("dangerouslySetInnerHTML"==c?u=f:"key"===c||c in _||yt(t,c,null,f,o));for(c in _)f=_[c],"children"==c?d=f:"dangerouslySetInnerHTML"==c?h=f:"value"==c?p=f:"checked"==c?m=f:"key"===c||a&&"function"!=typeof f||g[c]===f||yt(t,c,f,g[c],o);if(h)a||u&&(h.__html===u.__html||h.__html===t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(u&&(t.innerHTML=""),gt(t,st(d)?d:[d],e,n,i,o&&"foreignObject"!==v,r,s,r?r[0]:n.__k&&dt(n,0),a,l),
null!=r)for(c=r.length;c--;)null!=r[c]&&lt(r[c]);a||(c="value",void 0!==p&&(p!==t[c]||"progress"===v&&!p||"option"===v&&p!==g[c])&&yt(t,c,p,g[c],!1),c="checked",void 0!==m&&m!==t[c]&&yt(t,c,m,g[c],!1))}return t}function Et(t,e,n){try{"function"==typeof t?t(e):t.current=e}catch(t){K.__e(t,n)}}function At(t,e,n){var i,o;if(K.unmount&&K.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||Et(i,null,e)),null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(t){K.__e(t,e)}i.base=i.__P=null,t.__c=void 0}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&At(i[o],e,n||"function"!=typeof t.type);n||null==t.__e||lt(t.__e),t.__=t.__e=t.__d=void 0}function Tt(t,e,n){return this.constructor(t,n)}function kt(t,e,n){var i,o,r,s;K.__&&K.__(t,e),o=(i="function"==typeof n)?null:n&&n.__k||e.__k,r=[],s=[],Ct(e,t=(!i&&n||e).__k=function(t,e,n){var i,o,r,s={};for(r in e)"key"==r?i=e[r]:"ref"==r?o=e[r]:s[r]=e[r];if(arguments.length>2&&(s.children=arguments.length>3?G.call(arguments,2):n),
"function"==typeof t&&null!=t.defaultProps)for(r in t.defaultProps)void 0===s[r]&&(s[r]=t.defaultProps[r]);return ct(t,s,i,o,null)}(ht,null,[t]),o||it,it,void 0!==e.ownerSVGElement,!i&&n?[n]:o?null:e.firstChild?G.call(e.childNodes):null,r,!i&&n?n:o?o.__e:e.firstChild,i,s),St(r,t,s)}function Rt(t,e){var n={__c:e="__cC"+nt++,__:t,Consumer:function(t,e){return t.children(e)},Provider:function(t){var n,i;return this.getChildContext||(n=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(t){this.props.value!==t.value&&n.some((function(t){t.__e=!0,pt(t)}))},this.sub=function(t){n.push(t);var e=t.componentWillUnmount;t.componentWillUnmount=function(){n.splice(n.indexOf(t),1),e&&e.call(t)}}),t.children}};return n.Provider.__=n.Consumer.contextType=n}G=ot.slice,K={__e:function(t,e,n,i){for(var o,r,s;e=e.__;)if((o=e.__c)&&!o.__)try{if((r=o.constructor)&&null!=r.getDerivedStateFromError&&(o.setState(r.getDerivedStateFromError(t)),s=o.__d),
null!=o.componentDidCatch&&(o.componentDidCatch(t,i||{}),s=o.__d),s)return o.__E=o}catch(e){t=e}throw t}},Z=0,ut.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=at({},this.state),"function"==typeof t&&(t=t(at({},n),this.props)),t&&at(n,t),null!=t&&this.__v&&(e&&this._sb.push(e),pt(this))},ut.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),pt(this))},ut.prototype.render=ht,Q=[],tt="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,et=function(t,e){return t.__v.__b-e.__v.__b},mt.__r=0,nt=0;var Pt,Ot,Mt,It,Lt=0,Bt=[],Dt=[],Ft=K.__b,Ht=K.__r,Vt=K.diffed,Ut=K.__c,qt=K.unmount;function Wt(t,e){K.__h&&K.__h(Ot,t,Lt||e),Lt=0;var n=Ot.__H||(Ot.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:Dt}),n.__[t]}function zt(t){return Lt=1,function(t,e,n){var i=Wt(Pt++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):ie(void 0,e),function(t){var e=i.__N?i.__N[0]:i.__[0],n=i.t(e,t);e!==n&&(i.__N=[n,i.__[1]],
i.__c.setState({}))}],i.__c=Ot,!Ot.u)){var o=function(t,e,n){if(!i.__c.__H)return!0;var o=i.__c.__H.__.filter((function(t){return t.__c}));if(o.every((function(t){return!t.__N})))return!r||r.call(this,t,e,n);var s=!1;return o.forEach((function(t){if(t.__N){var e=t.__[0];t.__=t.__N,t.__N=void 0,e!==t.__[0]&&(s=!0)}})),!(!s&&i.__c.props===t)&&(!r||r.call(this,t,e,n))};Ot.u=!0;var r=Ot.shouldComponentUpdate,s=Ot.componentWillUpdate;Ot.componentWillUpdate=function(t,e,n){if(this.__e){var i=r;r=void 0,o(t,e,n),r=i}s&&s.call(this,t,e,n)},Ot.shouldComponentUpdate=o}return i.__N||i.__}(ie,t)}function $t(t,e){var n=Wt(Pt++,3);!K.__s&&ne(n.__H,e)&&(n.__=t,n.i=e,Ot.__H.__h.push(n))}function jt(t,e){var n=Wt(Pt++,4);!K.__s&&ne(n.__H,e)&&(n.__=t,n.i=e,Ot.__h.push(n))}function Xt(t){return Lt=5,Yt((function(){return{current:t}}),[])}function Yt(t,e){var n=Wt(Pt++,7);return ne(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function Gt(t,e){return Lt=8,Yt((function(){return t}),e)}function Kt(){var t=Wt(Pt++,11);if(!t.__){
for(var e=Ot.__v;null!==e&&!e.__m&&null!==e.__;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function Zt(){for(var t;t=Bt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(te),t.__H.__h.forEach(ee),t.__H.__h=[]}catch(e){t.__H.__h=[],K.__e(e,t.__v)}}K.__b=function(t){Ot=null,Ft&&Ft(t)},K.__r=function(t){Ht&&Ht(t),Pt=0;var e=(Ot=t.__c).__H;e&&(Mt===Ot?(e.__h=[],Ot.__h=[],e.__.forEach((function(t){t.__N&&(t.__=t.__N),t.__V=Dt,t.__N=t.i=void 0}))):(e.__h.forEach(te),e.__h.forEach(ee),e.__h=[],Pt=0)),Mt=Ot},K.diffed=function(t){Vt&&Vt(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(1!==Bt.push(e)&&It===K.requestAnimationFrame||((It=K.requestAnimationFrame)||Jt)(Zt)),e.__H.__.forEach((function(t){t.i&&(t.__H=t.i),t.__V!==Dt&&(t.__=t.__V),t.i=void 0,t.__V=Dt}))),Mt=Ot=null},K.__c=function(t,e){e.some((function(t){try{t.__h.forEach(te),t.__h=t.__h.filter((function(t){return!t.__||ee(t)}))}catch(n){e.some((function(t){t.__h&&(t.__h=[])})),e=[],K.__e(n,t.__v)}})),Ut&&Ut(t,e)},K.unmount=function(t){
qt&&qt(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach((function(t){try{te(t)}catch(t){e=t}})),n.__H=void 0,e&&K.__e(e,n.__v))};var Qt="function"==typeof requestAnimationFrame;function Jt(t){var e,n=function(){clearTimeout(i),Qt&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,100);Qt&&(e=requestAnimationFrame(n))}function te(t){var e=Ot,n=t.__c;"function"==typeof n&&(t.__c=void 0,n()),Ot=e}function ee(t){var e=Ot;t.__c=t.__(),Ot=e}function ne(t,e){return!t||t.length!==e.length||e.some((function(e,n){return e!==t[n]}))}function ie(t,e){return"function"==typeof e?e(t):e}const oe={alt:1,ctrl:2,meta:4,shift:8};function re(t,e){if(!(t instanceof KeyboardEvent))return!1;const n=e.split("+").map((t=>t.toLowerCase()));let i=0,o=null;for(const t of n){const e=oe[t];if(e)i|=e;else{if(null!==o)throw new Error("Multiple non-modifier keys specified");o=t}}if(!o)throw new Error(`Invalid shortcut: ${e}`)
;return((t.ctrlKey?oe.ctrl:0)|(t.metaKey?oe.meta:0)|(t.altKey?oe.alt:0)|(t.shiftKey?oe.shift:0))===i&&t.key.toLowerCase()===o}function se(t,e,{rootElement:n}={}){$t((()=>{if(t)return function(t,e,{rootElement:n=(t=>null!==(t=document.documentElement)&&void 0!==t?t:void 0)()}={}){const i=n=>{re(n,t)&&e(n)};return n?(n.addEventListener("keydown",i),()=>n.removeEventListener("keydown",i)):()=>{}}(t,e,{rootElement:n})}),[t,e,n])}const ae=(t=window)=>t.matchMedia("(pointer: coarse)").matches;function le(t,e,n){return e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ce{constructor(){le(this,"_listeners",void 0),this._listeners=new Map}
add(t,e,n,i){t.addEventListener(e,n,i);const o=Symbol();return this._listeners.set(o,{eventTarget:t,eventType:e,listener:n,options:i}),o}remove(t){const e=this._listeners.get(t);if(e){const{eventTarget:n,eventType:i,listener:o,options:r}=e;n.removeEventListener(i,o,r),this._listeners.delete(t)}}removeAll(){this._listeners.forEach((({eventTarget:t,eventType:e,listener:n,options:i})=>{t.removeEventListener(e,n,i)})),this._listeners.clear()}}function he(t){t.focus()}function ue(t,{autofocus:e=!1,loop:n=!0,horizontal:i=!0,vertical:o=!0,selector:r="a,button",containerVisible:s=!0,focusElement:a=he}={}){const l=Xt(null),c=function(t){const e=Xt({callback:t,call:(...t)=>e.current.callback(...t)});return e.current.callback=t,e.current.call}(a);$t((()=>{if(!s)return()=>{};if(!t.current)throw new Error("Container ref not set");const a=t.current,h=()=>{const t=Array.from(a.querySelectorAll(r)).filter((t=>null!==t.offsetParent&&!function(t){return"boolean"==typeof t.disabled&&t.disabled}(t)))
;return document.activeElement===a&&t.unshift(a),t},u=(t=h(),e=-1,n=!1,i)=>{e<0&&(e=t.findIndex((t=>0===t.tabIndex)))<0&&(e=0);for(const[o,r]of t.entries())r.tabIndex=o===e?0:-1,o===e&&n&&(l.current=r,c(r,i))},d=h(),f=l.current?d.indexOf(l.current):0;u(d,f,e);const p=new ce;p.add(a,"focusin",(t=>{if(t.target===a&&l.current)return void c(l.current);const n=h(),i=n.indexOf(t.target);i>=0&&u(n,i,e)})),p.add(a,"keydown",(t=>{const e=h();let r=e.findIndex((t=>0===t.tabIndex)),s=!1;i&&"ArrowLeft"===t.key||o&&"ArrowUp"===t.key?(0===r?r=n?e.length-1:r:--r,s=!0):i&&"ArrowRight"===t.key||o&&"ArrowDown"===t.key?(r===e.length-1?r=n?0:r:++r,s=!0):"Home"===t.key?(r=0,s=!0):"End"===t.key&&(r=e.length-1,s=!0),s&&(u(e,r,!0,t),t.preventDefault(),t.stopPropagation())}));const m=new MutationObserver((()=>{u()}));return m.observe(a,{subtree:!0,attributes:!0,attributeFilter:["disabled"],childList:!0}),()=>{p.removeAll(),m.disconnect()}}),[e,t,c,i,n,r,o,s])}function de(t,e,n){return e=function(t){var e=function(t,e){
if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class fe{constructor(t){de(this,"_target",void 0),de(this,"_value",void 0),this._target=t,this._value=null}get current(){return this._value}set current(t){this._value=t,this._updateTarget()}get target(){return this._target}set target(t){t!==this._target&&(this._target=t,this._updateTarget())}_updateTarget(){const t=this._value;"function"==typeof this._target?this._target(t):this._target&&(this._target.current=t)}}var pe,me={exports:{}};pe=me,function(){var t={}.hasOwnProperty;function e(){for(var t="",e=0;e<arguments.length;e++){var o=arguments[e];o&&(t=i(t,n(o)))}return t}function n(n){
if("string"==typeof n||"number"==typeof n)return n;if("object"!=typeof n)return"";if(Array.isArray(n))return e.apply(null,n);if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]"))return n.toString();var o="";for(var r in n)t.call(n,r)&&n[r]&&(o=i(o,r));return o}function i(t,e){return e?t?t+" "+e:t+e:t}pe.exports?(e.default=e,pe.exports=e):window.classNames=e}();var ge=e(me.exports);var _e=0;function ve(t,e,n,i,o,r){var s,a,l={};for(a in e)"ref"==a?s=e[a]:l[a]=e[a];var c={type:t,props:l,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--_e,__i:-1,__u:0,__source:o,__self:r};if("function"==typeof t&&(s=t.defaultProps))for(a in s)void 0===l[a]&&(l[a]=s[a]);return K.vnode&&K.vnode(c),c}Rt({}),Rt({});var be="/home/runner/work/frontend-shared/frontend-shared/src/components/layout/Card.tsx";function ye({children:t,classes:e,elementRef:n,active:i=!1,variant:o="raised",width:r="full",...s}){return ve("div",{"data-component":"Card",...s,ref:n,
className:ge("rounded-lg border bg-white",{"shadow hover:shadow-md":"raised"===o,"shadow-md":i&&"raised"===o},{"w-full":"full"===r,"w-auto":"auto"===r},e),children:t},void 0,0,{fileName:be,lineNumber:40,columnNumber:5},this)}var we="/home/runner/work/frontend-shared/frontend-shared/src/components/layout/CardContent.tsx";function xe({children:t,classes:e,elementRef:n,size:i="md",...o}){return ve("div",{"data-component":"CardContent",...o,ref:n,className:ge({"p-3 space-y-4":"md"===i,"p-2 space-y-3":"sm"===i,"p-4 space-y-6":"lg"===i},e),children:t},void 0,0,{fileName:we,lineNumber:29,columnNumber:5},this)}var Ce="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Annotate.tsx";function Se(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"AnnotateIcon",...t,children:ve("path",{fill:"currentColor",
d:"M15 0c.27 0 .505.099.703.297A.961.961 0 0 1 16 1v15l-4-3H1a.974.974 0 0 1-.703-.29A.953.953 0 0 1 0 12V1A.96.96 0 0 1 .29.29.966.966 0 0 1 1 0zM7 3l-.469.063c-.312.041-.656.187-1.031.437-.375.25-.719.646-1.031 1.188C4.156 5.229 4 6 4 7l.002.063.006.062a.896.896 0 0 1 .008.11l-.002.074-.006.066a1.447 1.447 0 0 0 .43 1.188C4.729 8.854 5.082 9 5.5 9c.417 0 .77-.146 1.063-.438C6.854 8.271 7 7.918 7 7.5c0-.417-.146-.77-.438-1.063A1.447 1.447 0 0 0 5.5 6a1.467 1.467 0 0 0-.422.062c.177-1.03.542-1.632 1.094-1.804L7 4zm5 0-.469.063c-.312.041-.656.187-1.031.437-.375.25-.719.646-1.031 1.188C9.156 5.229 9 6 9 7l.002.063.006.062a.896.896 0 0 1 .008.11l-.002.074-.006.066a1.447 1.447 0 0 0 .43 1.188c.291.291.645.437 1.062.437.417 0 .77-.146 1.063-.438.291-.291.437-.645.437-1.062 0-.417-.146-.77-.438-1.063A1.447 1.447 0 0 0 10.5 6a1.467 1.467 0 0 0-.422.062c.177-1.03.542-1.632 1.094-1.804L12 4z"},void 0,0,{fileName:Ce,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:Ce,lineNumber:11,columnNumber:5},this)}
var Ne="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Cancel.tsx";function Ee(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CancelIcon",...t,children:ve("g",{fill:"none","fill-rule":"evenodd",children:[ve("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Ne,lineNumber:21,columnNumber:9},this),ve("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m8 8 3.536-3.536zL4.464 4.464zm0 0-3.536 3.536zl3.536 3.536z"},void 0,0,{fileName:Ne,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Ne,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ne,lineNumber:11,columnNumber:5},this)}var Ae="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretDown.tsx";function Te(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretDownIcon",...t,
children:ve("g",{fill:"none","fill-rule":"evenodd",children:[ve("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Ae,lineNumber:21,columnNumber:9},this),ve("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m12 6-4 4-4-4"},void 0,0,{fileName:Ae,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Ae,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ae,lineNumber:11,columnNumber:5},this)}var ke="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretLeft.tsx";function Re(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretLeftIcon",...t,children:ve("g",{fill:"none","fill-rule":"evenodd",children:[ve("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:ke,lineNumber:21,columnNumber:9},this),ve("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 12 6 8l4-4"},void 0,0,{fileName:ke,lineNumber:22,
columnNumber:9},this)]},void 0,0,{fileName:ke,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:ke,lineNumber:11,columnNumber:5},this)}var Pe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretRight.tsx";function Oe(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretRightIcon",...t,children:ve("g",{fill:"none","fill-rule":"evenodd",children:[ve("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Pe,lineNumber:21,columnNumber:9},this),ve("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m6 4 4 4-4 4"},void 0,0,{fileName:Pe,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Pe,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Pe,lineNumber:11,columnNumber:5},this)}var Me="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Caution.tsx";function Ie(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",
height:"16",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",viewBox:"0 0 24 24","data-component":"CautionIcon",...t,children:ve("path",{d:"M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0M12 9v4M12 17h.01"},void 0,0,{fileName:Me,lineNumber:24,columnNumber:7},this)},void 0,0,{fileName:Me,lineNumber:11,columnNumber:5},this)}var Le="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Check.tsx";function Be(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"CheckIcon",...t,children:ve("g",{fill:"none","fill-rule":"evenodd",children:[ve("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Le,lineNumber:20,columnNumber:9},this),ve("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 3 6 13 3 8"},void 0,0,{fileName:Le,lineNumber:21,columnNumber:9},this)]},void 0,0,{fileName:Le,lineNumber:19,
columnNumber:7},this)},void 0,0,{fileName:Le,lineNumber:11,columnNumber:5},this)}var De="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Hide.tsx";function Fe(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HideIcon",...t,children:ve("path",{fill:"currentColor",d:"m1.613.21.094.083 14 14a1 1 0 0 1-1.32 1.497l-.094-.083-14-14A1 1 0 0 1 1.613.21m.583 4.845a1 1 0 0 1 .292 1.384C2.165 6.935 2 7.46 2 8c0 2.123 2.628 4 6 4 .22 0 .44-.008.657-.024a1 1 0 0 1 .147 1.994c-.266.02-.534.03-.804.03-4.36 0-8-2.6-8-6 0-.937.283-1.84.812-2.653a1 1 0 0 1 1.384-.292M8 2c4.36 0 8 2.6 8 6 0 .937-.283 1.84-.812 2.653a1 1 0 0 1-1.676-1.092C13.835 9.065 14 8.54 14 8c0-2.123-2.628-4-6-4-.22 0-.44.008-.657.024a1 1 0 1 1-.147-1.994C7.462 2.01 7.73 2 8 2"},void 0,0,{fileName:De,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:De,lineNumber:11,columnNumber:5},this)}
var He="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Highlight.tsx";function Ve(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HighlightIcon",...t,children:ve("g",{fill:"none","fill-rule":"evenodd",children:[ve("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:He,lineNumber:21,columnNumber:9},this),ve("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15H1zm-.5-6v2l-1 1v-2zm.5-7v6h-2V2zm0-1h-2zm0 8h-2z"},void 0,0,{fileName:He,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:He,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:He,lineNumber:11,columnNumber:5},this)}var Ue="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/MenuCollapse.tsx";function qe(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","data-component":"MenuCollapseIcon",...t,children:ve("path",{fill:"currentColor",
d:"m8.54 4.205 6.23 5.87a.69.69 0 0 1 0 1.03l-.72.68a.8.8 0 0 1-1.09 0L8 7.135l-4.96 4.65a.8.8 0 0 1-1.09 0l-.73-.69a.69.69 0 0 1 0-1.02l6.24-5.87a.8.8 0 0 1 1.08 0"},void 0,0,{fileName:Ue,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:Ue,lineNumber:11,columnNumber:5},this)}var We="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/MenuExpand.tsx";function ze(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"MenuExpandIcon",...t,children:ve("path",{fill:"currentColor",d:"M7.456 11.788 1.226 5.92a.695.695 0 0 1 0-1.025l.726-.684a.804.804 0 0 1 1.087-.001L8 8.861l4.961-4.65a.804.804 0 0 1 1.087.001l.727.684c.3.283.3.742 0 1.025l-6.23 5.867a.804.804 0 0 1-1.09 0z"},void 0,0,{fileName:We,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:We,lineNumber:11,columnNumber:5},this)}var $e="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Note.tsx";function je(t){return ve("svg",{
xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"NoteIcon",...t,children:ve("path",{fill:"currentColor",d:"M14 0a2 2 0 0 1 1.995 1.85L16 2v7a1 1 0 0 1-.31.724l-.09.076-8 6a1 1 0 0 1-.471.192L7 16H2a2 2 0 0 1-1.995-1.85L0 14V2A2 2 0 0 1 1.85.005L2 0zm0 2H2v12h4V9a1 1 0 0 1 .883-.993L7 8h7zm-2 8H8v3z"},void 0,0,{fileName:$e,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:$e,lineNumber:11,columnNumber:5},this)}var Xe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerDown.tsx";function Ye(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerDownIcon",...t,children:ve("path",{stroke:"currentColor",d:"m15.5 0-7 8-8-8"},void 0,0,{fileName:Xe,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:Xe,lineNumber:11,columnNumber:5},this)}var Ge="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerUp.tsx";function Ke(t){return ve("svg",{
xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerUpIcon",...t,children:ve("path",{stroke:"currentColor",d:"m.5 9 7-8 8 8"},void 0,0,{fileName:Ge,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:Ge,lineNumber:11,columnNumber:5},this)}var Ze="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Show.tsx";function Qe(t){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"ShowIcon",...t,children:ve("path",{fill:"currentColor",d:"M8 2c4.36 0 8 2.6 8 6s-3.64 6-8 6c-4.36 0-8-2.6-8-6s3.64-6 8-6m0 2C4.628 4 2 5.877 2 8s2.628 4 6 4 6-1.877 6-4-2.628-4-6-4m0 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4"},void 0,0,{fileName:Ze,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ze,lineNumber:11,columnNumber:5},this)}var Je="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Button.tsx"
;function tn({children:t,classes:e,elementRef:n,expanded:i,pressed:o,title:r,icon:s,size:a="md",variant:l="secondary",unstyled:c=!1,role:h,...u}){const d=!c,f=d&&"custom"!==l,p=d&&"custom"!==a,m={"aria-label":r};return"tab"===h?m["aria-selected"]=o:(m["aria-pressed"]=o,m["aria-expanded"]=i),ve("button",{role:null!=h?h:"button","data-component":"Button",type:"button",...m,...u,className:ge({"focus-visible-ring transition-colors whitespace-nowrap flex items-center":d},f&&{"font-semibold rounded":!0,"text-grey-7 bg-grey-1 enabled:hover:text-grey-9 enabled:hover:bg-grey-2 aria-pressed:text-grey-9 aria-expanded:text-grey-9":"secondary"===l,"text-grey-1 bg-grey-7 enabled:hover:bg-grey-8 disabled:text-grey-4":"primary"===l},p&&{"p-2 gap-x-2":"md"===a,"p-1 gap-x-1":"xs"===a,"p-1.5 gap-x-1.5":"sm"===a,"p-2.5 gap-x-1.5":"lg"===a},e),ref:n,title:r,children:[s&&ve(s,{className:"w-em h-em"},void 0,0,{fileName:Je,lineNumber:120,columnNumber:16},this),t]},void 0,0,{fileName:Je,lineNumber:89,columnNumber:5},this)}
const en=ge("input-group:border input-group:rounded-none","input-group:first:rounded-l input-group:last:rounded-r","input-group:border-l-0 input-group:first:border-l");var nn="/home/runner/work/frontend-shared/frontend-shared/src/components/input/IconButton.tsx";function on({children:t,classes:e,elementRef:n,pressed:i,expanded:o,icon:r,size:s="md",title:a,variant:l="secondary",unstyled:c=!1,...h}){const u=!c;return ve(tn,{"data-component":"IconButton",...h,classes:ge({"focus-visible-ring transition-colors rounded whitespace-nowrap":u,"flex items-center justify-center":u},u&&en,u&&"custom"!==l&&{"text-grey-7 bg-transparent enabled:hover:text-grey-9 aria-pressed:text-brand aria-expanded:text-brand":"secondary"===l,"text-brand bg-transparent enabled:hover:text-grey-9 disabled:text-grey-7":"primary"===l,"text-grey-7 bg-grey-2 enabled:hover:text-grey-9 enabled:hover:bg-grey-3 disabled:text-grey-5 aria-pressed:bg-grey-3 aria-expanded:bg-grey-3":"dark"===l},u&&"custom"!==s&&{
"gap-x-2 touch:min-w-touch-minimum touch:min-h-touch-minimum":!0,"p-2":"md"===s,"p-1":"xs"===s,"p-1.5":"sm"===s,"p-2.5":"lg"===s},e),elementRef:n,title:a,pressed:i,expanded:o,unstyled:!0,children:[r&&ve(r,{className:"w-em h-em"},void 0,0,{fileName:nn,lineNumber:84,columnNumber:16},this),t]},void 0,0,{fileName:nn,lineNumber:49,columnNumber:5},this)}Rt({}),Rt(null);var rn="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/Callout.tsx";function sn({children:t,classes:e,elementRef:n,icon:i,status:o="notice",size:r="md",variant:s="outlined",unstyled:a=!1,...l}){const c=!a,h=c&&"custom"!==s,u=c&&"custom"!==r;let d=i;if(!d)switch(o){case"success":d=Be;break;case"error":d=Ee;break;default:d=Ie}const f=h&&u;return ve("div",{"data-component":"Callout",...l,ref:n,className:ge(c&&"flex items-center border",h&&{"rounded border":!0,"shadow hover:shadow-md cursor-pointer":"raised"===s,"border-yellow-notice":"notice"===o,"border-green-success":"success"===o,"border-red-error":"error"===o},h&&{
"bg-yellow-notice":"notice"===o&&f,"bg-green-success":"success"===o&&f,"bg-red-error":"error"===o&&f,"bg-white":!f},e),children:[f&&ve("div",{className:ge({"p-2":"md"===r,"p-1.5":"sm"===r,"p-3":"lg"===r}),children:ve(d,{"data-testid":"callout-icon",className:ge("text-white",{"w-[1.25em] h-[1.25em]":"md"===r,"w-[0.85em] h-[0.85em]":"sm"===r,"w-[1.5em] h-[1.5em]":"lg"===r})},void 0,0,{fileName:rn,lineNumber:95,columnNumber:11},this)},void 0,0,{fileName:rn,lineNumber:88,columnNumber:9},this),ve("div",{className:ge(u&&{"p-2":"md"===r,"py-1.5 px-2":"sm"===r,"p-3":"lg"===r},c&&"grow",h&&"bg-white rounded-r"),children:t},void 0,0,{fileName:rn,lineNumber:105,columnNumber:7},this)]},void 0,0,{fileName:rn,lineNumber:64,columnNumber:5},this)}var an="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/ToastMessages.tsx";function ln({message:t,onDismiss:e}){const n="notice"!==t.type?`${t.type.charAt(0).toUpperCase()+t.type.slice(1)}: `:"";return ve(sn,{classes:ge({"sr-only":t.visuallyHidden}),
status:t.type,onClick:()=>e(t.id),variant:"raised",children:[ve("strong",{children:n},void 0,0,{fileName:an,lineNumber:70,columnNumber:7},this),t.message]},void 0,0,{fileName:an,lineNumber:62,columnNumber:5},this)}const cn=({direction:t,onTransitionEnd:e,children:n,transitionClasses:i={}})=>{const o="out"===t,r=Xt(null),s=Yt((()=>{const{transitionIn:t="animate-fade-in",transitionOut:e="animate-fade-out"}=i;return{[t]:!o,[e]:o}}),[o,i]);return ve("div",{"data-testid":"animation-container",onAnimationEnd:n=>{n.target===r.current&&(null==e||e(null!=t?t:"in"))},ref:r,className:ge("relative w-full container",s),children:n},void 0,0,{fileName:an,lineNumber:111,columnNumber:5},void 0)};function hn({messages:t,onMessageDismiss:e,transitionClasses:n,setTimeout_:i=setTimeout}){const[o,r]=zt([]),s=Xt(new Map),a=Gt((t=>r((e=>[...e,t]))),[]),l=Gt((t=>{const e=i((()=>{a(t),s.current.delete(t)}),5e3);s.current.set(t,e)}),[a,i]),c=Gt(((t,n)=>{var i;const o=null===(i=n.autoDismiss)||void 0===i||i;"in"===t&&o&&l(n.id),
"out"===t&&(e(n.id),r((t=>t.filter((t=>t!==n.id)))))}),[l,e]);return jt((()=>{const t=s.current;return()=>{t.forEach((t=>clearTimeout(t)))}}),[]),ve("ul",{"aria-live":"polite","aria-relevant":"additions",className:"w-full space-y-2","data-component":"ToastMessages",children:t.map((t=>{const e=o.includes(t.id);return ve("li",{className:ge({"mb-2":!t.visuallyHidden}),children:ve(cn,{direction:e?"out":"in",onTransitionEnd:e=>c(e,t),transitionClasses:n,children:ve(ln,{message:t,onDismiss:a},void 0,0,{fileName:an,lineNumber:214,columnNumber:15},this)},void 0,0,{fileName:an,lineNumber:209,columnNumber:13},this)},t.id,0,{fileName:an,lineNumber:197,columnNumber:11},this)}))},void 0,0,{fileName:an,lineNumber:188,columnNumber:5},this)}const un=Rt(null);var dn="/home/runner/work/frontend-shared/frontend-shared/src/components/input/SelectNext.tsx";function fn(t,e){return"function"==typeof t?t(e):t}function pn({value:t,children:e,disabled:n=!1,classes:i}){const o=function(t){var e=Ot.context[t.__c],n=Wt(Pt++,9)
;return n.c=t,e?(null==n.__&&(n.__=!0,e.sub(Ot)),e.props.value):t.__}(un);if(!o)throw new Error("Select.Option can only be used as Select child");const{selectValue:r,value:s}=o,a=!n&&s===t;return ve("li",{className:ge("w-full ring-inset outline-none rounded-none","border-t first:border-t-0 transition-colors whitespace-nowrap",{"text-grey-4":n,"cursor-pointer focus:ring hover:bg-grey-1":!n},i),onClick:()=>{n||r(t)},onKeyPress:e=>{!n&&["Enter","Space"].includes(e.code)&&(e.preventDefault(),r(t))},role:"option","aria-disabled":n,"aria-selected":a,tabIndex:-1,children:ve("div",{className:ge("flex w-full p-1.5 border-l-4",{"border-l-transparent":!a,"border-l-brand font-medium":a}),children:fn(e,{selected:a,disabled:n})},void 0,0,{fileName:dn,lineNumber:92,columnNumber:7},this)},void 0,0,{fileName:dn,lineNumber:65,columnNumber:5},this)}
function mn({buttonContent:t,value:e,onChange:n,children:i,disabled:o,elementRef:r,buttonId:s,buttonClasses:a,listboxClasses:l,containerClasses:c,right:h=!1,"aria-label":u,"aria-labelledby":d}){const[f,p]=zt(!1),m=Gt((()=>p(!1)),[]),g=Xt(null),_=Xt(null),v=Kt(),b=function(t){const e=Xt(new fe(t));return e.current.target=t,e.current}(r),y=Kt(),w=function(t,e,n){const[i,o]=zt(!1);return jt((()=>{if(!t.current||!e.current||!n)return void o(!1);const i=window.innerHeight,{top:r,bottom:s}=t.current.getBoundingClientRect(),a=i-s,{bottom:l}=e.current.getBoundingClientRect();o(i-l<0&&r>a)}),[t,e,n]),i}(b,_,f),x=Gt((t=>{n(t),m()}),[m,n]);return function(t,e,{enabled:n=!0}={}){$t((()=>{if(!n)return()=>{};const i=document.body,o=new ce,r=n=>{t.current&&!n.composedPath().includes(t.current)&&e(n)};return o.add(i,"mousedown",r),o.add(i,"click",r),()=>{o.removeAll()}}),[t,n,e])}(g,m),function(t,e,{enabled:n=!0}={}){$t((()=>{if(!n||!t.current)return()=>{};const i=new ce;return i.add(t.current,"focusout",(n=>{const i=n
;t.current&&!t.current.contains(i.relatedTarget)&&e(i)})),()=>{i.removeAll()}}),[t,n,e])}(g,m),function(t,e,{enabled:n=!0}={}){$t((()=>{if(!n)return()=>{};const i=document.body,o=new ce;return o.add(i,"keydown",(n=>{t.includes(n.key)&&e(n)})),()=>{o.removeAll()}}),[n,e,t])}(["Escape"],m),ue(_,{horizontal:!1,loop:!1,autofocus:!0,containerVisible:f,selector:'[role="option"]:not([aria-disabled="true"])'}),jt((()=>{!f&&_.current.contains(document.activeElement)&&b.current.focus()}),[b,f]),ve("div",{className:ge("relative w-full border rounded",en,c),ref:g,children:[ve("button",{id:null!=s?s:y,className:ge("focus-visible-ring transition-colors whitespace-nowrap","w-full flex items-center justify-between gap-x-2 p-2","bg-grey-0 disabled:bg-grey-1 disabled:text-grey-6","rounded-[inherit]",a),type:"button",role:"combobox",disabled:o,"aria-expanded":f,"aria-haspopup":"listbox","aria-controls":v,"aria-label":u,"aria-labelledby":d,ref:b,onClick:()=>p((t=>!t)),onKeyDown:t=>{"ArrowDown"!==t.key||f||(t.preventDefault(),
p(!0))},"data-testid":"select-toggle-button",children:[ve("div",{className:"truncate",children:t},void 0,0,{fileName:dn,lineNumber:269,columnNumber:9},this),ve("div",{className:"text-grey-6",children:f?ve(qe,{},void 0,0,{fileName:dn,lineNumber:271,columnNumber:26},this):ve(ze,{},void 0,0,{fileName:dn,lineNumber:271,columnNumber:49},this)},void 0,0,{fileName:dn,lineNumber:270,columnNumber:9},this)]},void 0,0,{fileName:dn,lineNumber:238,columnNumber:7},this),ve(un.Provider,{value:{selectValue:x,value:e},children:ve("ul",{className:ge("absolute z-5 min-w-full max-h-80 overflow-y-auto","rounded border bg-white shadow hover:shadow-md focus-within:shadow-md",{"top-full mt-1":!w,"bottom-full mb-1":w,"right-0":h,hidden:!f},l),role:"listbox",ref:_,id:v,"aria-labelledby":null!=s?s:y,"aria-orientation":"vertical","data-testid":"select-listbox",children:i},void 0,0,{fileName:dn,lineNumber:275,columnNumber:9},this)},void 0,0,{fileName:dn,lineNumber:274,columnNumber:7},this)]},void 0,0,{fileName:dn,lineNumber:230,
columnNumber:5},this)}pn.displayName="SelectNext.Option",mn.displayName="SelectNext",Object.assign(mn,{Option:pn});var gn="/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/Link.tsx";function _n({children:t,classes:e,elementRef:n,underline:i="none",unstyled:o=!1,variant:r="brand",...s}){const a=!o;return ve("a",{"data-component":"Link",rel:"noopener noreferrer",...s,className:ge(a&&{"focus-visible-ring rounded":!0,"no-underline hover:no-underline":"none"===i,"underline hover:underline":"always"===i,"no-underline hover:underline":"hover"===i},a&&"custom"!==r&&{"text-brand hover:text-brand-dark":"brand"===r,"text-color-text-light hover:text-brand":"text-light"===r,"text-color-text hover:text-brand-dark":"text"===r},e),ref:n,children:t},void 0,0,{fileName:gn,lineNumber:37,columnNumber:5},this)}var vn="/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/PointerButton.tsx"
;function bn({children:t,classes:e,elementRef:n,expanded:i,pressed:o,title:r,direction:s,...a}){return ve(tn,{"data-component":"PointerButton",...a,elementRef:n,classes:ge("relative w-[26px] h-[16px]","flex items-center justify-center","bg-white rounded-[4px] border","before:absolute before:border-transparent","after:absolute after:border-transparent","text-[10px] text-color-text-light leading-none font-semibold",{"shadow-[1px_1px_1px_rgba(0,0,0,0.1)]":"down"!==s,"shadow-[1px_0px_1px_rgba(0,0,0,0.1)]":"down"===s},{"rounded-r-[4px] rounded-l-[2px]":"left"===s,"before:right-full before:top-1/2 after:right-full after:top-1/2":"left"===s,"before:mt-[-8px] before:border-8 before:border-r-[5px] before:border-r-grey-3":"left"===s,"after:mt-[-7px] after:border-[7px] after:border-r-[4px] after:border-r-white":"left"===s},{"z-1 rounded-t-px-sm rounded-b-px":"up"===s,"before:top-auto before:left-1/2 before:bottom-full after:top-auto after:left-1/2 after:bottom-full":"up"===s,
"before:ml-[-13px] before:border-[13px] before:border-b-[6px] before:border-b-grey-3":"up"===s,"after:ml-[-12px] after:border-[12px] after:border-b-[5px] after:border-b-white":"up"===s},{"z-1 rounded-t-px rounded-b-px-sm":"down"===s,"before:top-full before:left-1/2 after:top-full after:left-1/2":"down"===s,"before:ml-[-13px] before:border-[13px] before:border-t-[6px] before:border-t-grey-3":"down"===s,"after:ml-[-12px] after:border-[12px] after:border-t-[5px] after:border-t-white":"down"===s},e),expanded:i,pressed:o,title:r,variant:"custom",size:"custom",children:t},void 0,0,{fileName:vn,lineNumber:48,columnNumber:5},this)}function yn({badgeCount:t}){return ve("span",{className:ge("rounded px-1 py-0.5","bg-current"),children:ve("span",{className:"font-bold text-color-text-inverted",children:t})})}function wn({arrowDirection:t}){return ve("div",{className:ge("absolute left-1/2 -translate-x-1/2 z-2","fill-white text-grey-3",{"top-0 -translate-y-full":"up"===t}),children:ve("up"===t?Ke:Ye,{})})}
function xn({badgeCount:t,icon:e,label:n,onClick:i,shortcut:o}){se(o,i);const r=o?`${n} (${o})`:n;return ve(tn,{classes:ge("text-grey-7","group-hover:text-grey-5","hover:group-hover:text-grey-9"),onClick:i,title:r,size:"custom",variant:"custom",children:ve("div",{className:ge("flex flex-col items-center gap-y-1 py-2.5 px-2","text-annotator-sm leading-none"),children:[e&&ve(e,{className:"text-annotator-lg",title:r}),"number"==typeof t&&ve(yn,{badgeCount:t}),ve("span",{"data-testid":"adder-button-label",children:n})]})})}function Cn({annotationCount:t,isVisible:e}){return ve("div",{className:"sr-only",children:[ve("span",{"aria-live":"polite","aria-atomic":"true",role:"status","data-testid":"annotation-count-announce",children:t>0&&ve("span",{children:[t," ",1===t?"annotation":"annotations"," for this selection."]})}),ve("ul",{"aria-live":"polite","data-testid":"annotate-shortcuts-announce",children:e&&ve(ht,{children:[t>0&&ve("li",{children:["Press ","'S'"," to show annotations."]}),ve("li",{
children:["Press ","'A'"," to annotate."]}),ve("li",{children:["Press ","'H'"," to highlight."]})]})})]})}function Sn({arrowDirection:t,isVisible:e,onCommand:n,annotationCount:i=0}){const o=e?"a":null,r=e?"h":null,s=e?"s":null;return se(e?"Escape":null,(()=>n("hide"))),ve("div",{className:ge("all-initial","border border-solid border-grey-3","absolute select-none bg-white rounded shadow-intense","opacity-5",{"animate-adder-pop-up":"up"===t&&e,"animate-adder-pop-down":"down"===t&&e}),"data-component":"AdderToolbar",dir:"ltr",style:{visibility:e?"visible":"hidden"},children:[ve("div",{className:ge("flex group"),children:[ve(xn,{icon:Se,onClick:()=>n("annotate"),label:"Annotate",shortcut:o}),ve(xn,{icon:Ve,onClick:()=>n("highlight"),label:"Highlight",shortcut:r}),i>0&&ve(ht,{children:[ve("div",{className:ge("m-1.5 border-r border-grey-4 border-solid")}),ve(xn,{badgeCount:i,onClick:()=>n("show"),label:"Show",shortcut:s})]})]}),ve(wn,{arrowDirection:t}),ve(Cn,{annotationCount:i,isVisible:e})]})}function Nn(t){
const e=t.attachShadow({mode:"open"});!function(t){var e;const n=null===(e=document.querySelector('link[rel="preload"][href*="/build/styles/annotator.css"]'))||void 0===e?void 0:e.href;if(!n)return;const i=document.createElement("link");i.rel="stylesheet",i.href=n,t.appendChild(i)}(e);const n=window.applyFocusVisiblePolyfill;var i;return n&&n(e),(i=e).addEventListener("mouseup",(t=>t.stopPropagation())),i.addEventListener("mousedown",(t=>t.stopPropagation())),i.addEventListener("touchstart",(t=>t.stopPropagation()),{passive:!0}),e}class En{constructor(t,e){i(this,"_element",void 0),i(this,"_shadowRoot",void 0),i(this,"_render",void 0);const n=`hypothesis-${t}`;this._element=document.createElement(n),this._shadowRoot=Nn(this._element),this._render=e}destroy(){kt(null,this._shadowRoot),this._element.remove()}get element(){return this._element}render(){kt(this._render(),this._shadowRoot)}}let An=function(t){return t[t.DOWN=1]="DOWN",t[t.UP=2]="UP",t}({});function Tn(t){return t.toString()+"px"}class kn{
constructor(t,e){i(this,"_container",void 0),i(this,"_view",void 0),i(this,"_isVisible",void 0),i(this,"_arrowDirection",void 0),i(this,"_onAnnotate",void 0),i(this,"_onHighlight",void 0),i(this,"_onShowAnnotations",void 0),i(this,"_annotationsForSelection",void 0),this._view=t.ownerDocument.defaultView,this._isVisible=!1,this._arrowDirection="up",this._annotationsForSelection=[],this._onAnnotate=e.onAnnotate,this._onHighlight=e.onHighlight,this._onShowAnnotations=e.onShowAnnotations,this._container=new En("adder",(()=>this._render())),t.appendChild(this._container.element),Object.assign(this._container.element.style,{position:"absolute",top:0,left:0}),this._container.render()}get annotationsForSelection(){return this._annotationsForSelection}set annotationsForSelection(t){this._annotationsForSelection=t,this._container.render()}hide(){this._isVisible=!1,this._container.render(),Object.assign(this._container.element.style,{top:0,left:0})}destroy(){this._container.destroy()}show(t,e){
const{left:n,top:i,arrowDirection:o}=this._calculateTarget(t,e);this._showAt(n,i),this._isVisible=!0,this._arrowDirection=o===An.UP?"up":"down",this._container.render()}_firstChild(){return this._container.element.shadowRoot.firstChild}_width(){return this._firstChild().getBoundingClientRect().width}_height(){return this._firstChild().getBoundingClientRect().height}_calculateTarget(t,e){let n,i,o;n=e&&!ae()?An.DOWN:An.UP;const r=Math.min(20,t.width),s=this._width(),a=ae()?10:0,l=this._height();return o=e?t.left-s/2+r:t.left+t.width-s/2-r,t.top-l<0&&n===An.DOWN?n=An.UP:t.top+l>this._view.innerHeight&&(n=An.DOWN),i=n===An.UP?t.top+t.height+10+a:t.top-l-10,o=Math.max(o,0),o=Math.min(o,this._view.innerWidth-s),i=Math.max(i,0),i=Math.min(i,this._view.innerHeight-l),{top:i,left:o,arrowDirection:n}}_findZindex(t,e){if(void 0===document.elementsFromPoint)return 32768
;const n=this._width(),i=this._height(),o=[...new Set([...document.elementsFromPoint(t,e),...document.elementsFromPoint(t,e+i),...document.elementsFromPoint(t+n/2,e+i/2),...document.elementsFromPoint(t+n,e),...document.elementsFromPoint(t+n,e+i)])].map((t=>+getComputedStyle(t).zIndex)).filter(Number.isInteger);return o.push(0),Math.max(...o)+1}_showAt(t,e){const n=function(t){let e=t.parentElement;for(;e.parentElement&&"static"===getComputedStyle(e).position;)e=e.parentElement;return e}(this._container.element).getBoundingClientRect(),i=this._findZindex(t,e);Object.assign(this._container.element.style,{left:Tn(t-n.left),top:Tn(e-n.top),zIndex:i})}_render(){return ve(Sn,{isVisible:this._isVisible,arrowDirection:this._arrowDirection,onCommand:t=>{switch(t){case"annotate":this._onAnnotate(),this.hide();break;case"highlight":this._onHighlight(),this.hide();break;case"show":this._onShowAnnotations(this.annotationsForSelection);break;case"hide":this.hide()}},annotationCount:this.annotationsForSelection.length})}}
var Rn=function(t){return t[t.Forwards=1]="Forwards",t[t.Backwards=2]="Backwards",t}(Rn||{});function Pn(t,e,n){const i=n===Rn.Forwards?e:e-1;if(""!==t.charAt(i).trim())return e;let o,r;if(n===Rn.Backwards?(o=t.substring(0,e),r=o.trimEnd()):(o=t.substring(e),r=o.trimStart()),!r.length)return-1;const s=o.length-r.length;return n===Rn.Backwards?e-s:e+s}function On(t,e){const n=t.commonAncestorContainer.ownerDocument.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_TEXT),i=e===Rn.Forwards?t.startContainer:t.endContainer,o=e===Rn.Forwards?t.endContainer:t.startContainer;let r=n.nextNode();for(;r&&r!==i;)r=n.nextNode();e===Rn.Backwards&&(r=n.previousNode());let s=-1;const a=()=>{if(r=e===Rn.Forwards?n.nextNode():n.previousNode(),r){const t=r.textContent,n=e===Rn.Forwards?0:t.length;s=Pn(t,n,e)}};for(;r&&-1===s&&r!==o;)a();if(r&&s>=0)return{node:r,offset:s};throw new RangeError("No text nodes with non-whitespace text found in range")}function Mn(t){var e,n;switch(t.nodeType){case Node.ELEMENT_NODE:
case Node.TEXT_NODE:return null!==(e=null===(n=t.textContent)||void 0===n?void 0:n.length)&&void 0!==e?e:0;default:return 0}}function In(t){let e=t.previousSibling,n=0;for(;e;)n+=Mn(e),e=e.previousSibling;return n}function Ln(t,...e){let n=e.shift();const i=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_TEXT),o=[];let r,s=i.nextNode(),a=0;for(;void 0!==n&&s;)r=s,a+r.data.length>n?(o.push({node:r,offset:n-a}),n=e.shift()):(s=i.nextNode(),a+=r.data.length);for(;void 0!==n&&r&&a===n;)o.push({node:r,offset:r.data.length}),n=e.shift();if(void 0!==n)throw new RangeError("Offset exceeds text length");return o}let Bn=function(t){return t[t.FORWARDS=1]="FORWARDS",t[t.BACKWARDS=2]="BACKWARDS",t}({});class Dn{constructor(t,e){if(i(this,"element",void 0),i(this,"offset",void 0),e<0)throw new Error("Offset is invalid");this.element=t,this.offset=e}relativeTo(t){if(!t.contains(this.element))throw new Error("Parent is not an ancestor of current element");let e=this.element,n=this.offset;for(;e!==t;)n+=In(e),
e=e.parentElement;return new Dn(e,n)}resolve(t={}){try{return Ln(this.element,this.offset)[0]}catch(e){if(0===this.offset&&void 0!==t.direction){const n=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);n.currentNode=this.element;const i=t.direction===Bn.FORWARDS,o=i?n.nextNode():n.previousNode();if(!o)throw e;return{node:o,offset:i?0:o.data.length}}throw e}}static fromCharOffset(t,e){switch(t.nodeType){case Node.TEXT_NODE:return Dn.fromPoint(t,e);case Node.ELEMENT_NODE:return new Dn(t,e);default:throw new Error("Node is not an element or text node")}}static fromPoint(t,e){switch(t.nodeType){case Node.TEXT_NODE:{if(e<0||e>t.data.length)throw new Error("Text node offset is out of range");if(!t.parentElement)throw new Error("Text node has no parent");const n=In(t)+e;return new Dn(t.parentElement,n)}case Node.ELEMENT_NODE:{if(e<0||e>t.childNodes.length)throw new Error("Child node offset is out of range");let n=0;for(let i=0;i<e;i++)n+=Mn(t.childNodes[i]);return new Dn(t,n)}default:
throw new Error("Point is not in an element or text node")}}}class Fn{constructor(t,e){i(this,"start",void 0),i(this,"end",void 0),this.start=t,this.end=e}relativeTo(t){return new Fn(this.start.relativeTo(t),this.end.relativeTo(t))}toRange(){let t,e;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[t,e]=Ln(this.start.element,this.start.offset,this.end.offset):(t=this.start.resolve({direction:Bn.FORWARDS}),e=this.end.resolve({direction:Bn.BACKWARDS}));const n=new Range;return n.setStart(t.node,t.offset),n.setEnd(e.node,e.offset),n}static fromRange(t){const e=Dn.fromPoint(t.startContainer,t.startOffset),n=Dn.fromPoint(t.endContainer,t.endOffset);return new Fn(e,n)}static fromOffsets(t,e,n){return new Fn(new Dn(t,e),new Dn(t,n))}static trimmedRange(t){return function(t){if(!t.toString().trim().length)throw new RangeError("Range contains no non-whitespace text");if(t.startContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range startContainer is not a text node")
;if(t.endContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range endContainer is not a text node");const e=t.cloneRange();let n=!1,i=!1;const o={start:Pn(t.startContainer.textContent,t.startOffset,Rn.Forwards),end:Pn(t.endContainer.textContent,t.endOffset,Rn.Backwards)};if(o.start>=0&&(e.setStart(t.startContainer,o.start),n=!0),o.end>0&&(e.setEnd(t.endContainer,o.end),i=!0),n&&i)return e;if(!n){const{node:t,offset:n}=On(e,Rn.Forwards);t&&n>=0&&e.setStart(t,n)}if(!i){const{node:t,offset:n}=On(e,Rn.Backwards);t&&n>0&&e.setEnd(t,n)}return e}(Fn.fromRange(t).toRange())}}const Hn=".annotator-placeholder";function Vn(t){return!!t.parentElement&&null!==t.parentElement.closest(Hn)}function Un(t,e){const n=new Range;return t.compareBoundaryPoints(Range.START_TO_START,e)<=0?n.setStart(t.startContainer,t.startOffset):n.setStart(e.startContainer,e.startOffset),t.compareBoundaryPoints(Range.END_TO_END,e)>=0?n.setEnd(t.endContainer,t.endOffset):n.setEnd(e.endContainer,e.endOffset),n}
function qn(t=document.getSelection()){if(!t||0===t.rangeCount)return null;let e=t.getRangeAt(0);for(let n=1;n<t.rangeCount;n++)e=Un(e,t.getRangeAt(n));return e.collapsed?null:e}function Wn(t){if(t.focusNode===t.anchorNode)return t.focusOffset<t.anchorOffset;return qn(t).startContainer===t.focusNode}function zn(t,e){try{var n,i;const o=null!==(n=null===(i=e.nodeValue)||void 0===i?void 0:i.length)&&void 0!==n?n:e.childNodes.length;return t.comparePoint(e,0)<=0&&t.comparePoint(e,o)>=0}catch(t){return!1}}function $n(t,e){const n=t.commonAncestorContainer,i=n.ownerDocument.createNodeIterator(n,NodeFilter.SHOW_ALL);let o;for(;o=i.nextNode();)zn(t,o)&&e(o)}function jn(t){const e=qn(t);if(!e)return null;const n=function(t){const e=[];return $n(t,(t=>{L(t)&&!t.textContent.match(/^\s*$/)&&e.push(t)})),e.flatMap((e=>{const n=e.ownerDocument.createRange();if(n.selectNodeContents(e),e===t.startContainer&&n.setStart(e,t.startOffset),e===t.endContainer&&n.setEnd(e,t.endOffset),n.collapsed)return[]
;const i=Array.from(n.getClientRects());return n.detach(),i}))}(e);return 0===n.length?null:Wn(t)?n[0]:n[n.length-1]}const Xn="http://www.w3.org/2000/svg",Yn=["user-annotations","user-highlights","other-content"];function Gn(t,e){const n=function(t){if(t.collapsed)return[];let e=t.commonAncestorContainer;if(e&&e.nodeType!==Node.ELEMENT_NODE&&(e=e.parentElement),!e)return[];const n=[],i=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);let o;for(;o=i.nextNode();){if(!zn(t,o))continue;const e=o;e===t.startContainer&&t.startOffset>0?e.splitText(t.startOffset):(e===t.endContainer&&t.endOffset<e.data.length&&e.splitText(t.endOffset),n.push(e))}return n}(t),i=n.length>0&&Vn(n[0]);let o=[],r=null,s=null;n.forEach((t=>{r&&r.nextSibling===t?s.push(t):(s=[t],o.push(s)),r=t}));const a=/^\s*$/;o=o.filter((t=>{const e=t[0].parentElement;return 1===(null==e?void 0:e.childNodes.length)&&"SPAN"===(null==e?void 0:e.tagName)||t.some((t=>!a.test(t.data)))}));const l=[];return o.forEach((t=>{
const n=document.createElement("hypothesis-highlight");n.className=ge("hypothesis-highlight",e);t[0].parentNode.replaceChild(n,t[0]),t.forEach((t=>n.appendChild(t))),l.push(n)})),i||function(t,e){if(0===t.length)return;const n=function(t){const e=t.closest(".page");if(!e)return null;return e.querySelector(".canvasWrapper > canvas")||null}(t[0]);if(!n||!n.parentElement)return;let i=n.parentElement.querySelector(".hypothesis-highlight-layer");if(!i){i=document.createElementNS(Xn,"svg"),i.setAttribute("class","hypothesis-highlight-layer"),n.parentElement.appendChild(i),n.parentElement.style.position="relative";const t=i.style;t.position="absolute",t.left="0",t.top="0",t.width="100%",t.height="100%",t.mixBlendMode="multiply"}const o=n.getBoundingClientRect(),r=t.map((t=>{const n=t.getBoundingClientRect(),i=document.createElementNS(Xn,"rect");return i.setAttribute("x",(n.left-o.left).toString()),i.setAttribute("y",(n.top-o.top).toString()),i.setAttribute("width",n.width.toString()),
i.setAttribute("height",n.height.toString()),i.setAttribute("class",ge("hypothesis-svg-highlight",e)),t.classList.add("is-transparent"),t.svgHighlight=i,i}));i.append(...r)}(l,e),l}function Kn(t,e){const n=t.parentNode;e.forEach((e=>n.insertBefore(e,t))),t.remove()}function Zn(t){Qn(t,!1);for(const e of t){if(e.parentNode){Kn(e,Array.from(e.childNodes))}e.svgHighlight&&e.svgHighlight.remove()}}function Qn(t,e){t.forEach((t=>{t.svgHighlight?function(t,e){const n=t.parentNode,i=t.getAttribute("data-focused-id");if(Boolean(i)!==e)if(e){t.setAttribute("data-focused-id",s(8));const e=t.cloneNode();e.setAttribute("data-is-focused","data-is-focused"),n.append(e)}else{const e=n.querySelector(`[data-focused-id="${i}"][data-is-focused]`);null==e||e.remove(),t.removeAttribute("data-focused-id")}}(t.svgHighlight,e):t.classList.toggle("hypothesis-highlight-focused",e)}))}function Jn(t){ni(ei(t)),function(t){for(const[e,n]of function(t){const e=new Map
;for(const n of(null!=t?t:document).getElementsByClassName("hypothesis-highlight-layer"))e.set(n,Array.from(n.querySelectorAll(".hypothesis-svg-highlight")));return e}(t)){n.every(((t,e,n)=>0===e||ii(t)>=ii(n[e-1])))||(n.sort(((t,e)=>ii(t)-ii(e))),e.replaceChildren(...n))}}(t)}const ti=t=>"hypothesis-highlight"===t.tagName.toLowerCase();function ei(t){let e;return e=ti(t)?Array.from(t.children).filter(ti):Array.from(t.getElementsByTagName("hypothesis-highlight")).filter((t=>!t.parentElement||!ti(t.parentElement))),e}function ni(t,e="",n=0,i=0){for(const r of t){var o;const t=null!==(o=Yn.find((t=>r.classList.contains(t))))&&void 0!==o?o:"other-content",s=e&&t===e?i+1:0;r.setAttribute("data-nesting-level",`${n}`),r.setAttribute("data-cluster-level",`${s}`),r.svgHighlight&&(r.svgHighlight.setAttribute("data-nesting-level",`${n}`),r.svgHighlight.setAttribute("data-cluster-level",`${s}`)),ni(ei(r),t,n+1,s)}}function ii(t){var e
;return t.getAttribute("data-is-focused")?Number.MAX_SAFE_INTEGER:parseInt(null!==(e=t.getAttribute("data-nesting-level"))&&void 0!==e?e:"0",10)}function oi(t){const e=[];return t.forEach((({annotation:t,highlights:n})=>{if(null==n||!n.length)return;const{top:i,bottom:o}=function(t){const e=t.map((t=>t.getBoundingClientRect()));return e.reduce(((t,e)=>({top:Math.min(t.top,e.top),left:Math.min(t.left,e.left),bottom:Math.max(t.bottom,e.bottom),right:Math.max(t.right,e.right)})))}(n);i>=o||e.push({tag:t.$tag,top:i,bottom:o})})),e.sort(((t,e)=>t.top-e.top)),e}class ri{constructor({contentContainer:t,hostRPC:e}){i(this,"_hostRPC",void 0),i(this,"_updatePending",void 0),i(this,"_anchors",void 0),i(this,"_listeners",void 0),this._hostRPC=e,this._updatePending=!1,this._anchors=[],this._listeners=new o,this._listeners.add(window,"resize",(()=>this.update())),this._listeners.add(window,"scroll",(()=>this.update())),this._listeners.add(t,"scroll",(()=>this.update()),{capture:!0})}destroy(){this._listeners.removeAll()}
update(t){t&&(this._anchors=t),this._updatePending||(this._updatePending=!0,requestAnimationFrame((()=>{const t=oi(this._anchors);this._hostRPC.call("anchorsChanged",t),this._updatePending=!1})))}}class si extends CustomEvent{constructor(t){super("hypothesis:layoutchange",{bubbles:!0,cancelable:!1,detail:t})}}const ai=new Set;function li(...t){const e=t.join();ai.has(e)||(console.warn(...t),ai.add(e))}li.reset=()=>{ai.clear()};const ci=["styled_highlight_clusters"];class hi extends d{constructor(t=ci){super(),i(this,"_flags",void 0),i(this,"_knownFlags",void 0),this._flags=new Map,this._knownFlags=t}update(t){this._flags.clear();for(const[e,n]of Object.entries(t))this._flags.set(e,n);this.emit("flagsChanged")}flagEnabled(t){var e;return this._knownFlags.includes(t)?null!==(e=this._flags.get(t))&&void 0!==e&&e:(li("Looked up unknown feature",t),!1)}allFlags(){return Object.fromEntries(this._flags)}}function ui({cluster:t,label:e,onChange:n,currentStyles:i,highlightStyles:o}){const r=i[t],s="transparent"===r
;return ve("div",{className:"space-y-2",children:[ve("div",{className:"flex items-center gap-x-2 text-annotator-base",children:ve("div",{className:"grow text-color-text px-2 py-1 rounded",style:{backgroundColor:o[r].color},children:e})}),ve("div",{className:"flex items-center gap-x-2",children:Object.keys(o).map((e=>ve("div",{className:"relative",children:[ve("input",{className:ge("absolute w-6 h-6","opacity-[.00001]","cursor-pointer"),name:t,id:`hypothesis-${t}-${e}`,checked:r===e,onChange:n,type:"radio",value:e}),ve("label",{className:"block",htmlFor:`${t}-${e}`,children:[ve("div",{style:{backgroundColor:o[e].color},className:ge("block w-6 h-6 rounded-full flex items-center justify-center",{"border-2 border-slate-0":r!==e,"border-2 border-slate-3":r===e}),children:"transparent"===e&&ve(Fe,{className:ge("w-3 h-3",{"text-slate-3":!s,"text-slate-7":s})})}),ve("span",{className:"sr-only",children:e})]})]},`${t}-${e}`)))})]})}function di({active:t,availableStyles:e,currentStyles:n,onStyleChange:i}){
const o=Gt((t=>{const e=t.target,n=e.name,o=e.value;i(n,o)}),[i]),[r,s]=zt(!1);return t?ve(ye,{classes:"overflow-hidden",children:ve("div",{className:"flex flex-col text-annotator-base text-color-text",children:[ve(tn,{classes:"rounded-none","data-testid":"control-toggle-button",onClick:()=>s(!r),title:r?"Hide highlight settings":"Show highlight settings",children:ve(ht,r?{children:[ve(Te,{}),ve("span",{children:"Highlight Appearance"})]}:{children:[ve(Oe,{}),ve(Ve,{})]})}),r&&ve(xe,{"data-testid":"cluster-style-controls",size:"sm",children:[ve(ui,{highlightStyles:e,label:"My annotations",cluster:"user-annotations",onChange:o,currentStyles:n}),ve(ui,{highlightStyles:e,label:"My highlights",cluster:"user-highlights",onChange:o,currentStyles:n}),ve(ui,{highlightStyles:e,label:"Everybody's content",cluster:"other-content",onChange:o,currentStyles:n})]})]})}):null}const fi={transparent:{color:"transparent",secondColor:"transparent",thirdColor:"transparent"},pink:{color:"var(--hypothesis-color-pink)",
secondColor:"var(--hypothesis-color-pink-1)",thirdColor:"var(--hypothesis-color-pink-2)"},orange:{color:"var(--hypothesis-color-orange)",secondColor:"var(--hypothesis-color-orange-1)",thirdColor:"var(--hypothesis-color-orange-2)"},yellow:{color:"var(--hypothesis-color-yellow)",secondColor:"var(--hypothesis-color-yellow-1)",thirdColor:"var(--hypothesis-color-yellow-2)"},green:{color:"var(--hypothesis-color-green)",secondColor:"var(--hypothesis-color-green-1)",thirdColor:"var(--hypothesis-color-green-2)"},purple:{color:"var(--hypothesis-color-purple)",secondColor:"var(--hypothesis-color-purple-1)",thirdColor:"var(--hypothesis-color-purple-2)"},grey:{color:"var(--hypothesis-color-grey)",secondColor:"var(--hypothesis-color-grey-1)",thirdColor:"var(--hypothesis-color-grey-2)"}},pi={"other-content":"yellow","user-annotations":"orange","user-highlights":"purple"};class mi{constructor(t,e){i(this,"appliedStyles",void 0),i(this,"_container",void 0),i(this,"_element",void 0),i(this,"_features",void 0),
i(this,"_updateTimeout",void 0),this._element=t,this._features=e.features,this._container=new En("highlight-cluster-toolbar",(()=>this._render())),this._element.appendChild(this._container.element),Object.assign(this._container.element.style,{position:"fixed",top:`${this._element.offsetTop+4}px`,left:"4px"}),this.appliedStyles=pi,this._init(),this._features.on("flagsChanged",(()=>{this._activate(this._isActive())})),this._container.render()}destroy(){clearTimeout(this._updateTimeout),this._activate(!1),this._container.destroy()}scheduleClusterUpdates(){clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout((()=>this._updateClusters()),100)}_init(){for(const t of Object.keys(this.appliedStyles))this._setClusterStyles(t,this.appliedStyles[t]);this._activate(this._isActive())}_updateClusters(){this._isActive()&&Jn(this._element)}_isActive(){return this._features.flagEnabled("styled_highlight_clusters")}_activate(t){this._element.classList.toggle("hypothesis-highlights-clustered",t),
this._container.render()}_setClusterStyle(t,e){document.documentElement.style.setProperty(t,e)}_setClusterStyles(t,e){const n=fi[e];for(const e of Object.keys(n))this._setClusterStyle(`--hypothesis-${t}-${e}`,n[e])}_onChangeClusterStyle(t,e){this.appliedStyles[t]=e,this._setClusterStyles(t,e),this._container.render()}_render(){return ve(di,{active:this._isActive(),availableStyles:fi,currentStyles:this.appliedStyles,onStyleChange:(t,e)=>this._onChangeClusterStyle(t,e)})}}function gi(t){return t.split("").reverse().join("")}function _i(t){return(t|-t)>>31&1}function vi(t,e,n,i){let o=t.P[n],r=t.M[n];const s=i>>>31,a=e[n]|s,l=a|r,c=(a&o)+o^o|a;let h=r|~(c|o),u=o&c;const d=_i(h&t.lastRowMask[n])-_i(u&t.lastRowMask[n]);return h<<=1,u<<=1,u|=s,h|=_i(i)-s,o=u|~(l|h),r=h&l,t.P[n]=o,t.M[n]=r,d}function bi(t,e,n){if(0===e.length)return[];n=Math.min(n,e.length);const i=[],o=32,r=Math.ceil(e.length/o)-1,s={P:new Uint32Array(r+1),M:new Uint32Array(r+1),lastRowMask:new Uint32Array(r+1)};s.lastRowMask.fill(1<<31),
s.lastRowMask[r]=1<<(e.length-1)%o;const a=new Uint32Array(r+1),l=new Map,c=[];for(let t=0;t<256;t++)c.push(a);for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(l.has(n))continue;const i=new Uint32Array(r+1);l.set(n,i),n<c.length&&(c[n]=i);for(let t=0;t<=r;t+=1){i[t]=0;for(let r=0;r<o;r+=1){const s=t*o+r;if(s>=e.length)continue;e.charCodeAt(s)===n&&(i[t]|=1<<r)}}}let h=Math.max(0,Math.ceil(n/o)-1);const u=new Uint32Array(r+1);for(let t=0;t<=h;t+=1)u[t]=(t+1)*o;u[r]=e.length;for(let t=0;t<=h;t+=1)s.P[t]=-1,s.M[t]=0;for(let d=0;d<t.length;d+=1){const f=t.charCodeAt(d);let p;f<c.length?p=c[f]:(p=l.get(f),void 0===p&&(p=a));let m=0;for(let t=0;t<=h;t+=1)m=vi(s,p,t,m),u[t]+=m;if(u[h]-m<=n&&h<r&&(1&p[h+1]||m<0)){let t;if(h+=1,s.P[h]=-1,s.M[h]=0,h===r){const n=e.length%o;t=0===n?o:n}else t=o;u[h]=u[h-1]+t-m+vi(s,p,h,m)}else for(;h>0&&u[h]>=n+o;)h-=1;h===r&&u[h]<=n&&(u[h]<n&&i.splice(0,i.length),i.push({start:-1,end:d+1,errors:u[h]}),n=u[h])}return i}function yi(t,e,n){return function(t,e,n){const i=gi(e)
;return n.map((n=>{const o=Math.max(0,n.end-e.length-n.errors);return{start:bi(gi(t.slice(o,n.end)),i,n.errors).reduce(((t,e)=>n.end-e.end<t?n.end-e.end:t),n.end),end:n.end,errors:n.errors}}))}(t,e,bi(t,e,n))}function wi(t,e,n){let i=0;const o=[];for(;-1!==i;)i=t.indexOf(e,i),-1!==i&&(o.push({start:i,end:i+e.length,errors:0}),i+=1);return o.length>0?o:yi(t,e,n)}function xi(t,e){if(0===e.length||0===t.length)return 0;return 1-wi(t,e,e.length)[0].errors/e.length}function Ci(t,e,n={}){if(0===e.length)return null;const i=Math.min(256,e.length/2),o=wi(t,e,i);if(0===o.length)return null;const r=i=>{const o=1-i.errors/e.length,r=n.prefix?xi(t.slice(Math.max(0,i.start-n.prefix.length),i.start),n.prefix):1,s=n.suffix?xi(t.slice(i.end,i.end+n.suffix.length),n.suffix):1;let a=1;if("number"==typeof n.hint){a=1-Math.abs(i.start-n.hint)/t.length}return(50*o+20*r+20*s+2*a)/92},s=o.map((t=>({start:t.start,end:t.end,score:r(t)})));return s.sort(((t,e)=>e.score-t.score)),s[0]}function Si(t){const e=function(t){
const e=t.nodeName.toLowerCase();return"#text"===e?"text()":e}(t),n=function(t){let e=0,n=t;for(;n;)n.nodeName===t.nodeName&&(e+=1),n=n.previousSibling;return e}(t);return`${e}[${n}]`}function Ni(t,e){let n="",i=t;for(;i!==e;){if(!i)throw new Error("Node is not a descendant of root");n=Si(i)+"/"+n,i=i.parentNode}return n="/"+n,n=n.replace(/\/$/,""),n}function Ei(t,e,n){e=e.toUpperCase();let i=-1;for(let o=0;o<t.children.length;o++){const r=t.children[o];if(r.nodeName.toUpperCase()===e&&(++i,i===n))return r}return null}function Ai(t,e=document.body){try{return function(t,e){if(null===t.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/))throw new Error("Expression is not a simple XPath");const n=t.split("/");let i=e;n.shift();for(const t of n){let e,n;const o=t.indexOf("[");if(-1!==o){e=t.slice(0,o);const i=t.slice(o+1,t.indexOf("]"));if(n=parseInt(i)-1,n<0)return null}else e=t,n=0;const r=Ei(i,e,n);if(!r)return null;i=r}return i}(t,e)}catch(n){
return document.evaluate("."+t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}class Ti{constructor(t,e){i(this,"root",void 0),i(this,"range",void 0),this.root=t,this.range=e}static fromRange(t,e){return new Ti(t,e)}static fromSelector(t,e){const n=Ai(e.startContainer,t);if(!n)throw new Error("Failed to resolve startContainer XPath");const i=Ai(e.endContainer,t);if(!i)throw new Error("Failed to resolve endContainer XPath");const o=Dn.fromCharOffset(n,e.startOffset),r=Dn.fromCharOffset(i,e.endOffset),s=new Fn(o,r).toRange();return new Ti(t,s)}toRange(){return this.range}toSelector(){const t=Fn.fromRange(this.range).toRange(),e=Fn.fromRange(t),n=Ni(e.start.element,this.root),i=Ni(e.end.element,this.root);return{type:"RangeSelector",startContainer:n,startOffset:e.start.offset,endContainer:i,endOffset:e.end.offset}}}class ki{constructor(t,e,n){i(this,"root",void 0),i(this,"start",void 0),i(this,"end",void 0),this.root=t,this.start=e,this.end=n}static fromRange(t,e){
const n=Fn.fromRange(e).relativeTo(t);return new ki(t,n.start.offset,n.end.offset)}static fromSelector(t,e){return new ki(t,e.start,e.end)}toSelector(){return{type:"TextPositionSelector",start:this.start,end:this.end}}toRange(){return Fn.fromOffsets(this.root,this.start,this.end).toRange()}}class Ri{constructor(t,e,n={}){i(this,"root",void 0),i(this,"exact",void 0),i(this,"context",void 0),this.root=t,this.exact=e,this.context=n}static fromRange(t,e){const n=t.textContent,i=Fn.fromRange(e).relativeTo(t),o=i.start.offset,r=i.end.offset;return new Ri(t,n.slice(o,r),{prefix:n.slice(Math.max(0,o-32),o),suffix:n.slice(r,Math.min(n.length,r+32))})}static fromSelector(t,e){const{prefix:n,suffix:i}=e;return new Ri(t,e.exact,{prefix:n,suffix:i})}toSelector(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}toRange(t={}){return this.toPositionAnchor(t).toRange()}toPositionAnchor(t={}){const e=Ci(this.root.textContent,this.exact,{...this.context,hint:t.hint})
;if(!e)throw new Error("Quote not found");return new ki(this.root,e.start,e.end)}}function Pi(t){const e=parseFloat(t);return!Number.isFinite(e)||e<0?null:e}function Oi(t){return t instanceof Element?t:t.parentElement}function Mi(t,e=t){var n,i;const o=Pi(null!==(n=null==t?void 0:t.getAttribute("data-time-start"))&&void 0!==n?n:""),r=Pi(null!==(i=null==e?void 0:e.getAttribute("data-time-end"))&&void 0!==i?i:"");return"number"!=typeof o||"number"!=typeof r||r<o?null:[o,r]}class Ii{constructor(t,e,n){i(this,"root",void 0),i(this,"start",void 0),i(this,"end",void 0),this.root=t,this.start=e,this.end=n}static fromRange(t,e){var n,i;const o=Mi(null===(n=Oi(e.startContainer))||void 0===n?void 0:n.closest("[data-time-start]"),null===(i=Oi(e.endContainer))||void 0===i?void 0:i.closest("[data-time-end]"));if(!o)return null;const[r,s]=o;return new Ii(t,r,s)}toRange(){const t=[...this.root.querySelectorAll("[data-time-start]")].map((t=>{const e=Mi(t);if(!e)return null;const[n,i]=e;return{element:t,start:n,end:i}
})).filter((t=>null!==t));t.sort(((t,e)=>t.start-e.start));const e=function(t,e){for(let n=t.length-1;n>=0;n--)if(e(t[n]))return n;return-1}(t,(t=>t.start<=this.start&&t.end>=this.start));if(-1===e)throw new Error("Start segment not found");const n=e+t.slice(e).findIndex((t=>t.start<=this.end&&t.end>=this.end));if(-1===n)throw new Error("End segment not found");const i=new Range;i.setStart(t[e].element,0);const o=t[n].element;return i.setEnd(o,o.childNodes.length),i}static fromSelector(t,e){const{start:n,end:i}=e;return new Ii(t,n,i)}toSelector(){return{type:"MediaTimeSelector",start:this.start,end:this.end}}}async function Li(t,e){return t.toRange(e)}function Bi(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Can only intercept functions");return t[e]=(...e)=>{const o=i.call(t,...e);return n(...e),o},()=>{t[e]=i}}function Di(t){return t.replace(/#.*/,"")}class Fi{constructor(t,e=(()=>location.href)){i(this,"_listeners",void 0),i(this,"_unpatchHistory",void 0),this._listeners=new o;let n=e()
;const r=(i=e())=>{Di(n)!==Di(i)&&(n=i,t(i))},s=function(){const t=window.navigation;return"function"==typeof Navigation&&t instanceof Navigation?t:null}();if(s)this._listeners.add(s,"navigatesuccess",(()=>r()));else{const t=[Bi(window.history,"pushState",(()=>r())),Bi(window.history,"replaceState",(()=>r()))];this._unpatchHistory=()=>t.forEach((t=>t())),this._listeners.add(window,"popstate",(()=>r()))}}disconnect(){var t;null===(t=this._unpatchHistory)||void 0===t||t.call(this),this._listeners.removeAll()}}var Hi="complete",Vi="canceled";function Ui(t,e,n){t.self===t?t.scrollTo(e,n):(t.scrollLeft=e,t.scrollTop=n)}function qi(t){var e=t._scrollSettings;if(e){var n=e.maxSynchronousAlignments,i=function(t,e){var n,i,o,r,s,a,l,c=t.align,h=t.target.getBoundingClientRect(),u=c&&null!=c.left?c.left:.5,d=c&&null!=c.top?c.top:.5,f=c&&null!=c.leftOffset?c.leftOffset:0,p=c&&null!=c.topOffset?c.topOffset:0,m=u,g=d;if(t.isWindow(e))a=Math.min(h.width,e.innerWidth),l=Math.min(h.height,e.innerHeight),
i=h.left+e.pageXOffset-e.innerWidth*m+a*m,o=h.top+e.pageYOffset-e.innerHeight*g+l*g,i-=f,o-=p,i=t.align.lockX?e.pageXOffset:i,o=t.align.lockY?e.pageYOffset:o,r=i-e.pageXOffset,s=o-e.pageYOffset;else{a=h.width,l=h.height,n=e.getBoundingClientRect();var _=h.left-(n.left-e.scrollLeft),v=h.top-(n.top-e.scrollTop);i=_+a*m-e.clientWidth*m,o=v+l*g-e.clientHeight*g,i-=f,o-=p,i=Math.max(Math.min(i,e.scrollWidth-e.clientWidth),0),o=Math.max(Math.min(o,e.scrollHeight-e.clientHeight),0),i=t.align.lockX?e.scrollLeft:i,o=t.align.lockY?e.scrollTop:o,r=i-e.scrollLeft,s=o-e.scrollTop}return{x:i,y:o,differenceX:r,differenceY:s}}(e,t),o=Date.now()-e.startTime,r=Math.min(1/e.time*o,1);if(e.endIterations>=n)return Ui(t,i.x,i.y),t._scrollSettings=null,e.end(Hi);var s=1-e.ease(r);if(Ui(t,i.x-i.differenceX*s,i.y-i.differenceY*s),o>=e.time)return e.endIterations++,e.scrollAncestor&&qi(e.scrollAncestor),void qi(t);!function(t){if("requestAnimationFrame"in window)return window.requestAnimationFrame(t);setTimeout(t,16)}(qi.bind(null,t))
}}function Wi(t){return t.self===t}function zi(t){return"pageXOffset"in t||(t.scrollHeight!==t.clientHeight||t.scrollWidth!==t.clientWidth)&&"hidden"!==getComputedStyle(t).overflow}function $i(){return!0}function ji(t){if(t.assignedSlot)return ji(t.assignedSlot);if(t.parentElement)return"body"===t.parentElement.tagName.toLowerCase()?t.parentElement.ownerDocument.defaultView||t.parentElement.ownerDocument.ownerWindow:t.parentElement;if(t.getRootNode){var e=t.getRootNode();if(11===e.nodeType)return e.host}}var Xi=function(t,e,n){if(t){"function"==typeof e&&(n=e,e=null),e||(e={}),e.time=isNaN(e.time)?1e3:e.time,e.ease=e.ease||function(t){return 1-Math.pow(1-t,t/2)},e.align=e.align||{};var i=ji(t),o=1,r=e.validTarget||$i,s=e.isScrollable;e.debug&&(console.log("About to scroll to",t),i||console.error("Target did not have a parent, is it mounted in the DOM?"));for(var a=[];i;)if(e.debug&&console.log("Scrolling parent node",i),r(i,o)&&(s?s(i,zi):zi(i))&&(o++,a.push(i)),!(i=ji(i))){l(Hi);break}
return a.reduce(((n,i,o)=>function(t,e,n,i,o){var r,s=!e._scrollSettings,a=e._scrollSettings,l=Date.now(),c={passive:!0};function h(t){e._scrollSettings=null,e.parentElement&&e.parentElement._scrollSettings&&e.parentElement._scrollSettings.end(t),n.debug&&console.log("Scrolling ended with type",t,"for",e),o(t),r&&(e.removeEventListener("touchstart",r,c),e.removeEventListener("wheel",r,c))}a&&a.end(Vi);var u=n.maxSynchronousAlignments;return null==u&&(u=3),e._scrollSettings={startTime:l,endIterations:0,target:t,time:n.time,ease:n.ease,align:n.align,isWindow:n.isWindow||Wi,maxSynchronousAlignments:u,end:h,scrollAncestor:i},"cancellable"in n&&!n.cancellable||(r=h.bind(null,Vi),e.addEventListener("touchstart",r,c),e.addEventListener("wheel",r,c)),s&&qi(e),r}(t,i,e,a[o+1],l)),null)}function l(t){--o||n&&n(t)}},Yi=e(Xi);function Gi(t,e,n){return t+n*(e-t)}async function Ki(t,e,{maxDuration:n=500}={}){const i=t.scrollTop,o=e,r=Date.now(),s=Math.min(Math.abs(o-i)/3,n);let a=0;for(;a<1;)await new Promise((t=>{
requestAnimationFrame(t)})),a=Math.min(1,(Date.now()-r)/s),t.scrollTop=Gi(i,o,a)}function Zi(t,e=document.baseURI){return new URL(t,e).href.toString().replace(/#.*/,"")}class Qi{constructor(t={}){i(this,"document",void 0),this.document=t.document||document}uri(){let t=decodeURIComponent(this._getDocumentHref());const e=this._getLinks();for(const n of e)"canonical"===n.rel&&(t=n.href);return t}getDocumentMetadata(){const t={title:document.title,link:[],dc:this._getMetaTags("name","dc."),eprints:this._getMetaTags("name","eprints."),facebook:this._getMetaTags("property","og:"),highwire:this._getMetaTags("name","citation_"),prism:this._getMetaTags("name","prism."),twitter:this._getMetaTags("name","twitter:")},e=this._getFavicon();e&&(t.favicon=e),t.title=this._getTitle(t),t.link=this._getLinks(t);const n=t.link.find((t=>t.href.startsWith("urn:x-dc")));return n&&(t.documentFingerprint=n.href),t}_getMetaTags(t,e){const n={};for(const i of Array.from(this.document.querySelectorAll("meta"))){
const o=i.getAttribute(t),{content:r}=i;if(o&&r){const t=o.match(RegExp(`^${e}(.+)$`,"i"));if(t){const e=t[1].toLowerCase();n[e]?n[e].push(r):n[e]=[r]}}}return n}_getTitle(t){return t.highwire.title?t.highwire.title[0]:t.eprints.title?t.eprints.title[0]:t.prism.title?t.prism.title[0]:t.facebook.title?t.facebook.title[0]:t.twitter.title?t.twitter.title[0]:t.dc.title?t.dc.title[0]:this.document.title}_getLinks(t={dc:{},highwire:{}}){const e=[{href:this._getDocumentHref()}],n=Array.from(this.document.querySelectorAll("link"));for(const t of n)if(["alternate","canonical","bookmark","shortlink"].includes(t.rel)){if("alternate"===t.rel){if(t.type&&t.type.match(/^application\/(rss|atom)\+xml/))continue;if(t.hreflang)continue}try{const n=this._absoluteUrl(t.href);e.push({href:n,rel:t.rel,type:t.type})}catch(t){}}for(const n of Object.keys(t.highwire)){const i=t.highwire[n];if("pdf_url"===n)for(const t of i)try{e.push({href:this._absoluteUrl(t),type:"application/pdf"})}catch(t){}
if("doi"===n)for(let t of i)"doi:"!==t.slice(0,4)&&(t=`doi:${t}`),e.push({href:t})}for(const n of Object.keys(t.dc)){const i=t.dc[n];if("identifier"===n)for(const t of i)"doi:"===t.slice(0,4)&&e.push({href:t})}const i=t.dc["relation.ispartof"],o=t.dc.identifier;if(i&&o){const t=i[i.length-1],n=o[o.length-1],r="urn:x-dc:"+encodeURIComponent(t)+"/"+encodeURIComponent(n);e.push({href:r})}return e}_getFavicon(){let t=null;for(const e of Array.from(this.document.querySelectorAll("link")))if(["shortcut icon","icon"].includes(e.rel))try{t=this._absoluteUrl(e.href)}catch(t){}return t}_absoluteUrl(t){return Zi(t,this.document.baseURI)}_getDocumentHref(){const{href:t}=this.document.location,e=["http:","https:","file:"],n=new URL(t).protocol;return e.includes(n)?t:this.document.baseURI&&e.includes(new URL(this.document.baseURI).protocol)?this.document.baseURI:t}}class Ji extends d{constructor({features:t,container:e=document.body,sideBySideOptions:n}){super(),i(this,"container",void 0),i(this,"features",void 0),
i(this,"_flagsChanged",void 0),i(this,"_htmlMeta",void 0),i(this,"_prevURI",void 0),i(this,"_sideBySideOptions",void 0),i(this,"_sideBySideEnabled",void 0),i(this,"_sideBySideActive",void 0),i(this,"_lastLayout",void 0),i(this,"_navObserver",void 0),i(this,"_metaObserver",void 0),this.features=t,this.container=e,this._htmlMeta=new Qi,this._prevURI=this._htmlMeta.uri(),this._sideBySideEnabled=!0,this._sideBySideOptions=null!=n?n:{mode:"auto"},this._sideBySideActive=!1,this._lastLayout=null,this._navObserver=new Fi((()=>this._checkForURIChange())),this._metaObserver=new MutationObserver((()=>this._checkForURIChange())),this._metaObserver.observe(document.head,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["rel","href","name","content"]}),this._flagsChanged=()=>{},this.features.on("flagsChanged",this._flagsChanged)}anchor(t,e){return function(t,e,n={}){let i=null,o=null,r=null,s=null;for(const t of e)switch(t.type){case"TextPositionSelector":o=t,n.hint=o.start;break;case"TextQuoteSelector":r=t;break
;case"RangeSelector":s=t;break;case"MediaTimeSelector":i=t}const a=t=>{var e;if(null!==(e=r)&&void 0!==e&&e.exact&&t.toString()!==r.exact)throw new Error("quote mismatch");return t};let l=Promise.reject("unable to anchor");if(s){const e=s;l=l.catch((()=>Li(Ti.fromSelector(t,e),n).then(a)))}if(o){const e=o;l=l.catch((()=>Li(ki.fromSelector(t,e),n).then(a)))}if(r){const e=r;l=l.catch((()=>Li(Ri.fromSelector(t,e),n)))}if(i){const e=i;l=l.catch((()=>Ii.fromSelector(t,e).toRange()))}return l}(t,e)}describe(t,e){return function(t,e){const n=[Ii,Ti,ki,Ri],i=[];for(const o of n)try{const n=o.fromRange(t,e);n&&i.push(n.toSelector())}catch(t){}return i}(t,e)}_checkForURIChange(){const t=this._htmlMeta.uri();t!==this._prevURI&&(this._prevURI=t,this.emit("uriChanged",t))}getAnnotatableRange(t){try{return Fn.trimmedRange(t)}catch(t){if(t instanceof RangeError)return null;throw t}}canStyleClusteredHighlights(){return!0}destroy(){this._deactivateSideBySide(),this._navObserver.disconnect(),this._metaObserver.disconnect(),
this.features.off("flagsChanged",this._flagsChanged)}contentContainer(){return this.container}fitSideBySide(t){this._lastLayout=t;const e=window.innerWidth-t.width,n=this._sideBySideEnabled&&"auto"===this._sideBySideOptions.mode&&t.expanded&&e>=480;return n?this._activateSideBySide(t.width):this._sideBySideActive&&this._deactivateSideBySide(),this._sideBySideActive=n,this.container.classList.toggle("hypothesis-sidebyside-active",this._sideBySideActive),n}sideBySideActive(){return this._sideBySideActive}_activateSideBySide(t){const e=t+12,n=t=>parseInt(window.getComputedStyle(t).marginLeft,10);q((()=>{document.body.style.marginLeft="",document.body.style.marginRight="";const t=n(document.body);document.body.style.marginRight=`${e}px`;const i=function(t){const e=new Map,n=new Map,i=B.join(","),o=Array.from(t.querySelectorAll(i)).map((t=>({rect:t.getBoundingClientRect(),textLength:t.textContent.length}))).filter((({rect:t})=>t.width>0&&t.height>0)).sort(((t,e)=>e.textLength-t.textLength)).slice(0,15)
;if(o.forEach((({rect:t})=>{var i,o;let r=null!==(i=e.get(t.left))&&void 0!==i?i:0;r+=1,e.set(t.left,r);let s=null!==(o=n.get(t.right))&&void 0!==o?o:0;s+=1,n.set(t.right,s)})),0===e.size||0===n.size)return null;const r=[...e.entries()].sort(((t,e)=>e[1]-t[1])),s=[...n.entries()].sort(((t,e)=>e[1]-t[1])),[a]=r[0],[l]=s[0];return{left:a,right:l}}(document.body);if(i){const o=Math.max(0,window.innerWidth-e-i.right);if(o>0){const t=Math.max(0,e-o);document.body.style.marginRight=`${t}px`}n(document.body)>t&&(document.body.style.marginLeft=`${t}px`),i.left<12&&(document.body.style.marginLeft="12px")}else document.body.style.marginLeft="",document.body.style.marginRight=""}))}_deactivateSideBySide(){q((()=>{document.body.style.marginLeft="",document.body.style.marginRight=""}))}async getMetadata(){return this._htmlMeta.getDocumentMetadata()}async uri(){return this._htmlMeta.uri()}async scrollToAnchor(t){var e;const n=null===(e=t.highlights)||void 0===e?void 0:e[0];n&&await async function(t,{maxDuration:e=500}={}){
const n=t.closest("body");n&&"BODY"!==n.tagName&&Object.defineProperty(n,"tagName",{value:"BODY",configurable:!0});const i=t.closest("details");i&&!i.hasAttribute("open")&&(i.open=!0),await new Promise((n=>Yi(t,{time:e},n)))}(n)}}var to=NaN,eo="[object Symbol]",no=/^\s+|\s+$/g,io=/^[-+]0x[0-9a-f]+$/i,oo=/^0b[01]+$/i,ro=/^0o[0-7]+$/i,so=parseInt,ao="object"==typeof t&&t&&t.Object===Object&&t,lo="object"==typeof self&&self&&self.Object===Object&&self,co=ao||lo||Function("return this")(),ho=Object.prototype.toString,uo=Math.max,fo=Math.min,po=function(){return co.Date.now()};function mo(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function go(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&ho.call(t)==eo}(t))return to;if(mo(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=mo(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(no,"");var n=oo.test(t);return n||ro.test(t)?so(t.slice(2),n?2:8):io.test(t)?to:+t}
var _o=function(t,e,n){var i,o,r,s,a,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function f(e){var n=i,r=o;return i=o=void 0,c=e,s=t.apply(r,n)}function p(t){var n=t-l;return void 0===l||n>=e||n<0||u&&t-c>=r}function m(){var t=po();if(p(t))return g(t);a=setTimeout(m,function(t){var n=e-(t-l);return u?fo(n,r-(t-c)):n}(t))}function g(t){return a=void 0,d&&i?f(t):(i=o=void 0,s)}function _(){var t=po(),n=p(t);if(i=arguments,o=this,l=t,n){if(void 0===a)return function(t){return c=t,a=setTimeout(m,e),h?f(t):s}(l);if(u)return a=setTimeout(m,e),f(l)}return void 0===a&&(a=setTimeout(m,e)),s}return e=go(e)||0,mo(n)&&(h=!!n.leading,r=(u="maxWait"in n)?uo(go(n.maxWait)||0,e):r,d="trailing"in n?!!n.trailing:d),_.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=o=a=void 0},_.flush=function(){return void 0===a?s:g(po())},_},vo=e(_o);function bo(t,e,n,i=0){let o=i;for(;o<t.length&&e>0;)n(t[o])&&--e,++o;return o}function yo(t,e,n,i){let o=0;for(let r=n;r<i;r++)e(t[r])&&++o
;return o}function wo(t,e,n,i,o){const r=yo(t,o,0,n),s=yo(t,o,n,i);let a=bo(e,r,o);for(;a<e.length&&!o(e[a]);)++a;return[a,bo(e,s,o,a)]}const xo={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3},Co=new Map,So=new Map;function No(t,e){return`${t}:${e}`}function Eo(t){var e;const n="closest"in t?t:t.parentElement;return null!==(e=null==n?void 0:n.closest(".textLayer"))&&void 0!==e?e:null}function Ao(){return PDFViewerApplication.pdfViewer}async function To(t){const e=Ao();let n=e.getPageView(t);return n&&n.pdfPage||(n=await new Promise((n=>{const i=()=>{e.eventBus?e.eventBus.off("pagesloaded",i):document.removeEventListener("pagesloaded",i),n(e.getPageView(t))};e.eventBus?e.eventBus.on("pagesloaded",i):document.addEventListener("pagesloaded",i)}))),n}function ko(t){const e=Co.get(t);if(e)return e;const n=(async()=>{const e=await To(t);return(await e.pdfPage.getTextContent({normalizeWhitespace:!0})).items.map((t=>t.str)).join("")})();return Co.set(t,n),n}async function Ro(t){const e=Ao();let n=0,i=0,o=""
;for(let r=0;r<e.pagesCount;r++)if(o=await ko(r),n=i,i+=o.length,i>=t)return{index:r,offset:n,text:o};return{index:e.pagesCount-1,offset:n,text:o}}function Po(t){switch(t){case" ":case"\f":case"\n":case"\r":case"\t":case"\v":case" ":return!0;default:return!1}}const Oo=t=>!Po(t);async function Mo(t,e,n){const[i,o]=await Promise.all([To(t),ko(t)]);if(i.renderingState===xo.FINISHED&&i.textLayer&&i.textLayer.renderingDone){var r;const t=null!==(r=i.textLayer.textLayerDiv)&&void 0!==r?r:i.textLayer.div;if(!t)throw new Error("Unable to find PDF.js text layer root");const s=t.textContent,[a,l]=wo(o,s,e,n,Oo);Io(s.slice(a,l))!==Io(o.slice(e,n))&&li("Text layer text does not match page text. Highlights will be mis-aligned.");const c=new Dn(t,a),h=new Dn(t,l);return new Fn(c,h).toRange()}const s=function(t){let e=t.querySelector(Hn);return e||(e=document.createElement("span"),e.classList.add("annotator-placeholder"),e.textContent="Loading annotations...",t.appendChild(e),e)}(i.div),a=document.createRange()
;return a.setStartBefore(s),a.setEndAfter(s),a}function Io(t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Po(i)||(e+=i)}return e}async function Lo(t,e){const n=e.find((t=>"TextQuoteSelector"===t.type));if(!n)throw new Error("No quote selector found");const i=e.find((t=>"TextPositionSelector"===t.type));if(i){try{const{index:t,offset:e,text:o}=await Ro(i.start),r=i.start-e,s=i.end-e,a=o.substring(r,s);if(n.exact!==a)throw new Error("quote mismatch");return await Mo(t,r,s)}catch{}try{const t=No(n.exact,i.start),e=So.get(t);if(e){const{pageIndex:t,anchor:n}=e;return await Mo(t,n.start,n.end)}}catch{}}return async function(t,e){const n=Ao().pagesCount,i=Array(n).fill(0).map(((t,e)=>e));let o,r;if(e){const{index:t,offset:n}=await Ro(e);o=t,r=e-n,i.sort(((e,n)=>Math.abs(e-t)-Math.abs(n-t)))}const s=void 0!==t.prefix?Io(t.prefix):void 0,a=void 0!==t.suffix?Io(t.suffix):void 0,l=Io(t.exact);let c;for(const t of i){const e=await ko(t),n=Io(e);let i
;void 0!==o&&void 0!==r&&(t<o?i=n.length:t===o?[i]=wo(e,n,r,r,Oo):i=0);const h=Ci(n,l,{prefix:s,suffix:a,hint:i});if(h&&(!c||h.score>c.match.score)){const[i,o]=wo(n,e,h.start,h.end,Oo);c={page:t,match:{start:i,end:o,score:h.score}};const r=n.slice(h.start,h.end)===l,u=void 0!==s&&n.slice(Math.max(0,h.start-s.length),h.start)===s,d=void 0!==a&&n.slice(h.end,a.length)===a;if(r&&(u||d||void 0===s&&void 0===a))break}}if(c){const{page:n,match:i}=c;if(e){const o=No(t.exact,e);So.set(o,{pageIndex:n,anchor:i})}return Mo(n,i.start,i.end)}throw new Error("Quote not found")}(n,null==i?void 0:i.start)}function Bo(t){try{t=Fn.fromRange(t).toRange()}catch{throw new Error("Selection does not contain text")}const e=Eo(t.startContainer),n=Eo(t.endContainer);if(!e||!n)throw new Error("Selection is outside page text");if(e!==n)throw new Error("Selecting across page breaks is not supported");return[t,e]}async function Do(t,e){var n
;const[i,o]=Bo(e),r=Dn.fromPoint(i.startContainer,i.startOffset).relativeTo(o),s=Dn.fromPoint(i.endContainer,i.endOffset).relativeTo(o),a=function(t){let e=0;for(;t.previousSibling;)++e,t=t.previousSibling;return e}(o.parentNode),l=a+1,c=await async function(t){if(t>=Ao().pagesCount)throw new Error("Invalid page index");let e=0;for(let n=0;n<t;n++)e+=(await ko(n)).length;return e}(a),h=await To(a);return[{type:"TextPositionSelector",start:c+r.offset,end:c+s.offset},Ri.fromRange(t,i).toSelector(),{type:"PageSelector",index:a,label:null!==(n=h.pageLabel)&&void 0!==n?n:l.toString()}]}function Fo({children:t}){return ve("div",{className:"flex flex-col",children:t})}function Ho({info:t}){let e=t.item.title;return t.item.subtitle&&(e+=`: ${t.item.subtitle}`),ve("div",{className:ge("h-10 bg-white px-4 text-slate-7 text-annotator-base border-b","grid items-center","grid-cols-[100px_minmax(0,auto)]","2xl:grid-cols-[100px_minmax(0,auto)_minmax(0,auto)] 2xl:gap-x-3"),children:[ve("div",{"data-testid":"content-logo",
children:t.logo&&ve(_n,{href:t.logo.link,target:"_blank","data-testid":"logo-link",underline:"none",children:ve("img",{alt:t.logo.title,src:t.logo.logo,"data-testid":"logo-image"})})}),ve("div",{className:ge("hidden","2xl:block 2xl:whitespace-nowrap 2xl:overflow-hidden 2xl:text-ellipsis","font-semibold"),"data-testid":"content-container-info",title:t.container.title,children:t.container.title}),ve("div",{className:ge("flex justify-center items-center gap-x-2"),"data-testid":"content-item-info",children:[ve("div",{className:ge("hidden","2xl:block 2xl:grow")}),t.links.previousItem&&ve(ht,{children:[ve(_n,{title:"Open previous item",href:t.links.previousItem,underline:"always",target:"_blank","data-testid":"content-previous-link",children:ve("div",{className:"flex gap-x-1 items-center text-annotator-sm whitespace-nowrap",children:[ve(Re,{className:"w-em h-em"}),ve("span",{children:"Previous"})]})}),ve("div",{className:"text-annotator-sm",children:"|"})]}),ve("div",{
className:ge("min-w-0 whitespace-nowrap overflow-hidden text-ellipsis shrink font-medium"),children:ve(_n,{title:e,href:t.links.currentItem,"data-testid":"content-item-link",target:"_blank",unstyled:!0,children:e})}),t.links.nextItem&&ve(ht,{children:[ve("div",{className:"text-annotator-sm",children:"|"}),ve(_n,{title:"Open next item",href:t.links.nextItem,underline:"always",target:"_blank","data-testid":"content-next-link",children:ve("div",{className:"flex gap gap-x-1 items-center text-annotator-sm whitespace-nowrap",children:[ve("span",{children:"Next"}),ve(Oe,{className:"w-em h-em"})]})})]})]})]})}function Vo(){return ve("div",{className:"bg-white",role:"alert",children:ve("div",{className:ge("flex items-center gap-x-2","border border-yellow-notice bg-yellow-notice/10 text-annotator-base"),children:[ve("div",{className:"bg-yellow-notice text-white p-2",children:ve(Ie,{className:"text-annotator-xl"})}),ve("div",{children:[ve("strong",{children:"This PDF does not contain selectable text:"})," ",ve(_n,{
target:"_blank",href:"https://web.hypothes.is/help/how-to-ocr-optimize-pdfs/",underline:"always",children:"Learn how to fix this"})," ","in order to annotate with Hypothesis."]})]})})}class Uo{constructor(t){i(this,"_loaded",void 0),this._loaded=function(t){return t.initializedPromise?t.initializedPromise:t.initialized?Promise.resolve():new Promise((e=>{const n=setInterval((()=>{t.initialized&&(clearTimeout(n),e())}),5)}))}(t).then((()=>t.downloadComplete?t:new Promise((e=>{const n=()=>{t.eventBus?(t.eventBus.off("documentload",n),t.eventBus.off("documentloaded",n)):window.removeEventListener("documentload",n),e(t)};t.eventBus?(t.eventBus.on("documentloaded",n),t.eventBus.on("documentload",n)):window.addEventListener("documentload",n)}))))}getUri(){return this._loaded.then((t=>{let e=zo(t);return e||(e=Wo(qo(t))),e}))}async getMetadata(){const t=await this._loaded,{info:e,contentDispositionFilename:n,metadata:i}=await t.pdfDocument.getMetadata(),o=qo(t),r=zo(t);let s
;s=null!=i&&i.has("dc:title")&&"Untitled"!==i.get("dc:title")?i.get("dc:title"):null!=e&&e.Title?e.Title:n||(r?function(t){const e=new URL(t),n=e.pathname.split("/");return n[n.length-1]}(r):"");const a=[{href:Wo(o)}];return r&&a.push({href:r}),{title:s,link:a,documentFingerprint:o}}}function qo(t){return Array.isArray(t.pdfDocument.fingerprints)?t.pdfDocument.fingerprints[0]:t.pdfDocument.fingerprint}function Wo(t){return`urn:x-pdf:${t}`}function zo(t){if(!t.url)return null;const e=Zi(t.url);return 0!==e.indexOf("file://")?e:null}function $o(t){var e;const n=null===(e=t.highlights)||void 0===e?void 0:e[0];return n&&Vn(n)}function jo(t){return new Promise((e=>setTimeout(e,t)))}class Xo{constructor(){i(this,"_pdfjsContainer",void 0),i(this,"_container",void 0),i(this,"_contentInfo",void 0),i(this,"_noTextWarning",void 0),this._pdfjsContainer=document.querySelector("#outerContainer"),this._contentInfo=null,this._noTextWarning=!1,this._container=null}setContentInfo(t){this._contentInfo=t,this._update()}
showNoTextWarning(t){this._noTextWarning=t,this._update()}destroy(){var t;null===(t=this._container)||void 0===t||t.destroy()}_update(){var t;if(!(this._noTextWarning||this._contentInfo))return null===(t=this._container)||void 0===t||t.destroy(),this._container=null,void(this._pdfjsContainer.style.height="");this._container||(this._container=new En("banner",(()=>this._render())),document.body.prepend(this._container.element)),this._container.render();const e=this._container.element.getBoundingClientRect().height;this._pdfjsContainer.style.height=`calc(100% - ${e}px)`}_render(){return ve(Fo,{children:[this._contentInfo&&ve(Ho,{info:this._contentInfo}),this._noTextWarning&&ve(Vo,{})]})}}class Yo extends d{constructor(t,e={}){var n,r,s;super(),i(this,"_annotator",void 0),i(this,"_banner",void 0),i(this,"_destroyed",void 0),i(this,"_listeners",void 0),i(this,"_observer",void 0),i(this,"_pdfContainer",void 0),i(this,"_pdfMetadata",void 0),i(this,"_pdfViewer",void 0),i(this,"_reanchoringMaxWait",void 0),
i(this,"_updateAnnotationLayerVisibility",void 0),i(this,"_sideBySideActive",void 0),this._annotator=t;const a=window,l=a.PDFViewerApplication;this._pdfViewer=l.pdfViewer,this._pdfViewer.viewer.classList.add("has-transparent-text-layer"),this._pdfContainer=null!==(n=null===(r=l.appConfig)||void 0===r?void 0:r.appContainer)&&void 0!==n?n:document.body,this._pdfMetadata=new Uo(l),this._observer=new MutationObserver(vo((()=>this._update()),100)),this._observer.observe(this._pdfViewer.viewer,{attributes:!0,attributeFilter:["data-loaded"],childList:!0,subtree:!0}),this._reanchoringMaxWait=null!==(s=e.reanchoringMaxWait)&&void 0!==s?s:3e3,this._banner=new Xo,this._checkForSelectableText(),this._sideBySideActive=!1,this._updateAnnotationLayerVisibility=()=>{const t=a.getSelection();this._pdfViewer.viewer.classList.toggle("is-selecting",!t.isCollapsed)},this._listeners=new o,this._listeners.add(document,"selectionchange",this._updateAnnotationLayerVisibility),this._destroyed=!1}destroy(){this.fitSideBySide({
expanded:!1,width:0,toolbarWidth:0,height:window.innerHeight}),this._listeners.removeAll(),this._pdfViewer.viewer.classList.remove("has-transparent-text-layer"),this._observer.disconnect(),this._banner.destroy(),this._destroyed=!0}uri(){return this._pdfMetadata.getUri()}getMetadata(){return this._pdfMetadata.getMetadata()}showContentInfo(t){this._banner.setContentInfo(t)}anchor(t,e){return Lo(0,e)}getAnnotatableRange(t){try{const e=Fn.trimmedRange(t);if(function(t){try{return Bo(t),!0}catch{return!1}}(e))return e}catch(t){if(!(t instanceof RangeError))throw t}return null}canStyleClusteredHighlights(){return!0}describe(t,e){return Do(t,e)}async _checkForSelectableText(){try{await this.uri()}catch(t){return}if(!this._destroyed)try{const t=await async function(){const t=Ao();let e=!1;for(let n=0;n<t.pagesCount;n++)if((await ko(n)).trim().length>0){e=!0;break}return e}();this._banner.showNoTextWarning(!t)}catch(t){console.warn("Unable to check for text in PDF:",t)}}_update(){
const t=[],e=this._pdfViewer.pagesCount;for(let t=0;t<e;t++){var n;const e=this._pdfViewer.getPageView(t);if(null!=e&&null!==(n=e.textLayer)&&void 0!==n&&n.renderingDone)switch(e.renderingState){case xo.INITIAL:e.textLayer=null;break;case xo.FINISHED:i=e.div,o=void 0,null===(o=i.querySelector(Hn))||void 0===o||o.remove()}}var i,o;for(const e of this._annotator.anchors)if(e.highlights){if(t.includes(e.annotation))continue;for(let n=0;n<e.highlights.length;n++){const i=e.highlights[n];if(!document.body.contains(i)){e.highlights.splice(n,1),delete e.range,t.push(e.annotation);break}}}t.map((t=>this._annotator.anchor(t)))}contentContainer(){return document.querySelector("#viewerContainer")}fitSideBySide(t){const e=window.innerWidth-t.width,n=t.expanded&&e>=680,i=n?t.width:t.toolbarWidth;this._pdfContainer.style.width=`calc(100% - ${i}px)`;const o=this._pdfViewer.currentScaleValue;return"auto"!==o&&"page-fit"!==o&&"page-width"!==o||(this._pdfViewer.currentScaleValue=o),this._pdfViewer.update(),
this._sideBySideActive=n,n}sideBySideActive(){return this._sideBySideActive}async scrollToAnchor(t){const e=t.annotation,n=$o(t),i=this._anchorOffset(t);if(null!==i&&(await Ki(this.contentContainer(),i),n)){const t=await this._waitForAnnotationToBeAnchored(e,this._reanchoringMaxWait);if(!t)return;const n=this._anchorOffset(t);if(null===n)return;await Ki(this.contentContainer(),n)}}async _waitForAnnotationToBeAnchored(t,e){var n;const i=Date.now();let o;do{o=this._annotator.anchors.find((e=>e.annotation===t)),o&&!$o(o)||(o=null,await jo(20))}while(!o&&Date.now()-i<e);return null!==(n=o)&&void 0!==n?n:null}_anchorOffset(t){if(!t.highlights)return null;return function(t,e){let n=0;for(;t!==e&&e.contains(t);)n+=t.offsetTop,t=t.offsetParent;return n}(t.highlights[0],this.contentContainer())}}function Go(t){if(!t.includes("["))return t;let e="",n=!1,i=!1;for(const o of t)n||"^"!==o?(n||"["!==o?!n&&i&&"]"===o?i=!1:i||(e+=o):i=!0,n=!1):n=!0;return e}function Ko(t){const e=Go(t),n=e.indexOf("!")
;return-1===n?e:e.slice(0,n)}class Zo{constructor(t,e,n){i(this,"_element",void 0),i(this,"_onFrameAdded",void 0),i(this,"_onFrameRemoved",void 0),i(this,"_annotatableFrames",void 0),i(this,"_isDisconnected",void 0),i(this,"_mutationObserver",void 0),this._element=t,this._onFrameAdded=e,this._onFrameRemoved=n,this._annotatableFrames=new Set,this._isDisconnected=!1,this._mutationObserver=new MutationObserver(vo((()=>{this._discoverFrames()}),40)),this._discoverFrames(),this._mutationObserver.observe(this._element,{childList:!0,subtree:!0,attributeFilter:["enable-annotation"]})}disconnect(){this._isDisconnected=!0,this._mutationObserver.disconnect()}async _addFrame(t){this._annotatableFrames.add(t);try{if(await Qo(t),this._isDisconnected)return;t.contentWindow.addEventListener("unload",(()=>{this._removeFrame(t)})),this._onFrameAdded(t)}catch(e){console.warn(`Unable to inject the Hypothesis client (from '${document.location.href}' into a cross-origin frame '${t.src}')`)}}_removeFrame(t){
this._annotatableFrames.delete(t),this._onFrameRemoved(t)}_discoverFrames(){const t=new Set(this._element.querySelectorAll("iframe[enable-annotation]"));for(const e of t)this._annotatableFrames.has(e)||this._addFrame(e);for(const e of this._annotatableFrames)t.has(e)||this._removeFrame(e)}}function Qo(t){return new Promise(((e,n)=>{const i=Jo(t,((t,o)=>{i(),o?e(o):n(t)}))}))}function Jo(t,e,{pollInterval:n=10}={}){let i,o;const r=new WeakSet,s=()=>{clearTimeout(i),i=void 0},a=()=>{const n=t.contentDocument;if(n){if(!r.has(n)){if(r.add(n),s(),!function(t){var e;return"about:blank"===(null===(e=t.contentDocument)||void 0===e?void 0:e.location.href)&&t.hasAttribute("src")&&"about:blank"!==t.src}(t)){"interactive"===n.readyState||"complete"===n.readyState?e(null,n):n.addEventListener("DOMContentLoaded",(()=>e(null,n)))}var i;t.contentDocument&&(null===(i=t.contentWindow)||void 0===i||i.addEventListener("unload",o))}}else{s();const n=t.isConnected?"Frame is cross-origin":"Frame is disconnected";e(new Error(n))}}
;let l=!1;o=()=>{s(),l||(i=setInterval(a,n))},t.addEventListener("load",a);const c=setTimeout(a,0);return()=>{l=!0,clearTimeout(c),s(),t.removeEventListener("load",a)}}class tr{constructor(t,e){i(this,"_config",void 0),i(this,"_frameObserver",void 0),this._config=e,this._frameObserver=new Zo(t,(t=>er(t,e)),(()=>{}))}destroy(){this._frameObserver.disconnect()}}async function er(t,e,n){if(null!==t.contentDocument.querySelector("script.js-hypothesis-config"))return;await Qo(t);const{assetRoot:i,notebookAppUrl:o,profileAppUrl:r,sidebarAppUrl:a}=N(document),l={...e,assetRoot:i,notebookAppUrl:o,profileAppUrl:r,sidebarAppUrl:a,subFrameIdentifier:null!=n?n:s(10)},c=document.createElement("script");c.className="js-hypothesis-config",c.setAttribute("data-remove-on-unload",""),c.type="application/json",c.innerText=JSON.stringify(l);const h=document.createElement("script");h.async=!0,h.src=e.clientUrl;const u=t.contentDocument;u.body.appendChild(c),u.body.appendChild(h)}class nr{constructor(t,e,n){
if(i(this,"container",void 0),i(this,"_imageSizeObserver",void 0),i(this,"_listeners",void 0),i(this,"_updateTextLayerSize",void 0),e.length!==n.length)throw new Error("Char boxes length does not match text length");const r=t.parentNode,s=document.createElement("hypothesis-text-layer");r.insertBefore(s,t.nextSibling),r.style.position="relative",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.color="transparent",s.style.textAlign="left",s.style.mixBlendMode="multiply";const a="sans-serif";s.style.fontSize="16px",s.style.fontFamily=a;const l=document.createElement("canvas").getContext("2d");l.font=`16px ${a}`;const c=(t,e,n="px")=>`calc(var(--${t}-scale) * ${e}${n})`,h=function(t,e){const n=[];let i={text:"",rect:new DOMRect};const o=()=>{i.text.length>0&&(n.push(i),i={text:"",rect:new DOMRect})};for(const[n,r]of t.entries()){const t=e[n],s=/\s/.test(t);i.text.length>0&&!R(i.rect,r)&&o(),i.rect=O(i.rect,r),i.text+=s?" ":t,s&&o()}o();const r=[];let s={words:[],rect:new DOMRect};const a=()=>{
s.words.length>0&&(r.push(s),s={words:[],rect:new DOMRect})};for(const t of n){const e=s.words[s.words.length-1];if(e){const n=M(e.rect),i=M(t.rect).x-n.x;(!R(e.rect,t.rect)||i<0)&&a()}s.words.push(t),s.rect=O(s.rect,t.rect)}a();const l=[];let c={lines:[],rect:new DOMRect};const h=()=>{c.lines.length>0&&(l.push(c),c={lines:[],rect:new DOMRect})};for(const t of r){const e=c.lines[c.lines.length-1];if(e){const n=M(e.rect),i=M(t.rect).y-n.y;(!P(e.rect,t.rect)||R(e.rect,t.rect)||i<0||i>4*t.rect.height)&&h()}c.lines.push(t),c.rect=O(c.rect,t.rect)}return h(),l}(e,n);for(const t of h){const e=document.createElement("hypothesis-text-column");e.style.display="block",e.style.position="absolute",e.style.left=c("x",t.rect.left),e.style.top=c("y",t.rect.top);let n=null;for(const i of t.lines){const o=document.createElement("hypothesis-text-line");o.style.display="block",o.style.marginLeft=c("x",i.rect.left-t.rect.left),o.style.height=c("y",i.rect.height),n&&(o.style.marginTop=c("y",i.rect.top-n.rect.bottom)),n=i,
o.style.whiteSpace="nowrap";let r=null;for(const t of i.words){const e=document.createElement("hypothesis-text-word");e.style.display="inline-block",e.style.transformOrigin="top left",e.textContent=t.text,r&&(e.style.marginLeft=c("x",t.rect.left-r.rect.right)),r=t,e.style.width=c("x",t.rect.width),e.style.height=c("y",t.rect.height),e.style.whiteSpace="pre";const n=l.measureText(t.text),i=c("x",t.rect.width/n.width,""),s=c("y",t.rect.height/16,"");e.style.transform=`scale(${i}, ${s})`,o.append(e)}e.append(o)}s.append(e)}const u=()=>{const{width:e,height:n}=t.getBoundingClientRect();s.style.width=e+"px",s.style.height=n+"px",s.style.setProperty("--x-scale",`${e}`),s.style.setProperty("--y-scale",`${n}`)};u(),this.container=s,this._updateTextLayerSize=vo(u,{maxWait:50}),this._listeners=new o,"undefined"!=typeof ResizeObserver&&(this._imageSizeObserver=new ResizeObserver((()=>{this._updateTextLayerSize()})),this._imageSizeObserver.observe(t)),this._listeners.add(window,"resize",this._updateTextLayerSize)}
updateSync(){this._updateTextLayerSize(),this._updateTextLayerSize.flush()}destroy(){var t;this.container.remove(),this._listeners.removeAll(),this._updateTextLayerSize.cancel(),null===(t=this._imageSizeObserver)||void 0===t||t.disconnect()}}function ir(t=document){return t.querySelector("mosaic-book")}function or(t=window){var e;if(ir(t.document))return"container";const n=null===(e=t.frameElement)||void 0===e?void 0:e.ownerDocument;return n&&ir(n)?"content":null}class rr{constructor(t){i(this,"_frameObserver",void 0);const e=ir();if(!e)throw new Error("Book container element not found");const n=new WeakSet,o=e.shadowRoot,r=()=>{const e=o.querySelector("iframe");e&&!n.has(e)&&(n.add(e),Jo(e,((n,i)=>{if(n)return;const o=i.body;o&&!o.querySelector("#page-content")&&er(e,t,"vitalsource-content")})))};r(),this._frameObserver=new MutationObserver(r),this._frameObserver.observe(o,{childList:!0,subtree:!0})}destroy(){this._frameObserver.disconnect()}}function sr(){return document.querySelector("img#pbk-page")}
class ar extends d{constructor(t=document.body,e={}){var n;super(),i(this,"_bookElement",void 0),i(this,"_htmlIntegration",void 0),i(this,"_listeners",void 0),i(this,"_textLayer",void 0),i(this,"_sideBySideActive",void 0);const r=null!==(n=e.bookElement)&&void 0!==n?n:ir(window.parent.document);if(!r)throw new Error("Failed to find <mosaic-book> element in container frame");this._bookElement=r;const s=new hi;this._htmlIntegration=new Ji({container:t,features:s}),this._listeners=new o;const a=["mouseup","mousedown","mouseout"];for(const t of a)this._listeners.add(document.documentElement,t,(t=>{t.stopPropagation()}));const l=window.frameElement;l&&function(t){if("no"!==t.getAttribute("scrolling"))return;const e=document.createElement("style");e.textContent="iframe { height: 100% !important; }",t.insertAdjacentElement("beforebegin",e);const n=()=>t.removeAttribute("scrolling");n(),new MutationObserver(n).observe(t,{attributes:!0})}(l);const c=sr(),h=window.innerPageData;if(c&&h){
const t=h.glyphs.glyphs.map((t=>{const e=t.l/100,n=t.r/100,i=t.t/100,o=t.b/100;return new DOMRect(e,i,n-e,o-i)}));this._textLayer=new nr(c,t,h.words),this._textLayer.container.style.zIndex="100",this._sideBySideActive=!1}}getAnnotatableRange(t){return this._htmlIntegration.getAnnotatableRange(t)}destroy(){this._textLayer&&(this._textLayer.destroy(),this.fitSideBySide({expanded:!1,height:window.innerHeight,width:0,toolbarWidth:0})),this._listeners.removeAll(),this._htmlIntegration.destroy()}anchor(t,e){return this._htmlIntegration.anchor(t,e)}async describe(t,e){const n=this._htmlIntegration.describe(t,e),{cfi:i,index:o,page:r,title:s,url:a}=await this._getPageInfo({includeTitle:!0,includePageIndex:!0}),l=[{type:"EPUBContentSelector",cfi:i,url:a,title:s}];if("number"==typeof o){const t={type:"PageSelector",index:o,label:r};l.push(t)}return n.push(...l),n}contentContainer(){return this._htmlIntegration.contentContainer()}fitSideBySide(t){const e=sr();if(e&&this._textLayer){
const n=e.parentElement,i=this._textLayer,o=window.innerWidth-t.width;return this._sideBySideActive=!1,q((()=>{t.expanded&&o>480?(n.style.textAlign="left",e.style.width=`${o}px`,this._sideBySideActive=!0):(n.style.textAlign="",e.style.width=""),i.updateSync()})),this._sideBySideActive}return this._htmlIntegration.fitSideBySide(t)}sideBySideActive(){return"boolean"==typeof this._sideBySideActive?this._sideBySideActive:this._htmlIntegration.sideBySideActive()}async getMetadata(){return{title:this._bookElement.getBookInfo().title,link:[]}}navigateToSegment(t){var e;const n=null===(e=t.target[0].selector)||void 0===e?void 0:e.find((t=>"EPUBContentSelector"===t.type));if(null!=n&&n.cfi)this._bookElement.goToCfi(n.cfi);else{if(null==n||!n.url)throw new Error("No segment information available");this._bookElement.goToURL(function(t){const e=new URL(t,document.baseURI);return e.pathname+e.search}(n.url))}}persistFrame(){return!0}async _getPageInfo({includeTitle:t=!1,includePageIndex:e=!1}={}){
const[n,i,o]=await Promise.all([this._bookElement.getCurrentPage(),t?this._bookElement.getTOC():void 0,e?this._bookElement.getPages():void 0]),r=["absoluteURL","cfi"];for(const t of r)if(!(t in n))throw new Error(`Page metadata field "${t}" is missing`);let s;if(i){var a;s=n.chapterTitle;const t=Ko(n.cfi),e=null===(a=i.data)||void 0===a?void 0:a.find((e=>Ko(e.cfi)===t));e&&(s=e.title)}let l=n.index;if(void 0===l&&o){var c;const t=null===(c=o.data)||void 0===c?void 0:c.findIndex((t=>t.cfi===n.cfi));-1!==t&&(l=t)}return{cfi:n.cfi,index:l,page:n.page,title:s,url:new URL(n.absoluteURL,document.baseURI).toString()}}async _getPageRange(t){let e=[];try{const t=await this._bookElement.getPageBreaks();t.ok&&t.data&&(e=t.data)}catch(t){console.error("Failed to get page breaks",t)}const n=Go(t),i=e.filter((t=>t.cfiWithoutAssertions.split("!")[0]===n));let o;if(i.length>0){o={start:i[0].label,end:i[i.length-1].label}}return o}async segmentInfo(){const{cfi:t,url:e}=await this._getPageInfo();return{cfi:t,
pages:await this._getPageRange(t),url:e}}async uri(){const t=this._bookElement.getBookInfo().isbn;if(!t)throw new Error("Unable to get book ID from VitalSource");return`https://bookshelf.vitalsource.com/reader/books/${t}`}async scrollToAnchor(t){return this._htmlIntegration.scrollToAnchor(t)}}function lr(t){if(void 0!==window.PDFViewerApplication)return new Yo(t);return"content"===or()?new ar(document.body):new Ji({features:t.features,sideBySideOptions:t.sideBySide})}function cr(){return ve(sn,{classes:"fixed left-[10px] top-[10px]","data-testid":"outside-assignment-notice",status:"notice",variant:"raised",children:"You are outside the page range for this assignment. Annotations made here may not be counted."})}class hr{constructor(t){i(this,"_container",void 0),i(this,"_visible",void 0),this._visible=!1,this._container=new En("notice",(()=>this._render())),t.appendChild(this._container.element)}destroy(){this._container.destroy()}setVisible(t){this._visible=t,this._container.render()}_render(){
return this._visible?ve(cr,{}):null}}class ur{constructor(t,e=document){i(this,"_pendingCallback",void 0),i(this,"_document",void 0),i(this,"_listeners",void 0);let n=!1;this._pendingCallback=null;const r=(n=10)=>{this._pendingCallback=setTimeout((()=>{t(qn(e.getSelection()))}),n)},s=t=>{if("mousedown"===t.type&&(n=!0),"mouseup"===t.type&&(n=!1),n)return;this._cancelPendingCallback();const e="mouseup"===t.type?10:100;r(e)};this._document=e,this._listeners=new o,this._listeners.add(e,"selectionchange",s),this._listeners.add(e.body,"mousedown",s),this._listeners.add(e.body,"mouseup",s),r(1)}disconnect(){this._listeners.removeAll(),this._cancelPendingCallback()}_cancelPendingCallback(){this._pendingCallback&&(clearTimeout(this._pendingCallback),this._pendingCallback=null)}}function dr(t,e){if(t===e)return!0;if(t.parent!==e)return!1;if(!t.frameElement)return!1;return t.frameElement.getBoundingClientRect().width/t.parent.innerWidth>=.8}function fr(){var t;return function(t,e){const n=new Set,i=new Set
;return $n(t,(t=>{for(;t&&!n.has(t);){n.add(t);const o=e(t);null!=o&&i.add(o),t=t.parentNode}})),[...i]}(null!==(t=qn())&&void 0!==t?t:new Range,(t=>{var e;return null===(e=t._annotation)||void 0===e?void 0:e.$tag}))}function pr(t){const e=function(t){let e=t.nodeType===Node.ELEMENT_NODE?t:t.parentElement;const n=[];for(;e;)e.classList.contains("hypothesis-highlight")&&n.push(e),e=e.parentElement;return n}(t).map((t=>t._annotation)).filter((t=>void 0!==t)).map((t=>null==t?void 0:t.$tag));return e}function mr(t){if(!t.range)return null;try{return t.range.toRange()}catch{return null}}function gr(){var t;null===(t=document.getSelection())||void 0===t||t.removeAllRanges()}class _r extends CustomEvent{constructor(t){super("scrolltorange",{bubbles:!0,cancelable:!0,detail:t}),i(this,"_ready",void 0),this._ready=null}get ready(){return this._ready}waitUntil(t){this._ready=t}}class vr extends d{constructor(t,e={},n=window){var r,s,a,l,h;(super(),i(this,"element",void 0),i(this,"selectedRanges",void 0),
i(this,"anchors",void 0),i(this,"features",void 0),i(this,"sideBySide",void 0),i(this,"_featureFlagsReceived",void 0),i(this,"_contentReady",void 0),i(this,"_adder",void 0),i(this,"_clusterToolbar",void 0),i(this,"_hostFrame",void 0),i(this,"_highlightsVisible",void 0),i(this,"_isAdderVisible",void 0),i(this,"_informHostOnNextSelectionClear",void 0),i(this,"_selectionObserver",void 0),i(this,"_annotations",void 0),i(this,"_frameIdentifier",void 0),i(this,"_portFinder",void 0),i(this,"_integration",void 0),i(this,"_hostRPC",void 0),i(this,"_sidebarRPC",void 0),i(this,"_sidebarLayout",void 0),i(this,"_bucketBarClient",void 0),i(this,"_listeners",void 0),i(this,"_hoveredAnnotations",void 0),i(this,"_outsideAssignmentNotice",void 0),this.element=t,this._contentReady=e.contentReady,this._hostFrame=n,this._highlightsVisible=!1,this._isAdderVisible=!1,this._informHostOnNextSelectionClear=!0,this.selectedRanges=[],this._outsideAssignmentNotice=null,this._adder=new kn(this.element,{
onAnnotate:()=>this.createAnnotation(),onHighlight:()=>this.createAnnotation({highlight:!0}),onShowAnnotations:t=>this.selectAnnotations(t,{focusInSidebar:!0})}),this._selectionObserver=new ur((t=>{t?this._onSelection(t):this._onClearSelection()})),this.anchors=[],this._annotations=new Set,this._frameIdentifier=e.subFrameIdentifier||null,this._portFinder=new c({hostFrame:this._hostFrame,source:"guest",sourceId:null!==(r=this._frameIdentifier)&&void 0!==r?r:void 0}),this.features=new hi,this._featureFlagsReceived=new Promise((t=>{this.features.on("flagsChanged",t)})),this.sideBySide=e.sideBySide,this._integration=lr(this),this._integration.on("uriChanged",(()=>this._sendDocumentInfo())),e.contentInfoBanner)&&(null===(l=(h=this._integration).showContentInfo)||void 0===l||l.call(h,e.contentInfoBanner));null!==(s=(a=this._integration).canStyleClusteredHighlights)&&void 0!==s&&s.call(a)&&(this._clusterToolbar=new mi(this._integration.contentContainer(),{features:this.features})),this._hostRPC=new C,
this._connectHost(n),this._sidebarRPC=new C,this._sidebarLayout=null,this._connectSidebar(),this._bucketBarClient=new ri({contentContainer:this._integration.contentContainer(),hostRPC:this._hostRPC}),this._listeners=new o,this._setupElementEvents(),this._hoveredAnnotations=new Set}_sideBySideActive(){var t;return"manual"===(null===(t=this.sideBySide)||void 0===t?void 0:t.mode)&&this.sideBySide.isActive?this.sideBySide.isActive():this._integration.sideBySideActive()}_setupElementEvents(){this._listeners.add(this.element,"mouseup",(t=>{const{target:e,metaKey:n,ctrlKey:i}=t,o=pr(e);if(o.length&&this._highlightsVisible){const t=n||i;this.selectAnnotations(o,{toggle:t})}})),this._listeners.add(this.element,"pointerdown",(t=>{var e;this._sideBySideActive()||pr(t.target).length||dr(window,this._hostFrame)&&null!==(e=this._sidebarLayout)&&void 0!==e&&e.expanded&&window.innerWidth-t.clientX<this._sidebarLayout.width||this._sidebarRPC.call("closeSidebar")})),this._listeners.add(this.element,"mouseover",(({target:t})=>{
const e=pr(t);e.length&&this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",e)})),this._listeners.add(this.element,"mouseout",(()=>{this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",[])})),this._listeners.add(this.element,"keydown",(t=>{this._handleShortcut(t)})),this._listeners.add(window,"resize",(()=>this._repositionAdder()))}async getDocumentInfo(){var t,e,n,i,o;const[r,s,a]=await Promise.all([this._integration.uri(),this._integration.getMetadata(),null===(t=(e=this._integration).segmentInfo)||void 0===t?void 0:t.call(e)]);return{uri:Zi(r),metadata:s,segmentInfo:a,persistent:null!==(n=null===(i=(o=this._integration).persistFrame)||void 0===i?void 0:i.call(o))&&void 0!==n&&n}}async _sendDocumentInfo(){var t,e;null!==(t=(e=this._integration).waitForFeatureFlags)&&void 0!==t&&t.call(e)&&await this._featureFlagsReceived;const n=await this.getDocumentInfo();this._sidebarRPC.call("documentInfoChanged",n)}_repositionAdder(){if(!this._isAdderVisible)return;const t=qn()
;t&&this._onSelection(t)}async _connectHost(t){this._hostRPC.on("clearSelection",(()=>{qn()&&(this._informHostOnNextSelectionClear=!1,gr())})),this._hostRPC.on("createAnnotation",(()=>this.createAnnotation())),this._hostRPC.on("hoverAnnotations",(t=>this._hoverAnnotations(t))),this._hostRPC.on("scrollToAnnotation",(t=>{this._scrollToAnnotation(t)})),this._hostRPC.on("selectAnnotations",((t,e)=>this.selectAnnotations(t,{toggle:e}))),this._hostRPC.on("sidebarLayoutChanged",(e=>{dr(window,t)&&this.fitSideBySide(e),this.element.dispatchEvent(new si({sidebarLayout:e,sideBySideActive:this._sideBySideActive()}))})),this._hostRPC.on("close",(()=>this.emit("hostDisconnected")));const e=await this._portFinder.discover("host");this._hostRPC.connect(e)}async _scrollToAnchor(t){const e=mr(t);if(!e)return;const n=new _r(e);this.element.dispatchEvent(n)&&(await n.ready,await this._integration.scrollToAnchor(t))}async _scrollToAnnotation(t){const e=this.anchors.find((e=>e.annotation.$tag===t))
;null!=e&&e.highlights&&await this._scrollToAnchor(e)}async _connectSidebar(){this._sidebarRPC.on("featureFlagsUpdated",(t=>this.features.update(t))),this._sidebarRPC.on("hoverAnnotations",(t=>this._hoverAnnotations(t))),this._sidebarRPC.on("scrollToAnnotation",(t=>{this._scrollToAnnotation(t)})),this._sidebarRPC.on("setHighlightsVisible",(t=>{this.setHighlightsVisible(t,!1)})),this._sidebarRPC.on("deleteAnnotation",(t=>this.detach(t))),this._sidebarRPC.on("loadAnnotations",(async t=>{try{await Promise.all(t.map((t=>this.anchor(t))))}catch(t){console.warn("Failed to anchor annotations:",t)}})),this._sidebarRPC.on("showContentInfo",(t=>{var e,n;return null===(e=(n=this._integration).showContentInfo)||void 0===e?void 0:e.call(n,t)})),this._sidebarRPC.on("setOutsideAssignmentNoticeVisible",(t=>{this._setOutsideAssignmentNoticeVisible(t)})),this._sidebarRPC.on("navigateToSegment",(t=>{var e,n;return null===(e=(n=this._integration).navigateToSegment)||void 0===e?void 0:e.call(n,t)})),
this._portFinder.discover("sidebar").then((t=>{this._sidebarRPC.connect(t)})),this._sendDocumentInfo()}destroy(){var t,e;this._portFinder.destroy(),this._hostRPC.destroy(),this._sidebarRPC.destroy(),this._listeners.removeAll(),this._selectionObserver.disconnect(),this._adder.destroy(),this._bucketBarClient.destroy(),null===(t=this._clusterToolbar)||void 0===t||t.destroy(),null===(e=this._outsideAssignmentNotice)||void 0===e||e.destroy(),function(t){Zn(Array.from(t.querySelectorAll("hypothesis-highlight")))}(this.element),this._integration.destroy()}async anchor(t){this._contentReady&&(await this._contentReady,this._contentReady=void 0);const e=t=>{var e;const n=mr(t);if(!n)return;const i=Gn(n,null===(e=t.annotation)||void 0===e?void 0:e.$cluster);i.forEach((e=>{e._annotation=t.annotation})),t.highlights=i,this._hoveredAnnotations.has(t.annotation.$tag)&&Qn(i,!0)};this.detach(t.$tag,!1),this._annotations.add(t.$tag),t.target||(t.target=[]);const n=await Promise.all(t.target.map((async e=>{
if(!e.selector||!e.selector.some((t=>"TextQuoteSelector"===t.type)))return{annotation:t,target:e};let n;try{const i=await this._integration.anchor(this.element,e.selector),o=Fn.fromRange(i);n={annotation:t,target:e,range:o}}catch(i){n={annotation:t,target:e}}return n})));if(!this._annotations.has(t.$tag))return[];for(const t of n)e(t);return t.$orphan=n.length>0&&n.every((t=>t.target.selector&&!t.range)),this._updateAnchors(this.anchors.concat(n),!0),this._sidebarRPC.call("syncAnchoringStatus",t),n}detach(t,e=!0){this._annotations.delete(t);const n=[];for(const e of this.anchors)e.annotation.$tag!==t?n.push(e):e.highlights&&Zn(e.highlights);this._updateAnchors(n,e)}_updateAnchors(t,e){var n;this.anchors=t,null===(n=this._clusterToolbar)||void 0===n||n.scheduleClusterUpdates(),e&&this._bucketBarClient.update(this.anchors)}async createAnnotation({highlight:t=!1}={}){const e=this.selectedRanges;this.selectedRanges=[]
;const n=await this.getDocumentInfo(),i=this.element,o=(await Promise.all(e.map((t=>this._integration.describe(i,t))))).map((t=>({source:n.uri,selector:t}))),r={uri:n.uri,document:n.metadata,target:o,$highlight:t,$cluster:t?"user-highlights":"user-annotations",$tag:"a:"+s(8)};return this._sidebarRPC.call("createAnnotation",r),this.anchor(r),gr(),r}_hoverAnnotations(t){this._hoveredAnnotations.clear(),t.forEach((t=>this._hoveredAnnotations.add(t)));for(const e of this.anchors)if(e.highlights){const n=t.includes(e.annotation.$tag);Qn(e.highlights,n)}this._sidebarRPC.call("hoverAnnotations",t)}_onSelection(t){const e=this._integration.getAnnotatableRange(t);if(!e)return void this._onClearSelection();const n=document.getSelection(),i=Wn(n),o=jn(n);o?(this.selectedRanges=[e],this._hostRPC.call("textSelected"),this._adder.annotationsForSelection=fr(),this._isAdderVisible=!0,this._adder.show(o,i)):this._onClearSelection()}_onClearSelection(){this._isAdderVisible=!1,this._adder.hide(),this.selectedRanges=[],
this._informHostOnNextSelectionClear&&this._hostRPC.call("textUnselected"),this._informHostOnNextSelectionClear=!0}selectAnnotations(t,{toggle:e=!1,focusInSidebar:n=!1}={}){e?this._sidebarRPC.call("toggleAnnotationSelection",t):this._sidebarRPC.call("showAnnotations",t,n),this._sidebarRPC.call("openSidebar")}setHighlightsVisible(t,e=!0){!function(t,e){t.classList.toggle("hypothesis-highlights-always-on",e)}(this.element,t),this._highlightsVisible=t,e&&this._hostRPC.call("highlightsVisibleChanged",t)}get highlightsVisible(){return this._highlightsVisible}fitSideBySide(t){this._sidebarLayout=t,this._integration.fitSideBySide(t)}get hoveredAnnotationTags(){return this._hoveredAnnotations}_handleShortcut(t){re(t,"Ctrl+Shift+H")&&this.setHighlightsVisible(!this._highlightsVisible)}_setOutsideAssignmentNoticeVisible(t){this._outsideAssignmentNotice||(this._outsideAssignmentNotice=new hr(this.element)),this._outsideAssignmentNotice.setVisible(t)}}function br(t,e){const n=new URL(t),i=new URLSearchParams
;return i.append("config",JSON.stringify(e)),n.hash=i.toString(),n.toString()}function yr(t,e){var n;const i={};for(const[t,n]of Object.entries(e))"notebookAppUrl"!==t&&"sidebarAppUrl"!==t&&null!=n&&(i[t]=n);i.origin=new URL(t).origin,i.version="1.1458.0";const o=new URL(window.location.href);if(o.hash="",i.hostURL=o.toString(),Array.isArray(i.services)&&(null===(n=i.services)||void 0===n?void 0:n.length)>0){const t=i.services[0];t.onLoginRequest&&(t.onLoginRequestProvided=!0),t.onLogoutRequest&&(t.onLogoutRequestProvided=!0),t.onSignupRequest&&(t.onSignupRequestProvided=!0),t.onProfileRequest&&(t.onProfileRequestProvided=!0),t.onHelpRequest&&(t.onHelpRequestProvided=!0)}return i}function wr({closed:t,onClose:e,children:n,"data-testid":i}){const o=Xt(null);return $t((()=>{var e,n;t?null===(e=o.current)||void 0===e||e.close():null===(n=o.current)||void 0===n||n.showModal()}),[t]),$t((()=>{const t=o.current;return null==t||t.addEventListener("cancel",e),()=>{null==t||t.removeEventListener("cancel",e)}}),[e]),
ve("dialog",{ref:o,className:"relative w-full h-full backdrop:bg-black/50","data-testid":i,children:n})}function xr({closed:t,children:e,...n}){return ve("div",{...n,className:ge("fixed z-max top-0 left-0 right-0 bottom-0 p-3 bg-black/50",{hidden:t}),children:ve("div",{className:"relative w-full h-full",children:e})})}function Cr({document_:t=document,...e}){return ve(Yt((()=>function(t){return"function"==typeof t.createElement("dialog").showModal}(t)?wr:xr),[t]),{...e})}function Sr({config:t,groupId:e}){return ve("iframe",{title:"Hypothesis annotation notebook",className:"h-full w-full border-0",allow:"fullscreen; clipboard-write",src:br(t.notebookAppUrl,{...yr(t.notebookAppUrl,t),group:e})})}function Nr({eventBus:t,config:e}){const[n,i]=zt(0),[o,r]=zt(!0),[s,a]=zt(null),l=Xt(""),c=Xt(null);$t((()=>(l.current=document.body.style.overflow,()=>{document.body.style.overflow=l.current})),[]),$t((()=>{document.body.style.overflow=o?l.current:"hidden"}),[o]),$t((()=>{const e=t.createEmitter()
;return e.subscribe("openNotebook",(t=>{r(!1),i((t=>t+1)),a(t)})),c.current=e,()=>{e.destroy()}}),[t]);const h=Gt((()=>{var t;r(!0),null===(t=c.current)||void 0===t||t.publish("closeNotebook")}),[]);return null===s?null:ve(Cr,{closed:o,onClose:h,"data-testid":"notebook-outer",children:[ve("div",{className:"absolute right-0 m-3",children:ve(on,{title:"Close the Notebook",onClick:h,variant:"dark",classes:ge("!bg-transparent enabled:hover:!bg-grey-3"),"data-testid":"close-button",children:ve(Ee,{className:"w-4 h-4"})})}),ve(Sr,{config:e,groupId:s},n)]})}class Er{constructor(t,e,n){i(this,"_container",void 0),this._container=new En("notebook",(()=>ve(Nr,{eventBus:e,config:n}))),t.append(this._container.element),this._container.render()}destroy(){this._container.destroy()}}function Ar({eventBus:t,config:e}){const[n,i]=zt(!0),o=Xt(null);$t((()=>{const e=t.createEmitter();return e.subscribe("openProfile",(()=>{i(!1)})),o.current=e,()=>{e.destroy()}}),[t]);const r=()=>{var t;i(!0),
null===(t=o.current)||void 0===t||t.publish("closeProfile")};return n?null:ve(Cr,{closed:n,onClose:r,"data-testid":"profile-outer",children:[ve("div",{className:"absolute right-0 m-3",children:ve(on,{title:"Close profile dialog",onClick:r,variant:"dark",classes:ge("!bg-transparent enabled:hover:!bg-grey-3"),children:ve(Ee,{className:"w-4 h-4"})})}),ve("iframe",{title:"Hypothesis profile",className:"h-full w-full border-0",src:e.profileAppUrl})]})}class Tr{constructor(t,e,n){i(this,"_container",void 0),this._container=new En("profile",(()=>ve(Ar,{eventBus:e,config:n}))),t.append(this._container.element),this._container.render()}destroy(){this._container.destroy()}}var kr={exports:{}};!function(t){!function(e,n,i,o){var r,s=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),l="function",c=Math.round,h=Math.abs,u=Date.now;function d(t,e,n){return setTimeout(b(t,n),e)}function f(t,e,n){return!!Array.isArray(t)&&(p(t,n[e],n),!0)}function p(t,e,n){var i
;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==o)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function m(t,n,i){var o="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=e.console&&(e.console.warn||e.console.log);return r&&r.call(e.console,o,i),t.apply(this,arguments)}}r="function"!=typeof Object.assign?function(t){if(t===o||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==o&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var g=m((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===o)&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),_=m((function(t,e){return g(t,e,!0)
}),"merge","Use `assign`.");function v(t,e,n){var i,o=e.prototype;(i=t.prototype=Object.create(o)).constructor=t,i._super=o,n&&r(i,n)}function b(t,e){return function(){return t.apply(e,arguments)}}function y(t,e){return typeof t==l?t.apply(e&&e[0]||o,e):t}function w(t,e){return t===o?e:t}function x(t,e,n){p(E(e),(function(e){t.addEventListener(e,n,!1)}))}function C(t,e,n){p(E(e),(function(e){t.removeEventListener(e,n,!1)}))}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function N(t,e){return t.indexOf(e)>-1}function E(t){return t.trim().split(/\s+/g)}function A(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function T(t){return Array.prototype.slice.call(t,0)}function k(t,e,n){for(var i=[],o=[],r=0;r<t.length;){var s=e?t[r][e]:t[r];A(o,s)<0&&i.push(t[r]),o[r]=s,r++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function R(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),a=0;a<s.length;){
if((i=(n=s[a])?n+r:e)in t)return i;a++}return o}var P=1;function O(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var M="ontouchstart"in e,I=R(e,"PointerEvent")!==o,L=M&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B="touch",D="mouse",F=25,H=1,V=4,U=8,q=1,W=2,z=4,$=8,j=16,X=W|z,Y=$|j,G=X|Y,K=["x","y"],Z=["clientX","clientY"];function Q(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){y(t.options.enable,[t])&&n.handler(e)},this.init()}function J(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,s=e&H&&i-r==0,a=e&(V|U)&&i-r==0;n.isFirst=!!s,n.isFinal=!!a,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=tt(e));r>1&&!n.firstMultiple?n.firstMultiple=tt(e):1===r&&(n.firstMultiple=!1);var s=n.firstInput,a=n.firstMultiple,l=a?a.center:s.center,c=e.center=et(i);e.timeStamp=u(),e.deltaTime=e.timeStamp-s.timeStamp,
e.angle=rt(l,c),e.distance=ot(l,c),function(t,e){var n=e.center,i=t.offsetDelta||{},o=t.prevDelta||{},r=t.prevInput||{};e.eventType!==H&&r.eventType!==V||(o=t.prevDelta={x:r.deltaX||0,y:r.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y});e.deltaX=o.x+(n.x-i.x),e.deltaY=o.y+(n.y-i.y)}(n,e),e.offsetDirection=it(e.deltaX,e.deltaY);var d=nt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=h(d.x)>h(d.y)?d.x:d.y,e.scale=a?(f=a.pointers,p=i,ot(p[0],p[1],Z)/ot(f[0],f[1],Z)):1,e.rotation=a?function(t,e){return rt(e[1],e[0],Z)+rt(t[1],t[0],Z)}(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,s,a=t.lastInterval||e,l=e.timeStamp-a.timeStamp;if(e.eventType!=U&&(l>F||a.velocity===o)){var c=e.deltaX-a.deltaX,u=e.deltaY-a.deltaY,d=nt(l,c,u);i=d.x,r=d.y,n=h(d.x)>h(d.y)?d.x:d.y,s=it(c,u),t.lastInterval=e}else n=a.velocity,i=a.velocityX,r=a.velocityY,s=a.direction
;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=s}(n,e);var f,p;var m=t.element;S(e.srcEvent.target,m)&&(m=e.srcEvent.target);e.target=m}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function tt(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:c(t.pointers[n].clientX),clientY:c(t.pointers[n].clientY)},n++;return{timeStamp:u(),pointers:e,center:et(e),deltaX:t.deltaX,deltaY:t.deltaY}}function et(t){var e=t.length;if(1===e)return{x:c(t[0].clientX),y:c(t[0].clientY)};for(var n=0,i=0,o=0;o<e;)n+=t[o].clientX,i+=t[o].clientY,o++;return{x:c(n/e),y:c(i/e)}}function nt(t,e,n){return{x:e/t||0,y:n/t||0}}function it(t,e){return t===e?q:h(t)>=h(e)?t<0?W:z:e<0?$:j}function ot(t,e,n){n||(n=K);var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return Math.sqrt(i*i+o*o)}function rt(t,e,n){n||(n=K);var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return 180*Math.atan2(o,i)/Math.PI}Q.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),
this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(O(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(O(this.element),this.evWin,this.domHandler)}};var st={mousedown:H,mousemove:2,mouseup:V},at="mousedown",lt="mousemove mouseup";function ct(){this.evEl=at,this.evWin=lt,this.pressed=!1,Q.apply(this,arguments)}v(ct,Q,{handler:function(t){var e=st[t.type];e&H&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=V),this.pressed&&(e&V&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:D,srcEvent:t}))}});var ht={pointerdown:H,pointermove:2,pointerup:V,pointercancel:U,pointerout:U},ut={2:B,3:"pen",4:D,5:"kinect"},dt="pointerdown",ft="pointermove pointerup pointercancel";function pt(){this.evEl=dt,this.evWin=ft,Q.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}
e.MSPointerEvent&&!e.PointerEvent&&(dt="MSPointerDown",ft="MSPointerMove MSPointerUp MSPointerCancel"),v(pt,Q,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),o=ht[i],r=ut[t.pointerType]||t.pointerType,s=r==B,a=A(e,t.pointerId,"pointerId");o&H&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):o&(V|U)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,o,{pointers:e,changedPointers:[t],pointerType:r,srcEvent:t}),n&&e.splice(a,1))}});var mt={touchstart:H,touchmove:2,touchend:V,touchcancel:U};function gt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,Q.apply(this,arguments)}function _t(t,e){var n=T(t.touches),i=T(t.changedTouches);return e&(V|U)&&(n=k(n.concat(i),"identifier",!0)),[n,i]}v(gt,Q,{handler:function(t){var e=mt[t.type];if(e===H&&(this.started=!0),this.started){var n=_t.call(this,t,e);e&(V|U)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:B,
srcEvent:t})}}});var vt={touchstart:H,touchmove:2,touchend:V,touchcancel:U},bt="touchstart touchmove touchend touchcancel";function yt(){this.evTarget=bt,this.targetIds={},Q.apply(this,arguments)}function wt(t,e){var n=T(t.touches),i=this.targetIds;if(e&(2|H)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var o,r,s=T(t.changedTouches),a=[],l=this.target;if(r=n.filter((function(t){return S(t.target,l)})),e===H)for(o=0;o<r.length;)i[r[o].identifier]=!0,o++;for(o=0;o<s.length;)i[s[o].identifier]&&a.push(s[o]),e&(V|U)&&delete i[s[o].identifier],o++;return a.length?[k(r.concat(a),"identifier",!0),a]:void 0}v(yt,Q,{handler:function(t){var e=vt[t.type],n=wt.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:B,srcEvent:t})}});var xt=2500;function Ct(){Q.apply(this,arguments);var t=b(this.handler,this);this.touch=new yt(this.manager,t),this.mouse=new ct(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function St(t,e){
t&H?(this.primaryTouch=e.changedPointers[0].identifier,Nt.call(this,e)):t&(V|U)&&Nt.call(this,e)}function Nt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),xt)}}function Et(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var o=this.lastTouches[i],r=Math.abs(e-o.x),s=Math.abs(n-o.y);if(r<=25&&s<=25)return!0}return!1}v(Ct,Q,{handler:function(t,e,n){var i=n.pointerType==B,o=n.pointerType==D;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)St.call(this,e,n);else if(o&&Et.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var At=R(a.style,"touchAction"),Tt=At!==o,kt="compute",Rt="auto",Pt="manipulation",Ot="none",Mt="pan-x",It="pan-y",Lt=function(){if(!Tt)return!1;var t={},n=e.CSS&&e.CSS.supports
;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){t[i]=!n||e.CSS.supports("touch-action",i)})),t}();function Bt(t,e){this.manager=t,this.set(e)}Bt.prototype={set:function(t){t==kt&&(t=this.compute()),Tt&&this.manager.element.style&&Lt[t]&&(this.manager.element.style[At]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return p(this.manager.recognizers,(function(e){y(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(N(t,Ot))return Ot;var e=N(t,Mt),n=N(t,It);if(e&&n)return Ot;if(e||n)return e?Mt:It;if(N(t,Pt))return Pt;return Rt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,o=N(i,Ot)&&!Lt[Ot],r=N(i,It)&&!Lt[It],s=N(i,Mt)&&!Lt[Mt];if(o){var a=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(a&&l&&c)return}
if(!s||!r)return o||r&&n&X||s&&n&Y?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Dt=1,Ft=32;function Ht(t){this.options=r({},this.defaults,t||{}),this.id=P++,this.manager=null,this.options.enable=w(this.options.enable,!0),this.state=Dt,this.simultaneous={},this.requireFail=[]}function Vt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Ut(t){return t==j?"down":t==$?"up":t==W?"left":t==z?"right":""}function qt(t,e){var n=e.manager;return n?n.get(t):t}function Wt(){Ht.apply(this,arguments)}function zt(){Wt.apply(this,arguments),this.pX=null,this.pY=null}function $t(){Wt.apply(this,arguments)}function jt(){Ht.apply(this,arguments),this._timer=null,this._input=null}function Xt(){Wt.apply(this,arguments)}function Yt(){Wt.apply(this,arguments)}function Gt(){Ht.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Kt(t,e){
return(e=e||{}).recognizers=w(e.recognizers,Kt.defaults.preset),new Zt(t,e)}Ht.prototype={defaults:{},set:function(t){return r(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(f(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=qt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return f(t,"dropRecognizeWith",this)||(t=qt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(f(t,"requireFailure",this))return this;var e=this.requireFail;return-1===A(e,t=qt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(f(t,"dropRequireFailure",this))return this;t=qt(t,this);var e=A(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}
n<8&&i(e.options.event+Vt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+Vt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Ft},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Ft|Dt)))return!1;t++}return!0},recognize:function(t){var e=r({},t);if(!y(this.options.enable,[this,e]))return this.reset(),void(this.state=Ft);56&this.state&&(this.state=Dt),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},v(Wt,Ht,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,o=this.attrTest(t);return i&&(n&U||!o)?16|e:i||o?n&V?8|e:2&e?4|e:2:Ft}}),v(zt,Wt,{defaults:{event:"pan",threshold:10,pointers:1,direction:G},getTouchAction:function(){var t=this.options.direction,e=[];return t&X&&e.push(It),t&Y&&e.push(Mt),e},
directionTest:function(t){var e=this.options,n=!0,i=t.distance,o=t.direction,r=t.deltaX,s=t.deltaY;return o&e.direction||(e.direction&X?(o=0===r?q:r<0?W:z,n=r!=this.pX,i=Math.abs(t.deltaX)):(o=0===s?q:s<0?$:j,n=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=o,n&&i>e.threshold&&o&e.direction},attrTest:function(t){return Wt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Ut(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),v($t,Wt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ot]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),v(jt,Ht,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Rt]},
process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,o=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(V|U)&&!o)this.reset();else if(t.eventType&H)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),e.time,this);else if(t.eventType&V)return 8;return Ft},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&t.eventType&V?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}}),v(Xt,Wt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ot]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),v(Yt,Wt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:X|Y,pointers:1},getTouchAction:function(){return zt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction
;return n&(X|Y)?e=t.overallVelocity:n&X?e=t.overallVelocityX:n&Y&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&h(e)>this.options.velocity&&t.eventType&V},emit:function(t){var e=Ut(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),v(Gt,Ht,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Pt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,o=t.deltaTime<e.time;if(this.reset(),t.eventType&H&&0===this.count)return this.failTimeout();if(i&&o&&n){if(t.eventType!=V)return this.failTimeout();var r=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||ot(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&r?this.count+=1:this.count=1,this._input=t,
0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Ft},failTimeout:function(){return this._timer=d((function(){this.state=Ft}),this.options.interval,this),Ft},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Kt.VERSION="2.0.7",Kt.defaults={domEvents:!1,touchAction:kt,enable:!0,inputTarget:null,inputClass:null,preset:[[Xt,{enable:!1}],[$t,{enable:!1},["rotate"]],[Yt,{direction:X}],[zt,{direction:X},["swipe"]],[Gt],[Gt,{event:"doubletap",taps:2},["tap"]],[jt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Zt(t,e){var n;this.options=r({},Kt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,
this.input=new((n=this).options.inputClass||(I?pt:L?yt:M?Ct:ct))(n,J),this.touchAction=new Bt(this,this.options.touchAction),Qt(this,!0),p(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Qt(t,e){var n,i=t.element;i.style&&(p(t.options.cssProps,(function(o,r){n=R(i.style,r),e?(t.oldCssProps[n]=i.style[n],i.style[n]=o):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}Zt.prototype={set:function(t){return r(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,o=e.curRecognizer;(!o||o&&8&o.state)&&(o=e.curRecognizer=null);for(var r=0;r<i.length;)n=i[r],2===e.stopped||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(t),
!o&&14&n.state&&(o=e.curRecognizer=n),r++}},get:function(t){if(t instanceof Ht)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(f(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(f(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=A(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==o&&e!==o){var n=this.handlers;return p(E(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==o){var n=this.handlers;return p(E(t),(function(t){e?n[t]&&n[t].splice(A(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var i=n.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){
e.srcEvent.preventDefault()};for(var o=0;o<i.length;)i[o](e),o++}},destroy:function(){this.element&&Qt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},r(Kt,{INPUT_START:H,INPUT_MOVE:2,INPUT_END:V,INPUT_CANCEL:U,STATE_POSSIBLE:Dt,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ft,DIRECTION_NONE:q,DIRECTION_LEFT:W,DIRECTION_RIGHT:z,DIRECTION_UP:$,DIRECTION_DOWN:j,DIRECTION_HORIZONTAL:X,DIRECTION_VERTICAL:Y,DIRECTION_ALL:G,Manager:Zt,Input:Q,TouchAction:Bt,TouchInput:yt,MouseInput:ct,PointerEventInput:pt,TouchMouseInput:Ct,SingleTouchInput:gt,Recognizer:Ht,AttrRecognizer:Wt,Tap:Gt,Pan:zt,Swipe:Yt,Pinch:$t,Rotate:Xt,Press:jt,on:x,off:C,each:p,merge:_,extend:g,assign:r,inherit:v,bindFn:b,prefixed:R}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Kt,"function"==typeof o&&o.amd?o((function(){return Kt})):t.exports?t.exports=Kt:e.Hammer=Kt}(window,document)}(kr);var Rr=kr.exports
;function Pr({above:t,below:e,buckets:n,onFocusAnnotations:i,onScrollToAnnotation:o,onSelectAnnotations:r}){const s=t.anchors.length>0,a=e.anchors.length>0,l=t=>t.anchors.map((t=>t.tag));return ve("ul",{className:"relative",children:[s&&ve("li",{className:"absolute right-0 pointer-events-auto mt-[-11px]",style:{top:t.position},children:ve(bn,{"data-testid":"up-navigation-button",direction:"up",onClick:()=>{const e=[...t.anchors].sort(((t,e)=>t.bottom-e.bottom)),n=e[e.length-1];o(n.tag)},onBlur:()=>i([]),onFocus:()=>i(l(t)),onMouseEnter:()=>i(l(t)),onMouseOut:()=>i([]),title:`Go up to next annotations (${t.anchors.length})`,children:t.anchors.length})}),n.map(((t,e)=>ve("li",{className:"absolute right-0 pointer-events-auto mt-[-8px]",style:{top:t.position},children:ve(bn,{direction:"left",onClick:e=>r(l(t),e.metaKey||e.ctrlKey),onBlur:()=>i([]),onFocus:()=>i(l(t)),onMouseEnter:()=>i(l(t)),onMouseOut:()=>i([]),title:`Select nearby annotations (${t.anchors.length})`,children:t.anchors.length})},e))),a&&ve("li",{
className:"absolute right-0 pointer-events-auto",style:{top:e.position},children:ve(bn,{"data-testid":"down-navigation-button",direction:"down",onClick:()=>{const t=[...e.anchors].sort(((t,e)=>t.top-e.top)),n=t[0];o(n.tag)},onBlur:()=>i([]),onFocus:()=>i(l(e)),onMouseEnter:()=>i(l(e)),onMouseOut:()=>i([]),title:`Go up to next annotations (${e.anchors.length})`,children:e.anchors.length})})]})}class Or{constructor(t,{onFocusAnnotations:e,onScrollToAnnotation:n,onSelectAnnotations:o}){i(this,"_container",void 0),i(this,"_positions",void 0),i(this,"_onFocusAnnotations",void 0),i(this,"_onScrollToAnnotation",void 0),i(this,"_onSelectAnnotations",void 0),this._positions=[],this._container=new En("bucket-bar",(()=>this._render())),Object.assign(this._container.element.style,{display:"block",flexGrow:"1",width:"100%"}),t.appendChild(this._container.element),this._onFocusAnnotations=e,this._onScrollToAnnotation=n,this._onSelectAnnotations=o,this._container.render()}destroy(){this._container.destroy()}update(t){
this._positions=t,this._container.render()}_render(){const t=function(t,e){const n=[],i=[],o=[];let r=null;function s(t){const{bottom:e,top:n}=t;return{bottom:e,position:n+(e-n)/2,anchors:[t],top:n}}const a=e.getBoundingClientRect(),l=t.map((t=>({tag:t.tag,top:t.top-a.top,bottom:t.bottom-a.top})));for(const t of l){const e=(t.top+t.bottom)/2;if(e<30){n.push(t);continue}if(e>a.height-30){i.push(t);continue}if(!r){r=s(t);continue}const l=t.top>r.top&&t.bottom<r.bottom;if(t.top-r.bottom>60&&!l)o.push(r),r=s(t);else{const e=t.bottom>r.bottom?t.bottom:r.bottom,n=e-r.top;r.anchors.push(t),r.bottom=e,r.position=r.top+n/2}}return r&&o.push(r),{above:{anchors:n,position:30},below:{anchors:i,position:a.height-30},buckets:o}}(this._positions,this._container.element);return ve(Pr,{above:t.above,below:t.below,buckets:t.buckets,onFocusAnnotations:t=>this._onFocusAnnotations(t),onScrollToAnnotation:t=>this._onScrollToAnnotation(t),onSelectAnnotations:(t,e)=>this._onSelectAnnotations(t,e)})}}function Mr({emitter:t}){
const[e,n]=zt([]),i=Gt((t=>n((e=>[...e,t]))),[]),o=Gt((t=>n((e=>e.filter((e=>e.id!==t))))),[]);return $t((()=>(t.subscribe("toastMessageAdded",i),t.subscribe("toastMessageDismissed",o),()=>{t.unsubscribe("toastMessageAdded",i),t.unsubscribe("toastMessageDismissed",o)})),[t,o,i]),ve(hn,{messages:e,onMessageDismiss:o})}function Ir({icon:t,...e}){return ve(tn,{classes:ge("justify-center rounded","w-[30px] h-[30px]","shadow border bg-white text-grey-6 hover:text-grey-9"),...e,size:"custom",variant:"custom",children:ve(t,{})})}function Lr({highlightsVisible:t}){return ve("div",{className:"sr-only",role:"status","data-testid":"toolbar-status",children:t?"Highlights visible":"Highlights hidden"})}function Br({closeSidebar:t,createAnnotation:e,isSidebarOpen:n,sidebarContainerId:i,newAnnotationType:o,showHighlights:r,toggleHighlights:s,toggleSidebar:a,toggleSidebarRef:l,useMinimalControls:c=!1}){return ve("div",{className:ge("absolute left-[-33px] w-[33px] z-2","text-px-base leading-none"),children:[c&&n&&ve(tn,{
classes:ge("transition-colors focus-visible-ring ring-inset","w-[27px] h-[27px] mt-[140px] ml-px-1.5","flex items-center justify-center bg-white border","text-grey-6 hover:text-grey-9 transition-colors","border-r-0","shadow-sidebar"),title:"Close annotation sidebar",onClick:t,unstyled:!0,children:ve(Ee,{})}),!c&&ve(ht,{children:[ve(tn,{classes:ge("transition-colors focus-visible-ring ring-inset","h-[40px] w-[33px] pl-[6px] rounded-bl","bg-white text-grey-5 hover:text-grey-9","border-l border-b"),elementRef:l,title:"Annotation sidebar",expanded:n,"aria-controls":i,onClick:a,unstyled:!0,children:ve(n?Oe:Re,{})}),ve("div",{className:"space-y-px-1.5 mt-px-2",children:[ve(Ir,{title:"Show highlights",icon:r?Qe:Fe,pressed:r,onClick:s}),ve(Ir,{title:"note"===o?"New page note":"New annotation",icon:"note"===o?je:Se,onClick:e})]}),ve(Lr,{highlightsVisible:r})]})]})}class Dr{constructor(t,e){i(this,"_container",void 0),i(this,"_newAnnotationType",void 0),i(this,"_useMinimalControls",void 0),
i(this,"_highlightsVisible",void 0),i(this,"_sidebarOpen",void 0),i(this,"_sidebarContainerId",void 0),i(this,"_closeSidebar",void 0),i(this,"_toggleSidebar",void 0),i(this,"_toggleHighlights",void 0),i(this,"_createAnnotation",void 0),i(this,"_sidebarToggleButton",void 0);const{createAnnotation:n,setSidebarOpen:o,setHighlightsVisible:r}=e;this._container=t,this._useMinimalControls=!1,this._newAnnotationType="note",this._highlightsVisible=!1,this._sidebarOpen=!1,this._sidebarContainerId=e.sidebarContainerId,this._closeSidebar=()=>o(!1),this._toggleSidebar=()=>o(!this._sidebarOpen),this._toggleHighlights=()=>r(!this._highlightsVisible),this._createAnnotation=()=>{n(),o(!0)},this._sidebarToggleButton={current:null},this.render()}getWidth(){return this._container.firstChild.getBoundingClientRect().width}set useMinimalControls(t){this._useMinimalControls=t,this.render()}get useMinimalControls(){return this._useMinimalControls}set sidebarOpen(t){this._sidebarOpen=t,this.render()}get sidebarOpen(){
return this._sidebarOpen}set newAnnotationType(t){this._newAnnotationType=t,this.render()}get newAnnotationType(){return this._newAnnotationType}set highlightsVisible(t){this._highlightsVisible=t,this.render()}get highlightsVisible(){return this._highlightsVisible}get sidebarToggleButton(){return this._sidebarToggleButton.current}render(){kt(ve(Br,{closeSidebar:this._closeSidebar,createAnnotation:this._createAnnotation,newAnnotationType:this._newAnnotationType,isSidebarOpen:this._sidebarOpen,sidebarContainerId:this._sidebarContainerId,showHighlights:this._highlightsVisible,toggleHighlights:this._toggleHighlights,toggleSidebar:this._toggleSidebar,toggleSidebarRef:this._sidebarToggleButton,useMinimalControls:this.useMinimalControls}),this._container)}}const Fr=280;class Hr{constructor(t,e,n){var r;if(i(this,"_emitter",void 0),i(this,"_config",void 0),i(this,"_listeners",void 0),i(this,"_gestureState",void 0),i(this,"_layoutState",void 0),i(this,"_hammerManager",void 0),i(this,"_hypothesisSidebar",void 0),
i(this,"_messagesElement",void 0),i(this,"_toolbarWidth",void 0),i(this,"_renderFrame",void 0),i(this,"_guestWithSelection",void 0),i(this,"_sidebarRPC",void 0),i(this,"_guestRPC",void 0),i(this,"bucketBar",void 0),i(this,"features",void 0),i(this,"externalFrame",void 0),i(this,"iframeContainer",void 0),i(this,"toolbar",void 0),i(this,"onLoginRequest",void 0),i(this,"onLogoutRequest",void 0),i(this,"onSignupRequest",void 0),i(this,"onProfileRequest",void 0),i(this,"onHelpRequest",void 0),i(this,"onLayoutChange",void 0),i(this,"iframe",void 0),this._emitter=e.createEmitter(),this._guestWithSelection=null,this._guestRPC=[],this._sidebarRPC=new C,this.iframe=function(t){const e=t.sidebarAppUrl,n=br(e,yr(e,t)),i=document.createElement("iframe");return i.src=n,i.title="Hypothesis annotation viewer",i.className="sidebar-frame",i.allow="fullscreen; clipboard-write",Object.defineProperty(i,"allow",{writable:!1})}(n),this._config=n,this.bucketBar=null,this.features=new hi,n.externalContainerSelector){var s
;this.externalFrame=null!==(s=document.querySelector(n.externalContainerSelector))&&void 0!==s?s:t,this.externalFrame.appendChild(this.iframe)}else{if(this.iframeContainer=document.createElement("div"),this.iframeContainer.style.display="none",this.iframeContainer.className="sidebar-container",this.iframeContainer.id="sidebar-container","clean"===n.theme)this.iframeContainer.classList.add("theme-clean");else{let t;n.bucketContainerSelector&&(t=document.querySelector(n.bucketContainerSelector),t||console.warn(`Custom bucket container "${n.bucketContainerSelector}" not found`));const e=document.createElement("div");e.setAttribute("data-testid","sidebar-edge"),e.className=ge("absolute top-0 bottom-0 w-[23px] left-[-22px]","flex flex-col pt-[110px] pr-[5px]","bg-grey-2 sidebar-collapsed:bg-black/[.08]","pointer-events-none"),this.iframeContainer.append(e),t||(t=e),this.bucketBar=new Or(t,{onFocusAnnotations:t=>this._guestRPC.forEach((e=>e.call("hoverAnnotations",t))),
onScrollToAnnotation:t=>this._guestRPC.forEach((e=>e.call("scrollToAnnotation",t))),onSelectAnnotations:(t,e)=>this._guestRPC.forEach((n=>n.call("selectAnnotations",t,e)))})}this.iframeContainer.appendChild(this.iframe),this._hypothesisSidebar=document.createElement("hypothesis-sidebar");const e=Nn(this._hypothesisSidebar);e.appendChild(this.iframeContainer),t.appendChild(this._hypothesisSidebar),this._messagesElement=document.createElement("div"),e.appendChild(this._messagesElement),kt(ve(Mr,{emitter:this._emitter}),this._messagesElement)}this.iframe.contentWindow&&g(this.iframe.contentWindow),this._listeners=new o;const a=document.createElement("div");this.toolbar=new Dr(a,{sidebarContainerId:null===(r=this.iframeContainer)||void 0===r?void 0:r.id,createAnnotation:()=>{var t;if(0===this._guestRPC.length)return;(null!==(t=this._guestWithSelection)&&void 0!==t?t:this._guestRPC[0]).call("createAnnotation")},setSidebarOpen:t=>t?this.open():this.close(),setHighlightsVisible:t=>this.setHighlightsVisible(t)}),
"clean"===n.theme?this.toolbar.useMinimalControls=!0:this.toolbar.useMinimalControls=!1,this.iframeContainer?(this.iframeContainer.prepend(a),this._toolbarWidth=this.toolbar.getWidth()):this._toolbarWidth=0,this._listeners.add(window,"resize",(()=>this._onResize())),this._gestureState={initial:null,final:null},this._setupGestures(),this.close();const[l]=n.services||[];l&&(this.onLoginRequest=l.onLoginRequest,this.onLogoutRequest=l.onLogoutRequest,this.onSignupRequest=l.onSignupRequest,this.onProfileRequest=l.onProfileRequest,this.onHelpRequest=l.onHelpRequest),this.onLayoutChange=n.onLayoutChange,this._layoutState={expanded:!1,width:0,height:0,toolbarWidth:0},this._updateLayoutState(!1),this._setupSidebarEvents()}destroy(){var t,e;this._guestRPC.forEach((t=>t.destroy())),this._sidebarRPC.destroy(),null===(t=this.bucketBar)||void 0===t||t.destroy(),this._listeners.removeAll(),null===(e=this._hammerManager)||void 0===e||e.destroy(),this._hypothesisSidebar?(kt(null,this._messagesElement),
this._hypothesisSidebar.remove()):this.iframe.remove(),this._emitter.destroy(),g(null)}onFrameConnected(t,e){switch(t){case"guest":this._connectGuest(e);break;case"sidebar":this._sidebarRPC.connect(e)}}_connectGuest(t){const e=new C;e.on("textSelected",(()=>{this._guestWithSelection=e,this.toolbar.newAnnotationType="annotation",this._guestRPC.filter((t=>t!==e)).forEach((t=>t.call("clearSelection")))})),e.on("textUnselected",(()=>{this._guestWithSelection=null,this.toolbar.newAnnotationType="note",this._guestRPC.filter((t=>t!==e)).forEach((t=>t.call("clearSelection")))})),e.on("highlightsVisibleChanged",(t=>{this.setHighlightsVisible(t)}));const n=this.bucketBar;n&&e.on("anchorsChanged",(t=>{0===this._guestRPC.indexOf(e)&&n.update(t)})),e.on("close",(()=>{e.destroy(),e===this._guestWithSelection&&(this._guestWithSelection=null),this._guestRPC=this._guestRPC.filter((t=>t!==e))})),e.connect(t),this._guestRPC.push(e),e.call("sidebarLayoutChanged",this._layoutState)}_setupSidebarEvents(){var t;t=document.body,
this._sidebarRPC.on("publicAnnotationCountChanged",(function(e){const n=t.querySelectorAll("[data-hypothesis-annotation-count]");Array.from(n).forEach((t=>{t.textContent=e.toString()}))})),function(t,e){const n=t.querySelectorAll("[data-hypothesis-trigger]");Array.from(n).forEach((t=>{t.addEventListener("click",(t=>{e(),t.stopPropagation()}))}))}(document.body,(()=>this.open())),this._sidebarRPC.on("featureFlagsUpdated",(t=>this.features.update(t))),this._sidebarRPC.on("connect",(()=>{this.iframeContainer&&(this.iframeContainer.style.display="");const t="always"===this._config.showHighlights;this.setHighlightsVisible(t),(this._config.openSidebar||this._config.annotations||this._config.query||this._config.group)&&this.open()})),this._sidebarRPC.on("showHighlights",(()=>this.setHighlightsVisible(!0))),this._sidebarRPC.on("openSidebar",(()=>this.open())),this._sidebarRPC.on("closeSidebar",(()=>this.close())),this._sidebarRPC.on("openNotebook",(t=>{this.hide(),this._emitter.publish("openNotebook",t)})),
this._sidebarRPC.on("openProfile",(()=>{this.hide(),this._emitter.publish("openProfile")})),this._emitter.subscribe("closeProfile",(()=>{this.show()})),this._emitter.subscribe("closeNotebook",(()=>{this.show()})),this._sidebarRPC.on("toastMessageAdded",(t=>{this._emitter.publish("toastMessageAdded",t)})),this._sidebarRPC.on("toastMessageDismissed",(t=>{this._emitter.publish("toastMessageDismissed",t)}));[["loginRequested",this.onLoginRequest],["logoutRequested",this.onLogoutRequest],["signupRequested",this.onSignupRequest],["profileRequested",this.onProfileRequest],["helpRequested",this.onHelpRequest]].forEach((([t,e])=>{e&&this._sidebarRPC.on(t,(()=>e()))}))}_resetGestureState(){this._gestureState={initial:null,final:null}}_setupGestures(){const t=this.toolbar.sidebarToggleButton;t&&(this._hammerManager=new Rr.Manager(t),this._hammerManager.on("panstart panend panleft panright",(t=>this._onPan(t))),this._hammerManager.add(new Rr.Pan({direction:Rr.DIRECTION_HORIZONTAL})))}_updateLayout(){
this._renderFrame||(this._renderFrame=requestAnimationFrame((()=>{if(this._renderFrame=void 0,this._gestureState.final!==this._gestureState.initial&&this.iframeContainer){const t=this._gestureState.final,e=-t;this.iframeContainer.style.marginLeft=`${t}px`,e>=Fr&&(this.iframeContainer.style.width=`${e}px`),this._updateLayoutState()}})))}_updateLayoutState(t){var e,n;const i=this.iframeContainer&&this.toolbar.getWidth()||0,o=null!==(e=this.iframeContainer)&&void 0!==e?e:this.externalFrame,{height:r}=o.getBoundingClientRect(),s=window.getComputedStyle(o),a=parseInt(s.width),l=parseInt(s.marginLeft);let c=i;"boolean"==typeof t?t&&(c+=a):(l<Fr?c-=l:c+=a,t=c>i);const h={expanded:t,width:t?c:i,height:r,toolbarWidth:i};this._layoutState=h,null===(n=this.onLayoutChange)||void 0===n||n.call(this,h),this._guestRPC.forEach((t=>t.call("sidebarLayoutChanged",h)))}_onResize(){!0===this.toolbar.sidebarOpen&&(window.innerWidth<Fr?this.close():this.open())}_onPan(t){const e=this.iframeContainer;if(e)switch(t.type){
case"panstart":this._resetGestureState(),e.classList.add("sidebar-no-transition"),e.style.pointerEvents="none",this._gestureState.initial=parseInt(getComputedStyle(e).marginLeft);break;case"panend":e.classList.remove("sidebar-no-transition"),e.style.pointerEvents="",null===this._gestureState.final||this._gestureState.final<=-280?this.open():this.close(),this._resetGestureState();break;case"panleft":case"panright":{if("number"!=typeof this._gestureState.initial)return;const e=this._gestureState.initial,n=t.deltaX;this._gestureState.final=Math.min(Math.round(e+n),0),this._updateLayout();break}}}open(){if(this._sidebarRPC.call("sidebarOpened"),this.iframeContainer){const t=this.iframeContainer.getBoundingClientRect().width;this.iframeContainer.style.marginLeft=-1*t+"px",this.iframeContainer.classList.remove("sidebar-collapsed")}this.toolbar.sidebarOpen=!0,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!0),this._updateLayoutState(!0)}close(){this._sidebarRPC.call("sidebarClosed"),
this.iframeContainer&&(this.iframeContainer.style.marginLeft="",this.iframeContainer.classList.add("sidebar-collapsed")),this.toolbar.sidebarOpen=!1,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!1),this._updateLayoutState(!1)}setHighlightsVisible(t){this.toolbar.highlightsVisible=t,this._sidebarRPC.call("setHighlightsVisible",t)}show(){var t;null===(t=this.iframeContainer)||void 0===t||t.classList.remove("is-hidden")}hide(){var t;null===(t=this.iframeContainer)||void 0===t||t.classList.add("is-hidden")}}class Vr{constructor(t){i(this,"_emitter",void 0),i(this,"_subscriptions",void 0),this._emitter=t,this._subscriptions=[]}publish(t,...e){this._emitter.emit(t,...e)}subscribe(t,e){this._emitter.on(t,e),this._subscriptions.push([t,e])}unsubscribe(t,e){this._emitter.off(t,e),this._subscriptions=this._subscriptions.filter((([n,i])=>n!==t||i!==e))}destroy(){for(const[t,e]of this._subscriptions)this._emitter.off(t,e);this._subscriptions=[]}}class Ur{constructor(){
i(this,"_emitter",void 0),this._emitter=new d}createEmitter(){return new Vr(this._emitter)}}const qr=document.querySelector('link[type="application/annotator+html"][rel="sidebar"]');new Promise((t=>{"loading"!==document.readyState&&t(),document.addEventListener("readystatechange",(()=>t()))})).then((function(){const t=Y("annotator");let e=()=>{};const n=new Promise((t=>{e=t}));qr.addEventListener("destroy",e);const i=t.subFrameIdentifier?window.parent:window,o=[];if(i===window){if(function(){const t=document.querySelectorAll(["hypothesis-sidebar","hypothesis-notebook","hypothesis-profile"].join(","));return t.forEach((t=>t.remove())),t.length>0}())return void console.warn("Hypothesis did not load because it found an existing instance on the page.");const t=function(t=navigator.userAgent){if(!x(t))return()=>{};const e=t=>{var e;if("hypothesisPortClosed"===(null===(e=t.data)||void 0===e?void 0:e.type)&&t.ports[0]){const e=t.ports[0];w(e,"close"),e.close()}};return window.addEventListener("message",e),
()=>window.removeEventListener("message",e)}();o.push({destroy:t});const e=Y("sidebar"),n=new URL(e.sidebarAppUrl).origin,i=new _(n),r=new Ur,s=new Hr(document.body,r,e),a=new Er(document.body,r,Y("notebook")),l=new Tr(document.body,r,Y("profile"));i.on("frameConnected",((t,e)=>s.onFrameConnected(t,e))),o.push(i,s,a,l)}if("container"===or()){const e=new rr(t);o.push(e)}else{const n=new tr(document.body,t),r=new vr(document.body,t,i);r.on("hostDisconnected",e),o.push(n,r)}n.then((()=>{o.forEach((t=>t.destroy()));document.querySelectorAll("[data-hypothesis-asset]").forEach((t=>t.remove())),function(t=document){Array.from(t.querySelectorAll("script.js-hypothesis-config[data-remove-on-unload]")).forEach((t=>t.remove()))}()}))}))}();
//# sourceMappingURL=annotator.bundle.js.map
